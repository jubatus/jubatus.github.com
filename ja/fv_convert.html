

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>データ変換 &mdash; Jubatus</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="Jubatus" href="index.html"/>
        <link rel="next" title="Commands" href="commands/index.html"/>
        <link rel="prev" title="アルゴリズム" href="method.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Jubatus
          

          
            
            <img src="_static/title.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview/index.html">Jubatus Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">クイックスタート</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index.html">チュートリアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_distributed.html">分散モード</a></li>
<li class="toctree-l1"><a class="reference internal" href="method.html">アルゴリズム</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">データ変換</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">概要</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datum">Datum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">データ変換の流れ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">フィルター</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#string-filter-types">string_filter_types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#string-filter-rules">string_filter_rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#num-filter-types">num_filter_types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#num-filter-rules">num_filter_rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#construct">文字列からの特徴抽出</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#string-types">string_types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#string-rules">string_rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id8">数値からの特徴抽出</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#num-types">num_types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#num-rules">num_rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id9">バイナリデータからの特徴抽出</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#binary-types">binary_types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binary-rules">binary_rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id10">組み合わせ特徴量による特徴抽出</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#combination-types">combination_types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#combination-rules">combination_rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">特徴ベクトルのキーのハッシュ化</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conversion-plugin">プラグイン</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">文字列特徴量プラグイン</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">画像特徴量プラグイン</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#python-bridge">Python Bridge</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id17">設定</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python モジュールに対する共通要件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#string-feature"><code class="docutils literal"><span class="pre">string_feature</span></code> インタフェース</a></li>
<li class="toctree-l3"><a class="reference internal" href="#word-splitter"><code class="docutils literal"><span class="pre">word_splitter</span></code> インタフェース</a></li>
<li class="toctree-l3"><a class="reference internal" href="#num-feature"><code class="docutils literal"><span class="pre">num_feature</span></code> インタフェース</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binary-feature"><code class="docutils literal"><span class="pre">binary_feature</span></code> インタフェース</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands/index.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips_faqs/index.html">Tips and FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers/index.html">開発者ガイド</a></li>
<li class="toctree-l1"><a class="reference internal" href="jubakit/index.html">Jubakit</a></li>
<li class="toctree-l1"><a class="reference internal" href="jubaql/index.html">JubaQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="about/index.html">プロジェクトについて</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Jubatus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>データ変換</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="conversion">
<span id="id1"></span><h1>データ変換<a class="headerlink" href="#conversion" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>一般的に機械学習処理を行う場合、テキストなどの生の非定形データ（例えば HTML や Twitter のつぶやき情報など）を直接扱うことはできない。
こうしたデータは事前に特徴抽出というステップを経て、一般に特徴ベクトルと呼ばれる形式に変換される。
Jubatus における特徴ベクトルの中身は、文字列をキー、数値型を値とする key-value 型である。
この変換を行うことで、自然言語のデータ、画像データ、音声データなどの非定型の生データを統一的に扱うことができる。</p>
<p>Jubatus の特徴ベクトル変換器は、この特徴抽出処理を簡単な設定ファイルを書くことで柔軟にカスタマイズすることを可能にする。</p>
<div class="section" id="id2">
<h2>概要<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>データ変換は「フィルター」と「特徴抽出」の 2 段階で行われる。</p>
<p>まず、フィルター処理によって、データを整形する。
この処理は、例えばHTMLテキストのタグを除去したり、学習にとって不要であることが予めわかっている記号列などを取り除く。
その次に、特徴抽出処理によって、フィルターされたデータから特徴を抽出する。</p>
<p>例えば、フィルタリングの結果として、「世の中ではビッグデータというキーワードが注目されているが、一口にビッグデータといっても立場や観点によって定義は様々です」という文字列が与えられたとする。
ここからキーワードを抽出すると、「ビッグデータ」、「世の中」、「キーワード」、「定義」といった特徴が得られる。
これらの特徴を出現頻度で重み付けをする（出現回数をカウントする）と、「ビッグデータ：2」、「世の中：1」、「キーワード：1」、「定義：1」という結果が得られる。
この一連の流れの中で、与えられた文字列から特徴を抽出し、出現頻度等によって重み付けをするまでの処理を特徴抽出という。</p>
<p>Jubatus では、「フィルタリングでデータからどのような要素を取り除くか」、「特徴抽出でどのように特徴の抽出を行い、どのように重み付けをするか」を、JSON形式の設定ファイルで定義することができる。
一連の処理は、最もシンプルな設定によって多くの場合はうまく動くことが予想される。
以下に最もシンプルな設定を記載する。
この設定を利用すると、文字列データは全てスペース文字で分割してそれぞれの単語を特徴量とし、数値データはその値をそれぞれ特徴量として利用する。
実際にアプリケーションを書くときに、より高い精度の学習結果を求める場合は、設定をチューニングすることで望ましい結果を得られる可能性がある。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;binary_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;binary_rules&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="datum">
<h2>Datum<a class="headerlink" href="#datum" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Jubatusで利用できるデータ形式は、datumと呼ばれる非常にシンプルなkey-valueデータ形式である。
datumには3つのkey-valueが存在する。
一つはキーも値も文字列の文字列データ (string_values) である。
2つ目は、キーは同様に文字列だが、値は数値の数値データ (num_values) である。
最後が、キーは同様に文字列で、値が任意のバイナリデータ（binary_values）である。
string_values には名前、テキスト、職業など、任意のテキストデータを入れることができる。
num_values には年齢、年収、アクセス回数など、任意の数値データを浮動小数点型として入れることができる。
binary_values には画像や音声などのマルチメディアデータなど、任意のバイナリデータを入れることができる。
この3つのデータから、機械学習を行う際に必要となる特徴量を抽出するのが、このデータ変換モジュールである。
また、効率を重視して、それぞれのkey-valueは、各言語のmap型や辞書型を利用せず、keyとvalueのペアの配列で表現される。</p>
<p>以下に例を示す。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user/id&quot;</span><span class="p">,</span> <span class="s2">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/name&quot;</span><span class="p">,</span> <span class="s2">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/income&quot;</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user/image&quot;</span><span class="p">,</span> <span class="s2">&quot;xxxxxxxx&quot;</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>キーの名前に &#8220;$&#8221; 記号を含めることはできない。</p>
<p>例えばC++から利用する場合、datumは <code class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">std::string&gt;</span> <span class="pre">&gt;</span></code> 、 <code class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">double&gt;</span> <span class="pre">&gt;</span></code> 、 <code class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">std::string&gt;</span> <span class="pre">&gt;</span></code> の3つの要素からなっている。
ここでは、 <code class="docutils literal"><span class="pre">std::pair&lt;T,U&gt;</span></code> をPython風のタプルで、 <code class="docutils literal"><span class="pre">std::vector&lt;T&gt;</span></code> をPython風のリストで表している。</p>
</div>
<div class="section" id="id3">
<h2>データ変換の流れ<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>大まかな処理の流れは以下のようになっている。</p>
<p>datumは文字列データ、数値データ、バイナリデータの3つがあるため、それぞれが別々の処理フローを流れる。</p>
<p>文字列データには、まずstring_filter_rulesが適用されて、フィルター済みデータが追加される。
その状態で、string_rulesによって文字列データからの特徴量が抽出される。</p>
<p>数値データには、まずnum_filter_rulesが適用されて、フィルター済みデータが追加される。
その状態で、num_rulesによって数値データからの特徴量が抽出される。</p>
<p>バイナリデータにはbinary_rulesによって特徴量が抽出される。</p>
<p>フィルターと特徴抽出器には引数を必要とするものもあるため、それらはtypesで事前に準備することによって各規則で利用することができるようになる。</p>
<div class="figure" id="id18">
<a class="reference internal image-reference" href="_images/convert_flow.png"><img alt="feature vector converter" src="_images/convert_flow.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text">図: 変換エンジンの構成</span></p>
</div>
</div>
<div class="section" id="id4">
<h2>フィルター<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Jubatusはフィルターという機能を用いて、datum中のkey-valueペアを変換して、別の要素として追加することができる。
例えば、元のデータがHTMLで書かれていたとしよう。
この中のタグ文字列（&lt;a&gt; など）は、学習時には邪魔になることがおおく、そのため予めフィルタリングして使いたいことがある。
あるいは、メール本文の引用（&gt;から始まる行）を削除したいこともあるだろう。
こうした時に利用するのが、filter機能である。</p>
<p>例として、&#8221;message&#8221;内の文字列からHTMLタグを取り除く。
まず、「HTMLタグを取り除く」というルールを定義し、それを <code class="docutils literal"><span class="pre">key</span> <span class="pre">=</span> <span class="pre">&quot;message&quot;</span></code> に適用する。
これは、以下のようなconfigで表現される。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;detag&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_filter_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;detag&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;-detagged&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>まず、&#8221;string_filter_types&#8221;でフィルターを定義し、これを &#8220;detag&#8221; と命名する。
&#8220;detag&#8221; フィルターに対して、&#8221;regexp&#8221;という手法で、&#8221;&lt;[^&gt;]*&gt;&#8221;を&#8221;&#8220;に置き換える、というフィルターを定義する。
次に、実際にdatumのどの要素にどう適用するのか書いたのが&#8221;string_filter_rules&#8221;である。
ここでは、&#8221;message&#8221;という名前の&#8221;key&#8221;の要素に対して、先で定義した&#8221;detag&#8221;フィルターを適用し、&#8221;message&#8221;に&#8221;-detagged&#8221;を付与したkey、すなわち&#8221;message-detagged&#8221;に結果を格納することを示している。</p>
<p>また、&#8221;age&#8221;を数え年に変換(+1歳に)するには、</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;num_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;add_1&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;num_filter_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;add_1&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;_kazoe&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>とする。この挙動も先と同じで、&#8221;user/age&#8221;に1加えた結果が&#8221;user/age_kazoe&#8221;に格納される。</p>
<p>これらのfilterを通すことにより、次の datum が得られる:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user/id&quot;</span><span class="p">,</span> <span class="s2">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/name&quot;</span><span class="p">,</span> <span class="s2">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/income&quot;</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>それぞれの要素について、詳細に説明する。
なお、これらの各 &#8220;types&#8221; や &#8220;rules&#8221; は省略可能で、省略した場合はそれぞれ何も指定されていないものとして扱われる。</p>
<div class="section" id="string-filter-types">
<h3>string_filter_types<a class="headerlink" href="#string-filter-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>&lt;フィルター名&gt;: &lt;引数&gt;　からなる辞書を指定する。
フィルター名は文字列、引数は文字列から文字列への辞書である。
引数には必ず&#8221;method&#8221;を指定する。
残りの引数に関しては、&#8221;method&#8221;の内容に応じて必要な引数が異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<code class="descname">regexp</code></dt>
<dd><p>正規表現にマッチした部分を、指定した文字列に変換する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pattern:</th><td class="field-body">マッチさせる正規表現を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">replace:</th><td class="field-body">置き換え後の文字列を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>利用できる正規表現は、使用する正規表現エンジンのドキュメント (<a class="reference external" href="https://github.com/kkos/oniguruma/blob/master/doc/RE.ja">oniguruma</a> または <a class="reference external" href="https://github.com/google/re2/wiki/Syntax">re2</a>) を参照すること。
使用する正規表現エンジンはコンパイル時に選択可能である (バイナリパッケージでインストールした場合は oniguruma が使用される)。</p>
<p>HTMLのすべてのタグを消すには、例えば以下のようなstring_filter_typeを宣言すればよいだろう。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;detag&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<code class="descname">dynamic</code></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。この値はプラグインによって異なる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="string-filter-rules">
<h3>string_filter_rules<a class="headerlink" href="#string-filter-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>フィルターの適用規則を指定する。
規則は指定された順に評価される。
datum がある規則の条件を満たした場合、そのルールが適用され、変換後の値が datum に追加される。
規則は、元の datum と、それまでにフィルター規則で追加された値の両方に適用される。
各規則は&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;, &#8220;suffix&#8221;の要素からなる辞書を指定する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">datumの各要素のどのkeyとマッチさせるかを指定する。詳細は後述する。</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。この詳細は後述する。</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">利用するフィルター名を指定する。これは &#8220;string_filter_types&#8221; の項で作ったフィルター名を指定する。デフォルトで利用できるフィルターはない。</td>
</tr>
<tr class="field-even field"><th class="field-name">suffix:</th><td class="field-body">変換後の結果を格納するkeyのサフィックスを指定する。例えばsuffixに&#8221;-detagged&#8221;が指定され、&#8221;name&#8221;という名前のkeyに規則が適用された場合、結果は&#8221;name-detagged&#8221;という名前のkeyに格納される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;key&#8221;および&#8221;except&#8221;の要素は以下のうちのいずれかのフォーマットで指定する。
但し、datumの全要素に対して、すべての規則が適用されるかチェックされる。
したがって、複数の規則がマッチした場合は両方の規則が適用されて、複数のフィルター済みの値が追加されることに注意する。
なお、&#8221;key&#8221;および&#8221;except&#8221;に関しては以降でも登場するが、全て同じフォーマットであり、複数適用される可能性がある点も同様である。</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;*&#8221; or &#8220;&#8221;</td>
<td>全ての要素にマッチする。&#8221;key&#8221;にこれが指定されると必ず適用されることになる。</td>
</tr>
<tr class="row-odd"><td>&#8220;XXX*&#8221;</td>
<td>末尾に*をつけると、その前のみをプレフィックスとして使用する。つまり、&#8221;XXX&#8221;で始まるkeyのみにマッチする。</td>
</tr>
<tr class="row-even"><td>&#8220;*XXX&#8221;</td>
<td>先頭に*をつけると、その後のみをサフィックスとして使用する。つまり、&#8221;XXX&#8221;で終わるkeyのみにマッチする。</td>
</tr>
<tr class="row-odd"><td>&#8220;/XXX/&#8221;</td>
<td>2つのスラッシュ(/)で囲うと、その間の表現を正規表現とみなして、正規表現でマッチする。</td>
</tr>
<tr class="row-even"><td>その他</td>
<td>以上のいずれでもない場合は、与えられた文字列と一致するkeyのみにマッチする。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;except&#8221; が与えられ、かつ &#8220;key&#8221; と &#8220;except&#8221; の双方にマッチした場合は、そのルールはスキップされる。
例えば、{&#8220;key&#8221;: &#8220;*&#8221;, &#8220;except&#8221;: &#8220;foo&#8221;, ... } のようにすれば「&#8221;foo&#8221; 以外のすべてのキーにマッチする規則」を定義することができる。</p>
</div>
<div class="section" id="num-filter-types">
<h3>num_filter_types<a class="headerlink" href="#num-filter-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>&#8220;string_filter_types&#8221; と同様、&lt;フィルター名&gt;: &lt;引数&gt; からなる辞書を指定する。
利用の仕方はstring_filter_typesとほぼ同じである。
&lt;フィルター名&gt; は文字列、引数は文字列から文字列への辞書である。
&lt;引数&gt; には必ず&#8221;method&#8221;を指定し、残りの引数は&#8221;method&#8221;の値に応じて必要なものが異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<code class="descname">add</code></dt>
<dd><p>元の値に指定した値を足す。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">value:</th><td class="field-body">足す値の文字列表現を指定する。例えば3足すのであれば、&#8221;3&#8221;と指定する。数値型ではなく文字列として指定する点に注意すること。内部的には Float として利用される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="describe">
<dt>
<code class="descname">linear_normalization</code></dt>
<dd><p>値を0以上から1以下の小数へと正規化する。
&#8220;min&#8221;と&#8221;max&#8221;の2つの小数を入力として要求し、これら2つのパラメータの省略はできない。
入力された値xに対して「(x - min) / (max - min)」という計算を行う事で0以上1以下の小数へと線形に変換する。
もしxが&#8221;min&#8221;より小さい場合には0へ切り上げられる。
同様にxが&#8221;max&#8221;より大きい場合には1へ切り捨てられる。
この挙動は&#8221;truncate&#8221;オプションにより変更が可能である。
&#8220;max&#8221;が&#8221;min&#8221;より小さい場合は、invalid_parameter例外が発生し失敗する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">min:</th><td class="field-body">想定される最小値を指定する。例えば最小値が0であれば、&#8221;0&#8221;と指定する。数値型ではなく文字列として指定する点に注意すること。内部的には Double として利用される。省略不可。</td>
</tr>
<tr class="field-even field"><th class="field-name">max:</th><td class="field-body">想定される最小値を指定する。例えば最大値が100であれば、&#8221;100&#8221;と指定する。数値型ではなく文字列として指定する点に注意すること。内部的には Double として利用される。&#8221;min&#8221;より小さい数や等しい値は指定できない。省略不可。</td>
</tr>
<tr class="field-odd field"><th class="field-name">truncate:</th><td class="field-body">最小値未満の値や、最大値以上の値に対する動作を規定する。デフォルトでは&#8221;True&#8221;であり、最小値以下の値は0へ、最大値以上の値は1へ切り詰められる。&#8221;True&#8221;以外を指定する事で最小値以下・最大値以上の値に対する切り詰め処理を行わせない事ができる。省略可能。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>この機能を使う際のコンフィグの一例は以下の通りである。</p>
</dd></dl>

<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;num_filter_types&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;zero_to_hundred&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;linear_normalization&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="o">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="o">:</span><span class="s2">&quot;100&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;num_filter_rules&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;zero_to_hundred&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;linear_normalized&quot;</span> <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<dl class="describe">
<dt>
<code class="descname">gaussian_normalization</code></dt>
<dd><p>値がガウス分布（正規分布）していると仮定し、与えられた平均値と標準偏差にそった値を-1以上+1以下の範囲の小数に正規化する。
&#8220;average&#8221;と&#8221;standard_deviation&#8221;の2つの小数を入力として要求し、省略はできない。
入力された値xに対して「(x - average) / standard_deviation」という計算を行う事で-1以上1以下の小数へと変換する。
そのため外れ値は-1を下回る値や1を超える値になることがありうる。
&#8220;standard_deviation&#8221;に負の値を指定した場合にはinvalid_parameter例外が発生し失敗する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">average:</th><td class="field-body">平均値を指定する。例えば平均値が80であれば、&#8221;80&#8221;と指定する。数値型ではなく文字列として指定する点に注意すること。内部的には Double として利用される。</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">standard_deviation:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body">想定される標準偏差を指定する。例えば標準偏差が2.3であれば、&#8221;2.3&#8221;と指定する。数値型ではなく文字列として指定する点に注意すること。内部的には Double として利用される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>この機能を使う際のコンフィグの一例は以下の通りである。</p>
</dd></dl>

<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;num_filter_types&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;gaussian_80_2.3&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;gaussian_normalization&quot;</span><span class="p">,</span> <span class="s2">&quot;average&quot;</span><span class="o">:</span> <span class="s2">&quot;80&quot;</span><span class="p">,</span> <span class="s2">&quot;standard_deviation&quot;</span><span class="o">:</span><span class="s2">&quot;2.3&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;num_filter_rules&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;gaussian_80_2.3&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;gaussian_normalized&quot;</span> <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<dl class="describe">
<dt>
<code class="descname">sigmoid_normalization</code></dt>
<dd><p>値をシグモイド関数に基づいて0から1の範囲へと切り詰める。
&#8220;gain&#8221;と&#8221;bias&#8221;の2つを入力として要求する。省略した場合にはそれぞれ1と0になる。
入力された値xに対して「1 / (1 + e ^ (-gain * (x - bias)))」という計算を行う事で0〜1の小数へと変換する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">gain:</th><td class="field-body">sigmoid関数のゲイン値を指定する。大きな値を指定するほど急峻なsigmoid関数となる。例えば0.5を指定する場合は&#8221;0.5&#8221;と指定する。数値型ではなく文字列として指定する点に注意すること。内部的には Float として利用される。省略可能であり、デフォルトでは1である。</td>
</tr>
<tr class="field-even field"><th class="field-name">bias:</th><td class="field-body">sigmoid関数のバイアス値を指定する。sigmoid関数が0.5を出力する事を期待するxの値を指定する。例えば3を指定する場合は&#8221;3&#8221;と指定する。数値型ではなく文字列として指定する点に注意すること。内部的には Float として利用される。省略可能であり、デフォルトでは0である。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>この機能を使う際のコンフィグの一例は以下の通りである。</p>
</dd></dl>

<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;num_filter_types&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;sigmoid&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;sigmoid_normalization&quot;</span><span class="p">,</span> <span class="s2">&quot;gain&quot;</span><span class="o">:</span> <span class="s2">&quot;0.05&quot;</span><span class="p">,</span> <span class="s2">&quot;bias&quot;</span><span class="o">:</span><span class="s2">&quot;5&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;num_filter_rules&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;sigmoid&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;sigmoid_normalized&quot;</span> <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<dl class="describe">
<dt>
<code class="descname">dynamic</code></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="num-filter-rules">
<h3>num_filter_rules<a class="headerlink" href="#num-filter-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>こちらも、string_filter_rules同様、フィルターの適用規則を指定する。
規則は複数からなり、各規則は&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;, &#8220;suffix&#8221;の要素からなる辞書を指定する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">利用するフィルター名を指定する。これはstring_filter_typesの項で作ったフィルター名を指定する。デフォルトで利用できるフィルターはない。</td>
</tr>
<tr class="field-even field"><th class="field-name">suffix:</th><td class="field-body">変換後の結果を格納するkeyのサフィックスを指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;key&#8221;と&#8221;except&#8221;の指定の仕方は、string_filter_rulesを参照のこと。</p>
</div>
</div>
<div class="section" id="construct">
<span id="id5"></span><h2>文字列からの特徴抽出<a class="headerlink" href="#construct" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>文字列型に対する特徴抽出器と、その抽出規則の適用方法について解説する。</p>
<p>以下に、設定の例を示す。
この例では、&#8221;user/name&#8221;の値はそのまま特徴量として使用し、&#8221;message&#8221;は文字2グラムを特徴量とし、&#8221;message-detagged&#8221;はスペース文字で分割した単語を特徴量とする。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;bigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/name&quot;</span><span class="p">,</span>        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>    <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span>          <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;bigram&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;tf&quot;</span><span class="p">,</span>  <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span>  <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>例えば、この規則を次のような datum に適用する。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user/id&quot;</span><span class="p">,</span> <span class="s2">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/name&quot;</span><span class="p">,</span> <span class="s2">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>結果として得られる特徴抽出結果は、以下のようになる。
&#8220;message&#8221; は &#8220;bigram&#8221; 設定なので2文字ずつに分割され、特徴量 &#8220;H&gt;&#8221; は文字列中に2度出てくるのでその重みは2になることがわかる。</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="37%" />
<col width="23%" />
<col width="8%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">キー</th>
<th class="head">文字列</th>
<th class="head">特徴量</th>
<th class="head">重み</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;user/name&#8221;</td>
<td>&#8220;Loren Ipsum&#8221;</td>
<td>&#8220;Loren Ipsum&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&#8220;message&#8221;</td>
<td>&#8220;&lt;H&gt;Hello World&lt;/H&gt;&#8221;</td>
<td>&#8220;&lt;H&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;H&gt;&#8221;</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;&gt;H&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;He&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;el&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;ll&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;lo&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;o &#8220;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8221; W&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;Wo&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;or&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;rl&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;ld&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;d&lt;&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;&lt;/&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;/H&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&#8220;message-detagged&#8221;</td>
<td>&#8220;Hello World&#8221;</td>
<td>&#8220;Hello&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;World&#8221;</td>
<td>1</td>
</tr>
</tbody>
</table>
<div class="section" id="string-types">
<h3>string_types<a class="headerlink" href="#string-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>string_typesで文字列特徴抽出器を定義する。
主に、パスなどの引数を指定しなければならない特徴抽出器は、一度string_typesで指定してから利用しなければならない。
string_filter_typesなどと同様、&lt;抽出器名&gt;:&lt;引数&gt; からなる辞書を指定する。
抽出器名に &#8220;&#64;&#8221; 文字を含むことはできない。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。</p>
<p>指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<code class="descname">ngram</code></dt>
<dd><p>隣接するN文字を特徴量として利用する。こうした特徴量は文字N-gram特徴と呼ばれる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">char_num:</th><td class="field-body">利用する文字数(整数値)の文字列表現を指定する。文字数は0より大きい必要がある。内部的には Integer として利用される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>例として、連続する2文字および3文字を特徴として利用する、bigramとtrigramを定義する方法を記す。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;bigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span> <span class="p">},</span>
  <span class="s2">&quot;trigram&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<code class="descname">regexp</code></dt>
<dd><p>与えられた文書から正規表現を利用してキーワードを抜き出して、それぞれを特徴量として利用する。
正規表現マッチは連続的に行われ、マッチした箇所全てを特徴として使う。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pattern:</th><td class="field-body">マッチさせる正規表現を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">group:</th><td class="field-body">キーワードとして取り出すグループを指定する。0ならマッチした全体で、1以上の値を指定すると () で取り出したグループだけをキーワードとする。省略すると0として扱う。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>利用できる正規表現は、使用する正規表現エンジンのドキュメント (<a class="reference external" href="https://github.com/kkos/oniguruma/blob/master/doc/RE.ja">oniguruma</a> または <a class="reference external" href="https://github.com/google/re2/wiki/Syntax">re2</a>) を参照すること。
使用する正規表現エンジンはコンパイル時に選択可能である (バイナリパッケージでインストールした場合は oniguruma が使用される)。</p>
<p>最も簡単な例として、以下では日付表現 (YYYY/MM/DD) を全て取り出す。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;date&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;[0-9]{4}/[0-9]{2}/[0-9]{2}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>パターンの一部だけを利用するときは、 &#8220;group&#8221; 引数を利用する。たとえば、以下の様な設定で年齢が取れるだろう。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;(age|Age)([ :=])([0-9]+)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<code class="descname">split</code></dt>
<dd><p>指定した文字を区切り文字として文字列を分割し、それぞれを特徴量として利用する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">separators:</th><td class="field-body">区切り文字として利用する文字を指定する。複数の文字を指定した場合はそれぞれを区切り文字とする。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>例として、カンマを区切り文字として利用する場合、およびa,b,cの3文字を区切り文字として利用する場合に定義する方法を記す。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;comma_split&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;split&quot;</span><span class="p">,</span> <span class="s2">&quot;separators&quot;</span><span class="o">:</span> <span class="s2">&quot;,&quot;</span> <span class="p">},</span>
  <span class="s2">&quot;abc_split&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;split&quot;</span><span class="p">,</span> <span class="s2">&quot;separators&quot;</span><span class="o">:</span> <span class="s2">&quot;abc&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<code class="descname">dynamic</code></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="string-rules">
<h3>string_rules<a class="headerlink" href="#string-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>文字列特徴の抽出規則を指定する。
string_filter_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;, &#8220;sample_weight&#8221;, &#8220;global_weight&#8221;からなる辞書で指定する。
文字列データの場合、与えられた文字列から特徴量を抽出し、そこに対して重みを設定する必要がある。
重みの設定の仕方を決めるのが、&#8221;sample_weight&#8221;と&#8221;global_weight&#8221;の2つのパラメータである。
実際に利用する重みは、2つの重みの積を重み付けとして利用する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body"><p class="first">datumの各要素のどのkeyとマッチさせるかを指定する。string_filter_rulesを参照のこと。なお、 &#8220;*&#8221; や &#8220;&#8221; を設定した場合、フィルタ処理前の要素も特徴抽出対象となるため注意する。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body"><p class="first">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body"><p class="first">利用する抽出器名を指定する。これはstring_typesの項で作った抽出器名を指定する。また、以下の抽出器はデフォルトで利用できる。</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;str&quot;</span></code></td>
<td>文字列分割を行わず、指定された文字列そのものを特徴として利用する。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&quot;space&quot;</span></code></td>
<td>スペース文字で分割を行い、分割された部分文字列を特徴として利用する。</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="field-even field"><th class="field-name">sample_weight:</th><td class="field-body"><p class="first">各key-value毎の重み設定の仕方を指定する。これはkey-value一つに対して決定される重みである。</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;bin&quot;</span></code></td>
<td>重みを常に1とする。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&quot;tf&quot;</span></code></td>
<td>与えられた文字列中で出現する回数で重み付けをする。例えば5回&#8221;hello&#8221;が出現したら、重みを5にする。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;log_tf&quot;</span></code></td>
<td>tfの値に1を足してlogを取った値を重み付けに利用する。例えば5回&#8221;hello&#8221;が出現したら、重みはlog(5 + 1)にする。</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">global_weight:</th><td class="field-body"><p class="first">今までの通算データから算出される、大域的な重み付けを指定する。</p>
<table border="1" class="last docutils">
<colgroup>
<col width="3%" />
<col width="97%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;bin&quot;</span></code></td>
<td>重みを常に1とする。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&quot;idf&quot;</span></code></td>
<td>文書正規化頻度の逆数の対数を利用する。例えば文書1000件中で50件にその特徴が含まれた場合、重みはlog(1000/50)にする。大まかには出現頻度の少ない特徴ほど大きな重みが設定される。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;idf1&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">&quot;idf&quot;</span></code> の値に 1.0 を加算した値を使用する。表下の説明も参照のこと。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&quot;bm25&quot;</span></code></td>
<td>Okapi BM25 による重み付けを利用する。特徴の出現頻度だけでなく、その特徴が出現した文書の長さを考慮して重み付けを行う。大まかには、出現頻度が少なく、かつ出現した文書の長さが短い特徴ほど、大きな重みが設定される。通常は <code class="docutils literal"><span class="pre">&quot;sample_weight&quot;:</span> <span class="pre">&quot;tf&quot;</span></code> とセットで使用する。経験的には IDF よりも良い結果が得られることが多い。IDF よりも計算量が大きくなる点に留意すること。</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>sample_weightとglobal_weightは、ともにbinにしておいても通常のケースでは正しく動作する。
また、例えば分類問題など重み自体を学習するケースでは、ともにbinにしておいても自動的に調整される。</p>
<p><code class="docutils literal"><span class="pre">global_weight</span></code> において、 <code class="docutils literal"><span class="pre">&quot;idf&quot;</span></code> の代わりに <code class="docutils literal"><span class="pre">&quot;idf1&quot;</span></code> を使用することで、最初の文書に出現する特徴や全ての文書に出現する特徴が学習モデルに登録されない問題を回避することができる。
通常の <code class="docutils literal"><span class="pre">&quot;idf&quot;</span></code> の場合、最初の文書(例えばRecommenderにおいて最初に登録したレコード)の特徴や、すべての文書に出現する特徴(例えば <code class="docutils literal"><span class="pre">&quot;the&quot;</span></code> という単語が文書1,000件中で1,000件に含まれた場合)、それらの特徴のIDF値が <code class="docutils literal"><span class="pre">0</span></code> すなわち特徴の重みが <code class="docutils literal"><span class="pre">0</span></code> となってしまい、学習が行われない。
<code class="docutils literal"><span class="pre">&quot;idf1&quot;</span></code> は <code class="docutils literal"><span class="pre">IDF値</span> <span class="pre">+</span> <span class="pre">1.0</span></code> を重みとして使うことで、そのような状況でも特徴の学習を行うことができるようにしている。</p>
</div>
</div>
<div class="section" id="id8">
<h2>数値からの特徴抽出<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>数値型に対しても、文字列型同様変換ルールを記述する。
また、数値型に関しても、ユーザー定義の変換器を定義することができる。</p>
<p>以下に、設定の例を示す。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;num_types&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="p">},</span>
<span class="s2">&quot;num_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age&quot;</span><span class="p">,</span>       <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/income&quot;</span><span class="p">,</span>    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>例えば、この規則を次のような datum に適用する。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">(</span>
  <span class="p">[],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/income&quot;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>結果として得られる特徴抽出結果は、以下のようになる。</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="29%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">キー</th>
<th class="head">値</th>
<th class="head">重み</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;user/age&#8221;</td>
<td>29</td>
<td>29</td>
</tr>
<tr class="row-odd"><td>&#8220;user/income&#8221;</td>
<td>100000</td>
<td>log(100000) = 11.5129...</td>
</tr>
<tr class="row-even"><td>&#8220;user/age_kazoe&#8221;</td>
<td>30</td>
<td>30</td>
</tr>
</tbody>
</table>
<div class="section" id="num-types">
<h3>num_types<a class="headerlink" href="#num-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>num_typesで数値データに対する特徴抽出器を定義する。
string_typesなどと同様、&lt;抽出器名&gt;: &lt;引数&gt; からなる辞書を指定する。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<code class="descname">dynamic</code></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="num-rules">
<h3>num_rules<a class="headerlink" href="#num-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>数値特徴の抽出規則を指定する。
string_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;からなる辞書で指定する。
重みの付け方や特徴名の指定の仕方もそれぞれの&#8221;type&#8221;ごとに異なる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body"><p class="first">datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。なお、&#8221;*&#8221; や &#8220;&#8221; を設定した場合、フィルタ処理前の要素も特徴抽出対象となるため注意する。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body"><p class="first">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body"><p class="first">利用する抽出器名を指定する。これはnum_typesの項で作った抽出器名を指定する。ただし、以下の抽出器はデフォルトで利用できる。</p>
<table border="1" class="last docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;num&quot;</span></code></td>
<td>与えられた数値をそのまま重みに利用する。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&quot;log&quot;</span></code></td>
<td>与えられた数値の自然対数を重みに利用する。但し、数値が1以下の場合は0とする。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;str&quot;</span></code></td>
<td>与えられた数値を文字列として扱う。これは、例えばIDなど、数値自体の大きさに意味のないデータに対して利用する。重みは1とする。</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="id9">
<h2>バイナリデータからの特徴抽出<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="binary-types">
<h3>binary_types<a class="headerlink" href="#binary-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>binary_typesでバイナリデータに対する特徴抽出器を定義する。
string_typesなどと同様、 &lt;抽出器名&gt;: &lt;引数&gt; からなる辞書を指定する。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<code class="descname">dynamic</code></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="binary-rules">
<h3>binary_rules<a class="headerlink" href="#binary-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>バイナリ特徴の抽出規則を指定する。
string_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;からなる辞書で指定する。
重みの付け方や特徴名の指定の仕方もそれぞれの&#8221;type&#8221;ごとに異なる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">利用する抽出器名を指定する。これはbinary_typesの項で作った抽出器名を指定する。デフォルトで利用できる特徴抽出器はないため、必ずbinary_typesで指定する必要がある。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="id10">
<h2>組み合わせ特徴量による特徴抽出<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>数値特徴量や文字列特徴量の組み合わせにより、新たな特徴量を抽出することができる。</p>
<p>以下に、設定の例を示す。
この例では、数値型の特徴量の和(&#8220;add&#8221;)と積(&#8220;mul&#8221;)を新たな特徴量とする。
また、文字列型の特徴量を&#8221;bin/bin&#8221;で変換した特徴量の和(&#8220;add&#8221;)と積(&#8220;mul&#8221;)を新たな特徴量とする。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;num_types&quot;</span><span class="o">:</span> <span class="p">{},</span>
<span class="s2">&quot;num_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span><span class="p">}</span>
<span class="p">],</span>
<span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{},</span>
<span class="s2">&quot;string_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">},</span>
<span class="p">],</span>
<span class="s2">&quot;combination_types&quot;</span><span class="o">:</span> <span class="p">{},</span>
<span class="s2">&quot;combination_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key_left&quot;</span><span class="o">:</span> <span class="s2">&quot;*@num&quot;</span><span class="p">,</span> <span class="s2">&quot;key_right&quot;</span><span class="o">:</span> <span class="s2">&quot;*@num&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;add&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key_left&quot;</span><span class="o">:</span> <span class="s2">&quot;*@num&quot;</span><span class="p">,</span> <span class="s2">&quot;key_right&quot;</span><span class="o">:</span> <span class="s2">&quot;*@num&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;mul&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key_left&quot;</span><span class="o">:</span> <span class="s2">&quot;*@str#bin/bin&quot;</span><span class="p">,</span> <span class="s2">&quot;key_right&quot;</span><span class="o">:</span> <span class="s2">&quot;*@str#bin/bin&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;add&quot;</span><span class="p">}</span>
  <span class="p">{</span> <span class="s2">&quot;key_left&quot;</span><span class="o">:</span> <span class="s2">&quot;*@str#bin/bin&quot;</span><span class="p">,</span> <span class="s2">&quot;key_right&quot;</span><span class="o">:</span> <span class="s2">&quot;*@str#bin/bin&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;mul&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>例えば、この規則を次のようなdatumに適用する。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">(</span>
  <span class="p">[],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/income&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user/name&quot;</span><span class="p">,</span> <span class="s2">&quot;Loren&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>結果として得られる特徴抽出結果は、以下のようになる。
&#8220;num_rules&#8221;, &#8220;string_rules&#8221;で抽出された特徴量に対して、
&#8220;combination_rules&#8221;によって特徴量の和と積が計算されているのがわかる。</p>
<table border="1" class="docutils">
<colgroup>
<col width="89%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">キー</th>
<th class="head">重み</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;user/age&#64;num&#8221;</td>
<td>25</td>
</tr>
<tr class="row-odd"><td>&#8220;user/income&#64;num&#8221;</td>
<td>1000</td>
</tr>
<tr class="row-even"><td>&#8220;user/income&#64;num&amp;user/age&#64;num/add&#8221;</td>
<td>1025</td>
</tr>
<tr class="row-odd"><td>&#8220;user/income&#64;num&amp;user/age&#64;num/mul&#8221;</td>
<td>25000</td>
</tr>
<tr class="row-even"><td>&#8220;message$Hello&#64;str#bin/bin&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&#8220;user/name$Loren&#64;str#bin/bin&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&#8220;message$Hello&#64;str#bin/bin&amp;user/name$Loren&#64;str#bin/bin/mul&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&#8220;message$Hello&#64;str#bin/bin&amp;user/name$Loren&#64;str#bin/bin/add&#8221;</td>
<td>2</td>
</tr>
</tbody>
</table>
<div class="section" id="combination-types">
<h3>combination_types<a class="headerlink" href="#combination-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>combination_types で組み合わせデータに対する特徴抽出器を定義する。
string_typesなどと同様、&lt;抽出器名&gt;: &lt;引数&gt; からなる辞書を指定する。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<code class="descname">dynamic</code></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="combination-rules">
<h3>combination_rules<a class="headerlink" href="#combination-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>組み合わせ特徴量の抽出規則を指定する。
string_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key_left&#8221;, &#8220;key_right&#8221;, &#8220;except_left&#8221; (オプション), &#8220;except_right&#8221; (オプション), &#8220;type&#8221;からなる辞書で指定する。
重みの付け方や特徴量の指定の仕方もそれぞれの&#8221;type&#8221;ごとに異なる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key_left:</th><td class="field-body"><p class="first">第一引数。datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。なお、&#8221;*&#8221; や &#8220;&#8221; を設定した場合、フィルタ処理前の要素も特徴抽出対象となるため注意する。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">key_right:</th><td class="field-body"><p class="first">第二引数。同上。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">except_left:</th><td class="field-body"><p class="first">第一引数の除外パターン。 key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">except_right:</th><td class="field-body"><p class="first">第二引数の除外パターン。同上。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body"><p class="first">利用する抽出器名を指定する。これはcombination_typesの項で作った抽出器名を指定する。ただし、以下の抽出器はデフォルトで利用できる。</p>
<table border="1" class="last docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;add&quot;</span></code></td>
<td>&#8220;key_left&#8221; と &#8220;key_right&#8221; で指定された特徴量の和を重みに利用する。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&quot;mul&quot;</span></code></td>
<td>&#8220;key_left&#8221; と &#8220;key_right&#8221; で指定された特徴量の積を重みに利用する。</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="id11">
<h2>特徴ベクトルのキーのハッシュ化<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Jubatus では特徴ベクトルのキーをハッシュ化することでメモリ消費を抑えることができる。
特徴ベクトルのキーをハッシュ化することで、特徴ベクトルの次元数の最大長を制限することができるが、ハッシュの衝突により学習精度の低下が発生する可能性がある。</p>
<p>この機能はデフォルトでは無効である。
使用するには、変換設定に <code class="docutils literal"><span class="pre">hash_max_size</span></code> を指定する。値には0より大きい整数値を指定する。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span> <span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;key&quot;</span> <span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;num&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;binary_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;binary_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;hash_max_size&quot;</span><span class="p">:</span> <span class="mi">16</span>
<span class="p">}</span>
</pre></div>
</div>
<p>最適な <code class="docutils literal"><span class="pre">hash_max_size</span></code> の値は、使用するデータセットおよび環境により異なる。
<code class="docutils literal"><span class="pre">hash_max_size</span></code> が制限するのは入力される datum のキー数ではなく、(変換後の) 特徴ベクトルのキー数であることに注意する。</p>
</div>
<div class="section" id="conversion-plugin">
<span id="id12"></span><h2>プラグイン<a class="headerlink" href="#conversion-plugin" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>フィルターと抽出器では、それぞれプラグインを利用することができる。
プラグインは単体の動的ライブラリファイル（.soファイル）からなる。
プラグインの作り方は、別の章を参照するとして、ここではプラグインの使い方について解説する。</p>
<p>各フィルターと抽出器のいずれの場合も、プラグインの指定の仕方は同じである。
CLASS_types (CLASS は <code class="docutils literal"><span class="pre">string</span></code> または <code class="docutils literal"><span class="pre">num</span></code>) で、フィルターや抽出器を指定する際のパラメータで、&#8221;method&#8221;に&#8221;dynamic&#8221;を、&#8221;path&#8221;に.soファイルへのパスを、&#8221;function&#8221;に各プラグイン固有の呼び出し関数名を指定する。
プラグインのパスの指定方法は2種類ある。
パス名に &#8216;/&#8217; が含まれる場合は、相対パスか絶対パスとみなされる。
この場合、相対パスならカレントディレクトリからの相対パスの、絶対パスなら指定のパスのプラグインを読み込む。
逆に &#8216;/&#8217; が含まれない場合は、以下の順で読み込みを試み、成功したほうが採用される。</p>
<ol class="arabic simple">
<li>環境変数 <code class="docutils literal"><span class="pre">JUBATUS_PLUGIN_PATH</span></code> で指定されたディレクトリ</li>
<li>ビルド時に指定したデフォルトのプラグインディレクトリ（多くの場合は <code class="docutils literal"><span class="pre">$PREFIX/lib/jubatus/plugin</span></code> または <code class="docutils literal"><span class="pre">$PREFIX/lib64/jubatus/plugin</span></code> ）</li>
</ol>
<p>また、その他のパラメータに関しては、各プラグイン固有のパラメータを渡す。</p>
<p>Jubatusでは、デフォルトで以下の2つの文字列特徴量のプラグインと1つの画像特徴量プラグインが提供されている。
ただし、コンパイルオプションによっては一部のプラグインがビルドされないため、注意すること。</p>
<div class="section" id="id13">
<h3>文字列特徴量プラグイン<a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>文字列特徴量プラグインではMeCabプラグインとuxプラグインを提供している。</p>
<dl class="describe">
<dt>
<code class="descname">libmecab_splitter.so</code></dt>
<dd><p>string_typesで指定できる。
<a class="reference external" href="https://github.com/taku910/mecab">MeCab</a> を利用して文書を単語分割し、各単語を特徴量として利用する。
<code class="docutils literal"><span class="pre">--enable-mecab</span></code> オプション付きでコンパイルした場合のみ利用可能である。
バイナリパッケージでもこのプラグインは利用可能である。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">&#8220;create&#8221;を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">arg:</th><td class="field-body">MeCabエンジンに渡す引数を指定する (例えば、以下の例では -d で辞書ファイルのディレクトリを指定している)。この指定がないと、MeCabのデフォルト設定で動作する。
引数の指定の仕方は、 <a class="reference external" href="http://taku910.github.io/mecab/mecab.html">MeCab のドキュメント</a> を参照すること。</td>
</tr>
<tr class="field-odd field"><th class="field-name">ngram:</th><td class="field-body">MeCabによる単語分割の結果に基づいて構築する形態素N-gramの <cite>N</cite> を指定する。
この指定がないと、 <cite>N</cite> に <cite>1</cite> が指定されたものと見なされる (つまり形態素N-gramを構築せず、各形態素をそのまま特徴量として使用する)。
<cite>N</cite> は数値ではなく文字列として指定する点に注意する (以下の例を参照)。</td>
</tr>
<tr class="field-even field"><th class="field-name">base:</th><td class="field-body">各形態素の原形を使用するかどうかを指定する。
原形を使用する場合は <cite>&#8220;true&#8221;</cite> を、表層を使用する場合は <cite>&#8220;false&#8221;</cite> を指定する。
<cite>&#8220;true&#8221;</cite> を指定した場合でも、原形がない形態素 (固有名詞など) については表層を使用する。
この指定がないと、<cite>&#8220;false&#8221;</cite> が指定されたものと見なされる。
<cite>&#8220;true&#8221;</cite>, <cite>&#8220;false&#8221;</cite> は文字列として指定する点に注意する (以下の例を参照)。</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">include_features:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body">使用する形態素のパターンを指定する。
MeCab の形態素解析結果の CSV 表現 (例: <code class="docutils literal"><span class="pre">名詞,固有名詞,組織,*,*,*,*</span></code>) にマッチするパターンを <code class="docutils literal"><span class="pre">string_filter_rules</span></code> の <code class="docutils literal"><span class="pre">key</span></code> と同様のフォーマットで指定する。
例えば、名詞だけを抽出する場合は <code class="docutils literal"><span class="pre">&quot;名詞,*&quot;</span></code> のように指定する。
複数の品詞を使用したい場合は、パターンを <code class="docutils literal"><span class="pre">|</span></code> で区切って指定する (例: <code class="docutils literal"><span class="pre">&quot;名詞,*|動詞,*&quot;</span></code>)。
この指定がないと、<cite>&#8220;*&#8221;</cite> が指定されたものと見なされる (すべての品詞が使用される)。</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">exclude_features:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body">除外する形態素のパターンを指定する。
指定方法は <code class="docutils literal"><span class="pre">include_features</span></code> と同様である。
<code class="docutils literal"><span class="pre">include_features</span></code> と <code class="docutils literal"><span class="pre">exclude_features</span></code> が同時に指定された場合、 <code class="docutils literal"><span class="pre">include_features</span></code> にマッチし <code class="docutils literal"><span class="pre">exclude_features</span></code> にマッチしない品詞のみが抽出される。
この指定がないと、<cite>&#8220;&#8221;</cite> が指定されたものと見なされる (除外を行わない)。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;mecab&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libmecab_splitter.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arg&quot;</span><span class="o">:</span> <span class="s2">&quot;-d /usr/lib64/mecab/dic/ipadic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ngram&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;base&quot;</span><span class="o">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
    <span class="s2">&quot;include_features&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;exclude_features&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<code class="descname">libux_splitter.so</code></dt>
<dd><p>string_typesで指定できる。
<a class="reference external" href="https://github.com/hillbig/ux-trie">ux-trie</a> を利用して、与えられた文書から最長一致で辞書マッチするキーワードを抜き出して、それぞれを特徴量として利用する。
単純な最長一致なので、高速だが精度が悪い可能性がある点には注意すること。
<code class="docutils literal"><span class="pre">--enable-ux</span></code> オプション付きでコンパイルした場合のみ利用可能である。
バイナリパッケージでもこのプラグインは利用可能である。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">&#8220;create&#8221;を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">dict_path:</th><td class="field-body">1行1キーワードで書かれたテキスト形式の辞書ファイルを、フルパスで指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;ux&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libux_splitter.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dict_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/path/to/keyword/dic.txt&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="id15">
<h3>画像特徴量プラグイン<a class="headerlink" href="#id15" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>画像特徴量プラグインではOpenCVプラグインを提供している。</p>
<dl class="describe">
<dt>
<code class="descname">libimage_feature.so</code></dt>
<dd></dd></dl>

<p>binary_typesで指定できる。<a class="reference external" href="https://github.com/opencv">OpenCV</a> を利用して、与えられた画像から特徴量を抜き出して利用する。
<code class="docutils literal"><span class="pre">--enable-opencv</span></code> オプション付きでコンパイルした場合のみ利用可能である。
バイナリパッケージでもこのプラグインは利用可能である。</p>
<blockquote>
<div><blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body"><p class="first">&#8220;create&#8221;を指定する。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">algorithm:</th><td class="field-body"><p class="first">利用する特徴量記述アルゴリズムを指定する。画像特徴量抽出プラグインでは、下記の２つのアルゴリズムを提供している。なお、いずれもキーポイントの抽出はDense sampling (すべての画素について特徴量を抽出する手法) で行っている。</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">&quot;RGB&quot;</span></code></td>
<td>画素のRGB値を抽出する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&quot;ORB&quot;</span></code></td>
<td>パッチ内で選ばれた2点の輝度差によってバイナリ列を作る。詳細は <a class="reference external" href="http://docs.opencv.org/3.1.0/d1/d89/tutorial_py_orb.html">OpenCVドキュメント</a> を参照。</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">resize:</th><td class="field-body"><p class="first">画像をリサイズするかどうかを決定する。リサイズする場合は <cite>&#8220;true&#8221;</cite> を指定し、しない場合は <cite>&#8220;false&#8221;</cite> を指定する。デフォルトでは <cite>&#8220;false&#8221;</cite> が指定される</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">x_size:</th><td class="field-body"><p class="first">画像の幅を指定しリサイズする。 <code class="docutils literal"><span class="pre">resize</span></code> が <cite>&#8220;true&#8221;</cite> のときのみ有効</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">y_size:</th><td class="field-body"><p class="first last">画像の高さを指定しリサイズする。 <code class="docutils literal"><span class="pre">resize</span></code> が <cite>&#8220;true&#8221;</cite> のときのみ有効</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;binary_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;image&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libimage_feature.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;algorithm&quot;</span><span class="o">:</span><span class="s2">&quot;ORB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;resize&quot;</span><span class="o">:</span><span class="s2">&quot;true&quot;</span>
    <span class="s2">&quot;x_size&quot;</span><span class="o">:</span><span class="s2">&quot;120.0&quot;</span>
    <span class="s2">&quot;y_size&quot;</span><span class="o">:</span><span class="s2">&quot;120.0&quot;</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="python-bridge">
<h2>Python Bridge<a class="headerlink" href="#python-bridge" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python Bridge を使用すると、C++ でプラグインを作成しなくても、特徴抽出ロジックを Python で記述することができる。
現在、以下のブリッジインタフェースが利用できる。</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">インタフェース</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">string_feature</span></code></td>
<td>文字列に対する特徴抽出。 (<code class="docutils literal"><span class="pre">string_types</span></code>)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">word_splitter</span></code></td>
<td>文字列に対する特徴抽出 (部分文字列の抽出のみ)。 (<code class="docutils literal"><span class="pre">string_types</span></code>)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">num_feature</span></code></td>
<td>数値に対する特徴抽出。 (<code class="docutils literal"><span class="pre">num_types</span></code>)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">binary_feature</span></code></td>
<td>バリナリデータに対する特徴抽出。 (<code class="docutils literal"><span class="pre">binary_types</span></code>)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="id17">
<h3>設定<a class="headerlink" href="#id17" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python Bridge はプラグイン形式で提供されている。</p>
<dl class="describe">
<dt>
<code class="descname">libpython_bridge.so</code></dt>
<dd><p><code class="docutils literal"><span class="pre">string_types</span></code>, <code class="docutils literal"><span class="pre">num_types</span></code>, <code class="docutils literal"><span class="pre">binary_types</span></code> で指定できる。
<code class="docutils literal"><span class="pre">--enable-python-plugin</span></code> または <code class="docutils literal"><span class="pre">--enable-python3-plugin</span></code> オプション付きでコンパイルした場合のみ利用可能である。
バイナリパッケージ (RHEL 6 を除く) でもこのプラグインは利用可能である。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">上記のインタフェース名を指定する (例: <code class="docutils literal"><span class="pre">string_feature</span></code>)。</td>
</tr>
<tr class="field-even field"><th class="field-name">module:</th><td class="field-body">Pythonモジュール名を指定する。</td>
</tr>
<tr class="field-odd field"><th class="field-name">class:</th><td class="field-body">Pythonモジュール内のクラス名を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;num_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;multiply_by_3&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libpython_bridge.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;num_feature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;number_multiplier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="s2">&quot;NumberMultiplier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;n&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<p>上記に加えて、Pythonクラスに渡す任意のパラメタを指定することができる。
パラメタのキーとバリューは共に文字列型である必要がある。</p>
</div>
<div class="section" id="python">
<h3>Python モジュールに対する共通要件<a class="headerlink" href="#python" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python で特徴抽出ロジックを実装する場合、Pythonクラスをモジュールに定義する必要がある。
以下に例を示す。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyFeatureExtractor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s1">u&#39;key1&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">u&#39;key2&#39;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)]</span>
</pre></div>
</div>
<p>Pythonクラスに対する要件を以下に示す。</p>
<ul class="simple">
<li>クラスは <code class="docutils literal"><span class="pre">create</span></code> クラスメソッドを実装する必要がある。
引数 <code class="docutils literal"><span class="pre">param</span></code> は、設定ファイルで指定されたパラメタ (<code class="docutils literal"><span class="pre">dict</span></code> 型) である。</li>
<li>各クラスは、各インタフェースで要求されているシグネチャのインスタンスメソッドを実装する必要がある。
以下の各セクションを参照のこと。</li>
<li>モジュールは、 <code class="docutils literal"><span class="pre">sys.path</span></code> 内のいずれかのパス、 <code class="docutils literal"><span class="pre">PYTHONPATH</span></code> 環境変数内のいずれかのパス、またはデフォルトの Python モジュールディレクトリ (<code class="docutils literal"><span class="pre">$PREFIX/lib/jubatus/python</span></code>) のいずれかに配置されている必要がある。
バイナリパッケージでインストールした Python Bridge は <code class="docutils literal"><span class="pre">pyenv</span></code> を認識しないため注意すること。
<code class="docutils literal"><span class="pre">pyenv</span></code> でインストールした Python パッケージを利用したい場合は、Jubatus プロセスを開始する前に <code class="docutils literal"><span class="pre">PYTHONPATH</span></code> を定義すること (例: <code class="docutils literal"><span class="pre">export</span> <span class="pre">PYTHONPATH=&quot;$HOME/.pyenv/versions/3.5.1/lib/python3.5/site-packages&quot;</span></code>)。</li>
</ul>
<p>Python コードでエラーが発生した場合は標準エラー出力に出力される。</p>
<p>以下の各セクションでは、Python 3.x の型名で説明を行う。
Python 2.x を使用している場合は、 <code class="docutils literal"><span class="pre">str</span></code> と <code class="docutils literal"><span class="pre">bytes</span></code> は <code class="docutils literal"><span class="pre">unicode</span></code> と <code class="docutils literal"><span class="pre">str</span></code> にそれぞれ読み替えること。</p>
</div>
<div class="section" id="string-feature">
<h3><code class="docutils literal"><span class="pre">string_feature</span></code> インタフェース<a class="headerlink" href="#string-feature" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>クラスにインスタンスメソッド <code class="docutils literal"><span class="pre">extract</span></code> (1 引数) を定義する必要がある。</p>
<ul>
<li><p class="first">引数は入力のテキストである (<code class="docutils literal"><span class="pre">str</span></code> 型)。</p>
</li>
<li><p class="first">戻り値は 4 要素のタプルのリストである。タプルの各要素の意味は以下の通りである。</p>
<blockquote>
<div><ul class="simple">
<li>抽出したデータの開始位置 (<code class="docutils literal"><span class="pre">int</span></code> 型); <code class="docutils literal"><span class="pre">0</span></code> でも良い。</li>
<li>抽出したデータの長さ (<code class="docutils literal"><span class="pre">int</span></code> 型); <code class="docutils literal"><span class="pre">0</span></code> でも良い。</li>
<li>抽出した文字列データ (<code class="docutils literal"><span class="pre">str</span></code> 型)。</li>
<li>抽出した文字列データに対するスコア (<code class="docutils literal"><span class="pre">float</span></code> 型); 通常は <code class="docutils literal"><span class="pre">1.0</span></code> を使用すれば良い。</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span>
</pre></div>
</div>
<p>サンプルとして、英語の文章に対するステミング (Porter Stemmer) を行う実装がデフォルトで提供されている。
詳細は <a class="reference external" href="https://github.com/jubatus/jubatus/blob/master/plugin/src/fv_converter/python_bridge/python/sentence_stemmer.py">sentence_stemmer モジュール</a> のソースを参照すること。
このサンプルを動作させるには <a class="reference external" href="http://www.nltk.org/">Natural Language Toolkit</a> のインストールが必要である (<code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">nltk</span></code>)。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;stem_sentence&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libpython_bridge.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;string_feature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;sentence_stemmer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="s2">&quot;SentenceStemmer&quot;</span>
  <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;stem_sentence&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;tf&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="word-splitter">
<h3><code class="docutils literal"><span class="pre">word_splitter</span></code> インタフェース<a class="headerlink" href="#word-splitter" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>クラスにインスタンスメソッド <code class="docutils literal"><span class="pre">split</span></code> (1 引数) を定義する必要がある。</p>
<ul>
<li><p class="first">引数は入力のテキストである (<code class="docutils literal"><span class="pre">str</span></code> 型)。</p>
</li>
<li><p class="first">戻り値は 2 要素のタプルのリストである。タプルの各要素の意味は以下の通りである。</p>
<blockquote>
<div><ul class="simple">
<li>抽出したデータの開始位置 (<code class="docutils literal"><span class="pre">int</span></code> 型)。</li>
<li>抽出したデータの長さ (<code class="docutils literal"><span class="pre">int</span></code> 型)。</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<p>サンプルとして、空白文字で文章を区切る実装がデフォルトで提供されている。
詳細は <a class="reference external" href="https://github.com/jubatus/jubatus/blob/master/plugin/src/fv_converter/python_bridge/python/space_splitter.py">space_splitter モジュール</a> のソースを参照すること。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;split_by_space&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libpython_bridge.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;word_splitter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;space_splitter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="s2">&quot;SpaceSplitter&quot;</span>
  <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;split_by_space&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;tf&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="num-feature">
<h3><code class="docutils literal"><span class="pre">num_feature</span></code> インタフェース<a class="headerlink" href="#num-feature" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>クラスにインスタンスメソッド <code class="docutils literal"><span class="pre">extract</span></code> (2 引数) を定義する必要がある。</p>
<ul>
<li><p class="first">引数は入力の datum のキー名 (<code class="docutils literal"><span class="pre">str</span></code> 型) とその値 (<code class="docutils literal"><span class="pre">float</span></code> 型) である。</p>
</li>
<li><p class="first">戻り値は 2 要素のタプルのリストである。タプルの各要素の意味は以下の通りである。</p>
<blockquote>
<div><ul class="simple">
<li>特徴次元のキー名 (<code class="docutils literal"><span class="pre">str</span></code> 型)。</li>
<li>そのキー名に対応する値 (<code class="docutils literal"><span class="pre">float</span></code> 型)。</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span>
</pre></div>
</div>
<p>サンプルとして、入力された数値を N 倍に変換する実装がデフォルトで提供されている。
詳細は <a class="reference external" href="https://github.com/jubatus/jubatus/blob/master/plugin/src/fv_converter/python_bridge/python/number_multiplier.py">number_multiplier モジュール</a> のソースを参照すること。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;num_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;multiply_by_3&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libpython_bridge.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;num_feature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;number_multiplier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="s2">&quot;NumberMultiplier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;n&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span>
  <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;num_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;multiply_by_3&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="binary-feature">
<h3><code class="docutils literal"><span class="pre">binary_feature</span></code> インタフェース<a class="headerlink" href="#binary-feature" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>クラスにインスタンスメソッド <code class="docutils literal"><span class="pre">extract</span></code> (2 引数) を定義する必要がある。</p>
<ul>
<li><p class="first">引数は入力の datum のキー名 (<code class="docutils literal"><span class="pre">str</span></code> 型) とその値 (<code class="docutils literal"><span class="pre">bytes</span></code> 型) である。</p>
</li>
<li><p class="first">戻り値は 2 要素のタプルのリストである。タプルの各要素の意味は以下の通りである。</p>
<blockquote>
<div><ul class="simple">
<li>特徴次元のキー名 (<code class="docutils literal"><span class="pre">str</span></code> 型)。</li>
<li>そのキー名に対応する値 (<code class="docutils literal"><span class="pre">float</span></code> 型)。</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">))]</span>
</pre></div>
</div>
<p>サンプルとして、入力されたバイナリデータを特徴として抽出する実装がデフォルトで提供されている。
詳細は <a class="reference external" href="https://github.com/jubatus/jubatus/blob/master/plugin/src/fv_converter/python_bridge/python/binary_length.py">binary_length モジュール</a> のソースを参照すること。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;binary_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;extract_length&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libpython_bridge.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;binary_feature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;binary_length&quot;</span><span class="p">,</span>
    <span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="s2">&quot;BinaryLengthExtractor&quot;</span>
  <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;binary_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;extract_length&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="commands/index.html" class="btn btn-neutral float-right" title="Commands" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="method.html" class="btn btn-neutral" title="アルゴリズム" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2017 PFN &amp; NTT.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>