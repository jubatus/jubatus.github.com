

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>データ変換 &mdash; Jubatus</title>
    <link rel="stylesheet" href="_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.5.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="index.html" />
    <link rel="up" title="ドキュメント" href="documentation.html" />
    <link rel="next" title="プラグインの開発" href="plugin.html" />
    <link rel="prev" title="ドキュメント" href="documentation.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="plugin.html" title="プラグインの開発"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="documentation.html" title="ドキュメント"
             accesskey="P">前へ</a> |</li>
        <li><a href="index.html">Jubatus</a> &raquo;</li>
          <li><a href="documentation.html" accesskey="U">ドキュメント</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">データ変換</a><ul>
<li><a class="reference internal" href="#id2">概要</a></li>
<li><a class="reference internal" href="#datum">Datum</a></li>
<li><a class="reference internal" href="#id3">データ変換の流れ</a></li>
<li><a class="reference internal" href="#id4">フィルター</a><ul>
<li><a class="reference internal" href="#string-filter-types">string_filter_types</a></li>
<li><a class="reference internal" href="#string-filter-rules">string_filter_rules</a></li>
<li><a class="reference internal" href="#num-filter-types">num_filter_types</a></li>
<li><a class="reference internal" href="#num-filter-rules">num_filter_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#construct">文字列からの特徴抽出</a><ul>
<li><a class="reference internal" href="#string-types">string_types</a></li>
<li><a class="reference internal" href="#string-rules">string_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">数値からの特徴抽出</a><ul>
<li><a class="reference internal" href="#num-types">num_types</a></li>
<li><a class="reference internal" href="#num-rules">num_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9">バイナリデータからの特徴抽出</a><ul>
<li><a class="reference internal" href="#binary-types">binary_types</a></li>
<li><a class="reference internal" href="#binary-rules">binary_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">特徴ベクトルのキーのハッシュ化</a></li>
<li><a class="reference internal" href="#conversion-plugin">プラグイン</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="documentation.html"
                        title="前の章へ">ドキュメント</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="plugin.html"
                        title="次の章へ">プラグインの開発</a></p>
  <h3>このページ</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/fv_convert.txt"
           rel="nofollow">ソースコードを表示</a></li>
  </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JubatusOfficial"  data-widget-id="258379257628196864">Tweets by @JubatusOfficial</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="conversion">
<span id="id1"></span><h1>データ変換<a class="headerlink" href="#conversion" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>一般的に機械学習処理を行う場合、テキストなどの生の非定形データ（例えば HTML や Twitter のつぶやき情報など）を直接扱うことはできない。
こうしたデータは事前に特徴抽出というステップを経て、一般に特徴ベクトルと呼ばれる形式に変換される。
Jubatus における特徴ベクトルの中身は、文字列をキー、数値型を値とする key-value 型である。
この変換を行うことで、自然言語のデータ、画像データ、音声データなどの非定型の生データを統一的に扱うことができる。</p>
<p>Jubatus の特徴ベクトル変換器は、この特徴抽出処理を簡単な設定ファイルを書くことで柔軟にカスタマイズすることを可能にする。</p>
<div class="section" id="id2">
<h2>概要<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>データ変換は「フィルター」と「特徴抽出」の 2 段階で行われる。</p>
<p>まず、フィルター処理によって、データを整形する。
この処理は、例えばHTMLテキストのタグを除去したり、学習にとって不要であることが予めわかっている記号列などを取り除く。
その次に、特徴抽出処理によって、フィルターされたデータから特徴を抽出する。</p>
<p>例えば、フィルタリングの結果として、「世の中ではビッグデータというキーワードが注目されていますが、一口にビッグデータといっても立場や観点によって定義は様々です」という文字列が与えられたとする。
ここからキーワードを抽出すると、「ビッグデータ」、「世の中」、「キーワード」、「定義」といった特徴が得られる。
これらの特徴を出現頻度で重み付けをする（出現回数をカウントする）と、「ビッグデータ：2」、「世の中：1」、「キーワード：1」、「定義：1」という結果が得られる。
この一連の流れの中で、与えられた文字列から特徴を抽出し、出現頻度等によって重み付けをするまでの処理を特徴抽出という。</p>
<p>Jubatus では、「フィルタリングでデータからどのような要素を取り除くか」、「特徴抽出でどのように特徴の抽出を行い、どのように重み付けをするか」を、JSON形式の設定ファイルで定義することができる。
一連の処理は、最もシンプルな設定によって多くの場合はうまく動くことが予想される。
以下に最もシンプルな設定を記載する。
この設定を利用すると、文字列データは全てスペース文字で分割してそれぞれの単語を特徴量とし、数値データはその値をそれぞれ特徴量として利用する。
実際にアプリケーションを書くときに、より高い精度の学習結果を求める場合は、設定をチューニングすることで望ましい結果を得られる可能性がある。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;space&quot;</span><span class="p">,</span> <span class="s">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;global_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="s">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span>  <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;num&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="s">&quot;binary_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;binary_rules&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="datum">
<h2>Datum<a class="headerlink" href="#datum" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Jubatusで利用できるデータ形式は、datumと呼ばれる非常にシンプルなkey-valueデータ形式である。
datumには3つのkey-valueが存在する。
一つはキーも値も文字列の文字列データ (string_values) である。
2つ目は、キーは同様に文字列だが、値は数値の数値データ (num_values) である。
最後が、キーは同様に文字列で、値が任意のバイナリデータ（binary_values）である。
string_values には名前、テキスト、職業など、任意のテキストデータを入れることができる。
num_values には年齢、年収、アクセス回数など、任意の数値データを浮動小数点型として入れることができる。
binary_values には画像や音声などのマルチメディアデータなど、任意のバイナリデータを入れることができる。
この3つのデータから、機械学習を行う際に必要となる特徴量を抽出するのが、このデータ変換モジュールである。
また、効率を重視して、それぞれのkey-valueは、各言語のmap型や辞書型を利用せず、keyとvalueのペアの配列で表現される。</p>
<p>以下に例を示す。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/id&quot;</span><span class="p">,</span> <span class="s">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/name&quot;</span><span class="p">,</span> <span class="s">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/age&quot;</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/income&quot;</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/image&quot;</span><span class="p">,</span> <span class="s">&quot;xxxxxxxx&quot;</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>キーの名前に &#8220;$&#8221; 記号を含めることはできない。</p>
<p>例えばC++から利用する場合、datumは <tt class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">std::string&gt;</span> <span class="pre">&gt;</span></tt> 、 <tt class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">double&gt;</span> <span class="pre">&gt;</span></tt> 、 <tt class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">std::string&gt;</span> <span class="pre">&gt;</span></tt> の3つの要素からなっている。
ここでは、 <tt class="docutils literal"><span class="pre">std::pair&lt;T,U&gt;</span></tt> をPython風のタプルで、 <tt class="docutils literal"><span class="pre">std::vector&lt;T&gt;</span></tt> をPython風のリストで表している。</p>
</div>
<div class="section" id="id3">
<h2>データ変換の流れ<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>大まかな処理の流れは以下のようになっている。</p>
<p>datumは文字列データ、数値データ、バイナリデータの3つがあるため、それぞれが別々の処理フローを流れる。</p>
<p>文字列データには、まずstring_filter_rulesが適用されて、フィルター済みデータが追加される。
その状態で、string_rulesによって文字列データからの特徴量が抽出される。</p>
<p>数値データには、まずnum_filter_rulesが適用されて、フィルター済みデータが追加される。
その状態で、num_rulesによって数値データからの特徴量が抽出される。</p>
<p>バイナリデータにはbinary_rulesによって特徴量が抽出される。</p>
<p>フィルターと特徴抽出器には引数を必要とするものもあるため、それらはtypesで事前に準備することによって各規則で利用することができるようになる。</p>
<div class="figure">
<img alt="feature vector converter" src="_images/convert_flow.png" style="width: 90%;" />
<p class="caption">図: 変換エンジンの構成</p>
</div>
</div>
<div class="section" id="id4">
<h2>フィルター<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Jubatusはフィルターという機能を用いて、datum中のkey-valueペアを変換して、別の要素として追加することができる。
例えば、元のデータがHTMLで書かれていたとしよう。
この中のタグ文字列（&lt;a&gt; など）は、学習時には邪魔になることがおおく、そのため予めフィルタリングして使いたいことがある。
あるいは、メール本文の引用（&gt;から始まる行）を削除したいこともあるだろう。
こうした時に利用するのが、filter機能である。</p>
<p>例として、&#8221;message&#8221;内の文字列からHTMLタグを取り除く。
まず、「HTMLタグを取り除く」というルールを定義し、それを <tt class="docutils literal"><span class="pre">key</span> <span class="pre">=</span> <span class="pre">&quot;message&quot;</span></tt> に適用する。
これは、以下のようなconfigで表現される。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;detag&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_filter_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;detag&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;-detagged&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>まず、&#8221;string_filter_types&#8221;でフィルターを定義し、これを &#8220;detag&#8221; と命名する。
&#8220;detag&#8221; フィルターに対して、&#8221;regexp&#8221;という手法で、&#8221;&lt;[^&gt;]*&gt;&#8221;を&#8221;&#8220;に置き換える、というフィルターを定義する。
次に、実際にdatumのどの要素にどう適用するのか書いたのが&#8221;string_filter_rules&#8221;である。
ここでは、&#8221;message&#8221;という名前の&#8221;key&#8221;の要素に対して、先で定義した&#8221;detag&#8221;フィルターを適用し、&#8221;message&#8221;に&#8221;-detagged&#8221;を付与したkey、すなわち&#8221;message-detagged&#8221;に結果を格納することを示している。</p>
<p>また、&#8221;age&#8221;を数え年に変換(+1歳に)するには、</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;num_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;add_1&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;num_filter_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;add_1&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;_kazoe&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>とする。この挙動も先と同じで、&#8221;user/age&#8221;に1加えた結果が&#8221;user/age_kazoe&#8221;に格納される。</p>
<p>これらのfilterを通すことにより、次の datum が得られる:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/id&quot;</span><span class="p">,</span> <span class="s">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/name&quot;</span><span class="p">,</span> <span class="s">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/age&quot;</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/income&quot;</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>それぞれの要素について、詳細に説明する。
なお、これらの各 &#8220;types&#8221; や &#8220;rules&#8221; は省略可能で、省略した場合はそれぞれ何も指定されていないものとして扱われる。</p>
<div class="section" id="string-filter-types">
<h3>string_filter_types<a class="headerlink" href="#string-filter-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>&lt;フィルター名&gt;: &lt;引数&gt;　からなる辞書を指定する。
フィルター名は文字列、引数は文字列から文字列への辞書である。
引数には必ず&#8221;method&#8221;を指定する。
残りの引数に関しては、&#8221;method&#8221;の内容に応じて必要な引数が異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">regexp</tt></dt>
<dd><p>正規表現にマッチした部分を、指定した文字列に変換する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pattern:</th><td class="field-body">マッチさせる正規表現を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">replace:</th><td class="field-body">置き換え後の文字列を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>利用できる正規表現は、使用する正規表現エンジンのドキュメント (<a class="reference external" href="http://www.geocities.jp/kosako3/oniguruma/doc/RE.txt">oniguruma</a> または <a class="reference external" href="http://code.google.com/p/re2/wiki/Syntax">re2</a>) を参照すること。
使用する正規表現エンジンはコンパイル時に選択可能である (バイナリパッケージでインストールした場合は oniguruma が使用される)。</p>
<p>HTMLのすべてのタグを消すには、例えば以下のようなstring_filter_typeを宣言すればよいだろう。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;detag&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。この値はプラグインによって異なる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="string-filter-rules">
<h3>string_filter_rules<a class="headerlink" href="#string-filter-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>フィルターの適用規則を指定する。
規則は指定された順に評価される。
datum がある規則の条件を満たした場合、そのルールが適用され、変換後の値が datum に追加される。
規則は、元の datum と、それまでにフィルター規則で追加された値の両方に適用される。
各規則は&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;, &#8220;suffix&#8221;の要素からなる辞書を指定する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">datumの各要素のどのkeyとマッチさせるかを指定する。詳細は後述する。</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。この詳細は後述する。</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">利用するフィルター名を指定する。これは &#8220;string_filter_types&#8221; の項で作ったフィルター名を指定する。デフォルトで利用できるフィルターはない。</td>
</tr>
<tr class="field-even field"><th class="field-name">suffix:</th><td class="field-body">変換後の結果を格納するkeyのサフィックスを指定する。例えばsuffixに&#8221;-detagged&#8221;が指定され、&#8221;name&#8221;という名前のkeyに規則が適用された場合、結果は&#8221;name-detagged&#8221;という名前のkeyに格納される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;key&#8221;および&#8221;except&#8221;の要素は以下のうちのいずれかのフォーマットで指定する。
但し、datumの全要素に対して、すべての規則が適用されるかチェックされる。
したがって、複数の規則がマッチした場合は両方の規則が適用されて、複数のフィルター済みの値が追加されることに注意する。
なお、&#8221;key&#8221;および&#8221;except&#8221;に関しては以降でも登場するが、全て同じフォーマットであり、複数適用される可能性がある点も同様である。</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;*&#8221; or &#8220;&#8221;</td>
<td>全ての要素にマッチする。&#8221;key&#8221;にこれが指定されると必ず適用されることになる。</td>
</tr>
<tr class="row-odd"><td>&#8220;XXX*&#8221;</td>
<td>末尾に*をつけると、その前のみをプレフィックスとして使用する。つまり、&#8221;XXX&#8221;で始まるkeyのみにマッチする。</td>
</tr>
<tr class="row-even"><td>&#8220;*XXX&#8221;</td>
<td>先頭に*をつけると、その後のみをサフィックスとして使用する。つまり、&#8221;XXX&#8221;で終わるkeyのみにマッチする。</td>
</tr>
<tr class="row-odd"><td>&#8220;/XXX/&#8221;</td>
<td>2つのスラッシュ(/)で囲うと、その間の表現を正規表現とみなして、正規表現でマッチする。</td>
</tr>
<tr class="row-even"><td>その他</td>
<td>以上のいずれでもない場合は、与えられた文字列と一致するkeyのみにマッチする。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;except&#8221; が与えられ、かつ &#8220;key&#8221; と &#8220;except&#8221; の双方にマッチした場合は、そのルールはスキップされる。
例えば、{&#8220;key&#8221;: &#8220;*&#8221;, &#8220;except&#8221;: &#8220;foo&#8221;, ... } のようにすれば「&#8221;foo&#8221; 以外のすべてのキーにマッチする規則」を定義することができる。</p>
</div>
<div class="section" id="num-filter-types">
<h3>num_filter_types<a class="headerlink" href="#num-filter-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>&#8220;string_filter_types&#8221; と同様、&lt;フィルター名&gt;: &lt;引数&gt; からなる辞書を指定する。
利用の仕方はstring_filter_typesとほぼ同じである。
&lt;フィルター名&gt; は文字列、引数は文字列から文字列への辞書である。
&lt;引数&gt; には必ず&#8221;method&#8221;を指定し、残りの引数は&#8221;method&#8221;の値に応じて必要なものが異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">add</tt></dt>
<dd><p>元の値に指定した値を足す。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">value:</th><td class="field-body">足す値の文字列表現を指定する。例えば3足すのであれば、&#8221;3&#8221;と指定する。数値型ではなく文字列として指定する点に注意すること。内部的には Float として利用される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="num-filter-rules">
<h3>num_filter_rules<a class="headerlink" href="#num-filter-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>こちらも、string_filter_rules同様、フィルターの適用規則を指定する。
規則は複数からなり、各規則は&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;, &#8220;suffix&#8221;の要素からなる辞書を指定する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">利用するフィルター名を指定する。これはstring_filter_typesの項で作ったフィルター名を指定する。デフォルトで利用できるフィルターはない。</td>
</tr>
<tr class="field-even field"><th class="field-name">suffix:</th><td class="field-body">変換後の結果を格納するkeyのサフィックスを指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;key&#8221;と&#8221;except&#8221;の指定の仕方は、string_filter_rulesを参照のこと。</p>
</div>
</div>
<div class="section" id="construct">
<span id="id5"></span><h2>文字列からの特徴抽出<a class="headerlink" href="#construct" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>文字列型に対する特徴抽出器と、その抽出規則の適用方法について解説する。</p>
<p>以下に、設定の例を示す。
この例では、&#8221;user/name&#8221;の値はそのまま特徴量として使用し、&#8221;message&#8221;は文字2グラムを特徴量とし、&#8221;message-detagged&#8221;はスペース文字で分割した単語を特徴量とする。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;bigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/name&quot;</span><span class="p">,</span>        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>    <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span>          <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;bigram&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;tf&quot;</span><span class="p">,</span>  <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span>  <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>例えば、この規則を次のような datum に適用する。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/id&quot;</span><span class="p">,</span> <span class="s">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/name&quot;</span><span class="p">,</span> <span class="s">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>結果として得られる特徴抽出結果は、以下のようになる。
&#8220;message&#8221; は &#8220;bigram&#8221; 設定なので2文字ずつに分割され、特徴量 &#8220;H&gt;&#8221; は文字列中に2度出てくるのでその重みは2になることがわかる。</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="37%" />
<col width="23%" />
<col width="8%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">キー</th>
<th class="head">文字列</th>
<th class="head">特徴量</th>
<th class="head">重み</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;user/name&#8221;</td>
<td>&#8220;Loren Ipsum&#8221;</td>
<td>&#8220;Loren Ipsum&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&#8220;message&#8221;</td>
<td>&#8220;&lt;H&gt;Hello World&lt;/H&gt;&#8221;</td>
<td>&#8220;&lt;H&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;H&gt;&#8221;</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;&gt;H&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;He&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;el&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;ll&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;lo&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;o &#8220;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8221; W&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;Wo&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;or&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;rl&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;ld&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;d&lt;&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;&lt;/&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;/H&#8221;</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>&#8220;message-detagged&#8221;</td>
<td>&#8220;Hello World&#8221;</td>
<td>&#8220;Hello&#8221;</td>
<td>1</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&#8220;World&#8221;</td>
<td>1</td>
</tr>
</tbody>
</table>
<div class="section" id="string-types">
<h3>string_types<a class="headerlink" href="#string-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>string_typesで文字列特徴抽出器を定義する。
主に、パスなどの引数を指定しなければならない特徴抽出器は、一度string_typesで指定してから利用しなければならない。
string_filter_typesなどと同様、&lt;抽出器名&gt;:&lt;引数&gt; からなる辞書を指定する。
抽出器名に &#8220;&#64;&#8221; 文字を含むことはできない。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。</p>
<p>指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">ngram</tt></dt>
<dd><p>隣接するN文字を特徴量として利用する。こうした特徴量は文字N-gram特徴と呼ばれる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">char_num:</th><td class="field-body">利用する文字数(整数値)の文字列表現を指定する。文字数は0より大きい必要がある。内部的には Integer として利用される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>例として、連続する2文字およぼ3文字を特徴として利用する、bigramとtrigramを定義する方法を記す。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;bigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span> <span class="p">},</span>
  <span class="s2">&quot;trigram&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">regexp</tt></dt>
<dd><p>与えられた文書から正規表現を利用してキーワードを抜き出して、それぞれを特徴量として利用する。
正規表現マッチは連続的に行われ、マッチした箇所全てを特徴として使う。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pattern:</th><td class="field-body">マッチさせる正規表現を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">group:</th><td class="field-body">キーワードとして取り出すグループを指定する。0ならマッチした全体で、1以上の値を指定すると () で取り出したグループだけをキーワードとする。省略すると0として扱う。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>利用できる正規表現は、使用する正規表現エンジンのドキュメント (<a class="reference external" href="http://www.geocities.jp/kosako3/oniguruma/doc/RE.txt">oniguruma</a> または <a class="reference external" href="http://code.google.com/p/re2/wiki/Syntax">re2</a>) を参照すること。
使用する正規表現エンジンはコンパイル時に選択可能である (バイナリパッケージでインストールした場合は oniguruma が使用される)。</p>
<p>最も簡単な例として、以下では日付表現 (YYYY/MM/DD) を全て取り出す。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;date&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;[0-9]{4}/[0-9]{2}/[0-9]{2}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>パターンの一部だけを利用するときは、 &#8220;group&#8221; 引数を利用する。たとえば、以下の様な設定で年齢が取れるだろう。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;(age|Age)([ :=])([0-9]+)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="string-rules">
<h3>string_rules<a class="headerlink" href="#string-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>文字列特徴の抽出規則を指定する。
string_filter_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;, &#8220;sample_weight&#8221;, &#8220;global_weight&#8221;からなる辞書で指定する。
文字列データの場合、与えられた文字列から特徴量を抽出し、そこに対して重みを設定する必要がある。
重みの設定の仕方を決めるのが、&#8221;sample_weight&#8221;と&#8221;global_weight&#8221;の2つのパラメータである。
実際に利用する重みは、2つの重みの積を重み付けとして利用する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body"><p class="first">datumの各要素のどのkeyとマッチさせるかを指定する。string_filter_rulesを参照のこと。なお、 &#8220;*&#8221; や &#8220;&#8221; を設定した場合、フィルタ処理前の要素も特徴抽出対象となるため注意する。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body"><p class="first">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body"><p class="first">利用する抽出器名を指定する。これはstring_typesの項で作った抽出器名を指定する。また、以下の抽出器はデフォルトで利用できる。</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;str&quot;</span></tt></td>
<td>文字列分割を行わず、指定された文字列そのものを特徴として利用する。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;space&quot;</span></tt></td>
<td>スペース文字で分割を行い、分割された部分文字列を特徴として利用する。</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="field-even field"><th class="field-name">sample_weight:</th><td class="field-body"><p class="first">各key-value毎の重み設定の仕方を指定する。これはkey-value一つに対して決定される重みである。</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;bin&quot;</span></tt></td>
<td>重みを常に1とする。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;tf&quot;</span></tt></td>
<td>与えられた文字列中で出現する回数で重み付けをする。例えば5回&#8221;hello&#8221;が出現したら、重みを5にする。</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;log_tf&quot;</span></tt></td>
<td>tfの値に1を足してlogを取った値を重み付けに利用する。例えば5回&#8221;hello&#8221;が出現したら、重みはlog(5 + 1)にする。</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">global_weight:</th><td class="field-body"><p class="first">今までの通算データから算出される、大域的な重み付けを指定する。</p>
<table border="1" class="last docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;bin&quot;</span></tt></td>
<td>重みを常に1とする。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;idf&quot;</span></tt></td>
<td>文書正規化頻度の逆数の対数を利用する。例えば文書1000件中で50件にその特徴が含まれた場合、重みはlog(1000/50)にする。大まかには出現頻度の少ない特徴ほど大きな重みが設定される。</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>sample_weightとglobal_weightは、ともにbinにしておいても通常のケースでは正しく動作する。
また、例えば分類問題など重み自体を学習するケースでは、ともにbinにしておいても自動的に調整される。</p>
</div>
</div>
<div class="section" id="id8">
<h2>数値からの特徴抽出<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>数値型に対しても、文字列型同様変換ルールを記述する。
また、数値型に関しても、ユーザー定義の変換器を定義することができる。</p>
<p>以下に、設定の例を示す。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;num_types&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="p">},</span>
<span class="s2">&quot;num_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age&quot;</span><span class="p">,</span>       <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/income&quot;</span><span class="p">,</span>    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>例えば、この規則を次のような datum に適用する。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span>
  <span class="p">[],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/age&quot;</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/income&quot;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>結果として得られる特徴抽出結果は、以下のようになる。</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="32%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">キー</th>
<th class="head">値</th>
<th class="head">重み</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;user/age&#8221;</td>
<td>29</td>
<td>29</td>
</tr>
<tr class="row-odd"><td>&#8220;user/income&#8221;</td>
<td>100000</td>
<td>log(100000) = 5</td>
</tr>
<tr class="row-even"><td>&#8220;user/age_kazoe&#8221;</td>
<td>30</td>
<td>30</td>
</tr>
</tbody>
</table>
<div class="section" id="num-types">
<h3>num_types<a class="headerlink" href="#num-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>num_typesで数値データに対する特徴抽出器を定義する。
string_typesなどと同様、&lt;抽出器名&gt;: &lt;引数&gt; からなる辞書を指定する。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="num-rules">
<h3>num_rules<a class="headerlink" href="#num-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>数値特徴の抽出規則を指定する。
string_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;からなる辞書で指定する。
重みの付け方や特徴名の指定の仕方もそれぞれの&#8221;type&#8221;ごとに異なる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body"><p class="first">datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。なお、&#8221;*&#8221; や &#8220;&#8221; を設定した場合、フィルタ処理前の要素も特徴抽出対象となるため注意する。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body"><p class="first">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body"><p class="first">利用する抽出器名を指定する。これはnum_typesの項で作った抽出器名を指定する。ただし、以下の抽出器はデフォルトで利用できる。</p>
<table border="1" class="last docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;num&quot;</span></tt></td>
<td>与えられた数値をそのまま重みに利用する。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;log&quot;</span></tt></td>
<td>与えられた数値の対数を重みに利用する。但し、数値が1以下の場合は0とする。</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;str&quot;</span></tt></td>
<td>与えられた数値を文字列として扱う。これは、例えばIDなど、数値自体の大きさに意味のないデータに対して利用する。重みは1とする。</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="id9">
<h2>バイナリデータからの特徴抽出<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="binary-types">
<h3>binary_types<a class="headerlink" href="#binary-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>binary_typesでバイナリデータに対する特徴抽出器を定義する。
string_typesなどと同様、 &lt;抽出器名&gt;: &lt;引数&gt; からなる辞書を指定する。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインのパスを指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="binary-rules">
<h3>binary_rules<a class="headerlink" href="#binary-rules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>バイナリ特徴の抽出規則を指定する。
string_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key&#8221;, &#8220;except&#8221; (オプション), &#8220;type&#8221;からなる辞書で指定する。
重みの付け方や特徴名の指定の仕方もそれぞれの&#8221;type&#8221;ごとに異なる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">key のマッチから除外するパターンを指定する。このパラメタは省略可能である。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">利用する抽出器名を指定する。これはbinary_typesの項で作った抽出器名を指定する。デフォルトで利用できる特徴抽出器はないため、必ずbinary_typesで指定する必要がある。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="id10">
<h2>特徴ベクトルのキーのハッシュ化<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Jubatus では特徴ベクトルのキーをハッシュ化することでメモリ消費を抑えることができる。
特徴ベクトルのキーをハッシュ化することで、特徴ベクトルの次元数の最大長を制限することができるが、ハッシュの衝突により学習精度の低下が発生する可能性がある。</p>
<p>この機能はデフォルトでは無効である。
使用するには、変換設定に <tt class="docutils literal"><span class="pre">hash_max_size</span></tt> を指定する。値には0より大きい整数値を指定する。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;global_weight&quot;</span> <span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">}],</span>
  <span class="s">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&quot;key&quot;</span> <span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;num&quot;</span><span class="p">}],</span>
  <span class="s">&quot;binary_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;binary_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;hash_max_size&quot;</span><span class="p">:</span> <span class="mi">16</span>
<span class="p">}</span>
</pre></div>
</div>
<p>最適な <tt class="docutils literal"><span class="pre">hash_max_size</span></tt> の値は、使用するデータセットおよび環境により異なる。
<tt class="docutils literal"><span class="pre">hash_max_size</span></tt> が制限するのは入力される datum のキー数ではなく、(変換後の) 特徴ベクトルのキー数であることに注意する。</p>
</div>
<div class="section" id="conversion-plugin">
<span id="id11"></span><h2>プラグイン<a class="headerlink" href="#conversion-plugin" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>フィルターと抽出器では、それぞれプラグインを利用することができる。
プラグインは単体の動的ライブラリファイル（.soファイル）からなる。
プラグインの作り方は、別の章を参照するとして、ここではプラグインの使い方について解説する。</p>
<p>各フィルターと抽出器のいずれの場合も、プラグインの指定の仕方は同じである。
CLASS_types (CLASS は <tt class="docutils literal"><span class="pre">string</span></tt> または <tt class="docutils literal"><span class="pre">num</span></tt>) で、フィルターや抽出器を指定する際のパラメータで、&#8221;method&#8221;に&#8221;dynamic&#8221;を、&#8221;path&#8221;に.soファイルへのパスを、&#8221;function&#8221;に各プラグイン固有の呼び出し関数名を指定する。
プラグインのパスは、原則としてフルパスであるが、デフォルトのプラグインディレクトリ (多くの場合は <tt class="docutils literal"><span class="pre">$PREFIX/lib/jubatus/plugin</span></tt> または <tt class="docutils literal"><span class="pre">$PREFIX/lib64/jubatus/plugin</span></tt>) に格納されているプラグインについてはファイル名のみで指定することもできる。
また、その他のパラメータに関しては、各プラグイン固有のパラメータを渡す。</p>
<p>Jubatusでは、デフォルトで以下の2つの文字列特徴量のプラグインが提供されている。
ただし、コンパイルオプションによっては一部のプラグインがビルドされないため、注意すること。</p>
<dl class="describe">
<dt>
<tt class="descname">libmecab_splitter.so</tt></dt>
<dd><p>string_typesで指定できる。
<a class="reference external" href="http://code.google.com/p/mecab/">MeCab</a> を利用して文書を単語分割し、各単語を特徴量として利用する。
<tt class="docutils literal"><span class="pre">--enable-mecab</span></tt> オプション付きでコンパイルした場合のみ利用可能である。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">&#8220;create&#8221;を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">arg:</th><td class="field-body">MeCabエンジンに渡す引数を指定する (例えば、以下の例では -d で辞書ファイルのディレクトリを指定している)。この指定がないと、MeCabのデフォルト設定で動作する。
引数の指定の仕方は、 <a class="reference external" href="http://mecab.googlecode.com/svn/trunk/mecab/doc/mecab.html">MeCab のドキュメント</a> を参照すること。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;mecab&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libmecab_splitter.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arg&quot;</span><span class="o">:</span> <span class="s2">&quot;-d /usr/lib64/mecab/dic/ipadic&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">libux_splitter.so</tt></dt>
<dd><p>string_typesで指定できる。
<a class="reference external" href="http://code.google.com/p/ux-trie/">ux-trie</a> を利用して、与えられた文書から最長一致で辞書マッチするキーワードを抜き出して、それぞれを特徴量として利用する。
単純な最長一致なので、高速だが精度が悪い可能性がある点には注意すること。
<tt class="docutils literal"><span class="pre">--enable-ux</span></tt> オプション付きでコンパイルした場合のみ利用可能である。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">&#8220;create&#8221;を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">dict_path:</th><td class="field-body">1行1キーワードで書かれたテキスト形式の辞書ファイルを、フルパスで指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;ux&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libux_splitter.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dict_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/path/to/keyword/dic.txt&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="plugin.html" title="プラグインの開発"
             >次へ</a> |</li>
        <li class="right" >
          <a href="documentation.html" title="ドキュメント"
             >前へ</a> |</li>
        <li><a href="index.html">Jubatus</a> &raquo;</li>
          <li><a href="documentation.html" >ドキュメント</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2014 PFI &amp; NTT.
      このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3 で生成しました。
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>