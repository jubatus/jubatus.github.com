

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Data Conversion &mdash; Jubatus 0.2.2 documentation</title>
    <link rel="stylesheet" href="_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Jubatus 0.2.2 documentation" href="index.html" />
    <link rel="up" title="Documentation" href="documentation.html" />
    <link rel="next" title="Plugin Develpment" href="plugin.html" />
    <link rel="prev" title="Client generation using IDL generator" href="idl.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plugin.html" title="Plugin Develpment"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="idl.html" title="Client generation using IDL generator"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Jubatus 0.2.2 documentation</a> &raquo;</li>
          <li><a href="documentation.html" accesskey="U">Documentation</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Data Conversion</a><ul>
<li><a class="reference internal" href="#datum">datum</a></li>
<li><a class="reference internal" href="#filter">filter</a><ul>
<li><a class="reference internal" href="#string-filter-types">string_filter_types</a></li>
<li><a class="reference internal" href="#string-filter-rules">string_filter_rules</a></li>
<li><a class="reference internal" href="#num-filter-types">num_filter_types</a></li>
<li><a class="reference internal" href="#num-filter-rules">num_filter_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#feature-exctraction-from-string">feature exctraction (from string)</a><ul>
<li><a class="reference internal" href="#string-types">string_types</a></li>
<li><a class="reference internal" href="#string-rules">string_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#feature-extraction-from-number">feature extraction (from number)</a><ul>
<li><a class="reference internal" href="#num-types">num_types</a></li>
<li><a class="reference internal" href="#num-rules">num_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin">plugin</a></li>
<li><a class="reference internal" href="#overview-of-data-conversion">overview of data conversion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="idl.html"
                        title="previous chapter">Client generation using IDL generator</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plugin.html"
                        title="next chapter">Plugin Develpment</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/fv_convert.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<script src="http://widgets.twimg.com/j/2/widget.js"></script>
<script>
new TWTR.Widget({
  version: 2,
  type: 'profile',
  rpp: 4,
  interval: 30000,
  width: 220,
  height: 300,
  theme: {
    shell: {
      background: '#333333',
      color: '#ffffff'
    },
    tweets: {
      background: '#000000',
      color: '#ffffff',
      links: '#4aed05'
    }
  },
  features: {
    scrollbar: false,
    loop: false,
    live: false,
    behavior: 'all'
  }
}).render().setUser('JubatusOfficial').start();
</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="data-conversion">
<span id="conversion"></span><h1>Data Conversion<a class="headerlink" href="#data-conversion" title="Permalink to this headline">¶</a></h1>
<p>一般的に機械学習処理を行う場合、テキストなどの生の非定形データを直接扱うことはできない。
こうしたデータは事前に特徴抽出というステップを経て、俗に特徴ベクトルと呼ばれる形式に変換される。
特徴ベクトルの中身は、文字列をキー、数値型を値とするkey-value型としてよい。
この変換を行うことで、自然言語のデータ、画像データ、音声データなどの非定型の生データを統一的に扱うことができる。
Jubatusのデータ変換エンジンは、この特徴抽出処理を簡単な設定ファイルを書くことで柔軟にカスタマイズすることを可能にする。</p>
<p>データ変換は2段階に行われる。
まず、フィルター処理によって、データを整形する。
この処理は、例えばHTMLテキストのタグを除去したり、学習にとって不要であることが予めわかっている記号列などを取り除く。
その次に、特徴抽出処理によって、非定形データから特徴を抽出する。</p>
<p>一連の処理は、最もシンプルな設定によって多くの場合はうまく動くことが予想される。
以下に最もシンプルな設定を記載する。
この設定を利用すると、文字列データは全てスペース文字で分割してそれぞれの単語を特徴量とし、数値データはその値をそれぞれ特徴量として利用する。
実際にアプリケーションを書くときに、より高い精度の学習結果を求める場合は、設定をチューニングすることで望ましい結果を得られる可能性がある。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_rules&quot;</span><span class="p">:</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;space&quot;</span><span class="p">,</span>
      <span class="s">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;global_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span> <span class="p">}</span>
    <span class="p">],</span>
  <span class="s">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span>  <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;num&quot;</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="datum">
<h2>datum<a class="headerlink" href="#datum" title="Permalink to this headline">¶</a></h2>
<p>Jubatusで利用できるデータ形式は、datumと呼ばれる非常にシンプルなkey-valueデータ形式である。
datumには2つのkey-valueが存在する。
一つはキーも値も文字列の文字列データ (string_values) である。
もう一方は、キーは同様に文字列だが、値は数値の数値データ (num_values) である。
前者には名前、テキスト、職業など、任意のテキストデータを入れることができる。
後者には年齢、年収、アクセス回数など、任意の数値データを入れることができる。
この2つのデータから、機械学習を行う際に必要となる特徴量を抽出するのが、このデータ変換モジュールである。
また、効率を重視して、それぞれのkey-valueは、各言語のmap型や辞書型を利用せず、keyとvalueのペアの配列で表現される。
以下に例を示す。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;user/id&quot;</span><span class="p">,</span> <span class="s">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/name&quot;</span><span class="p">,</span> <span class="s">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">)</span> <span class="p">],</span>
  <span class="p">[</span> <span class="p">(</span><span class="s">&quot;user/age&quot;</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span> <span class="p">,</span>
    <span class="p">(</span><span class="s">&quot;user/income&quot;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<p>例えばC++から利用する場合、datumは <tt class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">std::string&gt;</span> <span class="pre">&gt;</span></tt> と、 <tt class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::stirng,</span> <span class="pre">double&gt;</span> <span class="pre">&gt;</span></tt> の2つの要素からなっている。
ここでは、 <tt class="docutils literal"><span class="pre">std::pair&lt;T,U&gt;</span></tt> をPython風のタプルで、 <tt class="docutils literal"><span class="pre">std::vector&lt;T&gt;</span></tt> をPython風のリストで表している。</p>
</div>
<div class="section" id="filter">
<h2>filter<a class="headerlink" href="#filter" title="Permalink to this headline">¶</a></h2>
<p>Jubatusはフィルターという機能を用いて、datum中のkey-valueペアを変換して、別の要素として追加することができる。
例えば、元のデータがHTMLで書かれていたとしよう。
この中のタグ文字列（&lt;a&gt; など）は、学習時には邪魔になることがおおく、そのため予めフィルタリングして使いたいことがある。
あるいは、メール本文の引用（&gt;から始まる行）を削除したいこともあるだろう。
こうした時に利用するのが、filter機能である。</p>
<p>例として、&#8221;message&#8221;内の文字列からHTMLタグを取り除く。
まず、「HTMLタグを取り除く」というルールを定義し、それを <tt class="docutils literal"><span class="pre">key</span> <span class="pre">=</span> <span class="pre">&quot;message&quot;</span></tt> に適用する。
これは、以下のようなconfigで表現される。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;detag&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_filter_rules&quot;</span><span class="o">:</span>
<span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;detag&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;-detagged&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>まず、&#8221;string_filter_types&#8221;でフィルターを定義する。
&#8220;detag&#8221;という名前のフィルターに対して、&#8221;regexp&#8221;という手法で、&#8221;&lt;[^&gt;]*&gt;&#8221;を&#8221;&#8220;に置き換える、というフィルターを定義する。
次に、実際にdatumのどの要素にどう適用するのか書いたのが&#8221;string_filter_rules&#8221;である。
ここでは、&#8221;message&#8221;という名前の&#8221;key&#8221;の要素に対して、先で定義した&#8221;detag&#8221;フィルターを適用し、&#8221;message&#8221;に&#8221;-detagged&#8221;を付与したkey、すなわち&#8221;message-detagged&#8221;に結果を格納することを示している。</p>
<p>また、&#8221;age&#8221;を数え年に変換(+1歳に)するには、</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;num_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;add_1&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;num_filter_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;add_1&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;_kazoe&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>とする。この挙動も先と同じで、&#8221;user/age&#8221;に1加えた結果が&#8221;user/age_kazoe&#8221;に格納される。</p>
<p>これらのfilterを通すことにより</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;user/id&quot;</span><span class="p">,</span> <span class="s">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/name&quot;</span><span class="p">,</span> <span class="s">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span> <span class="p">],</span>
  <span class="p">[</span> <span class="p">(</span><span class="s">&quot;user/age&quot;</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="p">,</span>
    <span class="p">(</span><span class="s">&quot;user/income&quot;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<p>が得られる。</p>
<p>それぞれの要素について、詳細に説明する。</p>
<div class="section" id="string-filter-types">
<h3>string_filter_types<a class="headerlink" href="#string-filter-types" title="Permalink to this headline">¶</a></h3>
<p>&lt;フィルター名&gt;: &lt;引数&gt;　からなる辞書を指定する。
フィルター名は文字列、引数は文字列から文字列への辞書である。
引数には必ず&#8221;method&#8221;を指定する。
残りの引数に関しては、&#8221;method&#8221;の内容に応じて必要な引数が異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">regexp</tt></dt>
<dd><p>正規表現にマッチした部分を、指定した文字列に変換する。このフィルターは&#8211;disable-re2付きでコンパイルすると利用できない。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pattern:</th><td class="field-body">マッチさせる正規表現を指定する。re2を利用するため、利用できる表現はre2のマニュアルを参照する。</td>
</tr>
<tr class="field-even field"><th class="field-name">replace:</th><td class="field-body">置き換え後の文字列を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>HTMLのすべてのタグを消すには、例えば以下のようなtypeを宣言すればよいだろう。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;detag&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインの場所をフルパスで指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="string-filter-rules">
<h3>string_filter_rules<a class="headerlink" href="#string-filter-rules" title="Permalink to this headline">¶</a></h3>
<p>フィルターの適用規則を指定する。
規則は複数からなり、順番に条件を満たすかどうかチェックされて、実行される。
各規則は&#8221;key&#8221;, &#8220;type&#8221;, &#8220;suffix&#8221;の要素からなる辞書を指定する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">datumの各要素のどのkeyとマッチさせるかを指定する。詳細は後述。</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body">利用するフィルター名を指定する。これはstring_filter_typesの項で作ったフィルター名を指定する。デフォルトで利用できるフィルターはない。</td>
</tr>
<tr class="field-odd field"><th class="field-name">suffix:</th><td class="field-body">変換後の結果を格納するkeyのサフィックスを指定する。例えばsuffixに&#8221;-detagged&#8221;が指定され、&#8221;name&#8221;という名前のkeyに規則が適用された場合、結果は&#8221;name-detagged&#8221;という名前のkeyに格納される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;key&#8221;の要素は以下の内のいずれかのフォーマットで指定する。
但し、datumの全要素に対して、すべての規則が適用されるかチェックされる。
したがって、複数の規則がマッチした場合は両方の規則が適用されて、複数のフィルター済みの値が追加されることに注意する。
なお、&#8221;key&#8221;に関しては移行でも登場するが、全て同じフォーマットであり、複数適用される可能性がある点も同様である。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">&#8220;*&#8221; or &#8220;&#8221;:</th><td class="field-body">全ての要素にマッチする。&#8221;key&#8221;にこれが指定されると必ず適用されることになる。</td>
</tr>
<tr class="field-even field"><th class="field-name">&#8220;XXX*&#8221;:</th><td class="field-body">末尾に*をつけると、その前のみをプレフィックスとして使用する。つまり、&#8221;XXX&#8221;で始まるkeyのみにマッチする。</td>
</tr>
<tr class="field-odd field"><th class="field-name">&#8220;*XXX&#8221;:</th><td class="field-body">先頭に*をつけると、その後のみをサフィックスとして使用する。つまり、&#8221;XXX&#8221;で終わるkeyのみにマッチする。</td>
</tr>
<tr class="field-even field"><th class="field-name">&#8220;/XXX/&#8221;:</th><td class="field-body">2つのスラッシュ(/)で囲うと、その間の表現を正規表現とみなして、正規表現でマッチする。&#8211;disable-re2付きでコンパイルすると利用できない。</td>
</tr>
<tr class="field-odd field"><th class="field-name">その他:</th><td class="field-body">以上のいずれでもない場合は、与えられた文字列と一致するkeyのみにマッチする。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="num-filter-types">
<h3>num_filter_types<a class="headerlink" href="#num-filter-types" title="Permalink to this headline">¶</a></h3>
<p>string_filter_typesと同様、&lt;フィルター名&gt;: &lt;引数&gt;　からなる辞書を指定する。
利用の仕方はstring_filter_typesとほぼ同じである。
フィルター名は文字列、引数は文字列から文字列への辞書である。
引数には必ず&#8221;method&#8221;を指定し、残りの引数は&#8221;method&#8221;の値に応じて必要なものが異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">add</tt></dt>
<dd><p>元の値に指定した値を足す。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">value:</th><td class="field-body">足す値の文字列表現を指定する。例えば3足すのであれば、&#8221;3&#8221;と指定する。数値型として指定してはならない。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインの場所をフルパスで指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="num-filter-rules">
<h3>num_filter_rules<a class="headerlink" href="#num-filter-rules" title="Permalink to this headline">¶</a></h3>
<p>こちらも、string_filter_rules同様、フィルターの適用規則を指定する。
規則は複数からなり、各規則は&#8221;key&#8221;, &#8220;type&#8221;, &#8220;suffix&#8221;の要素からなる辞書を指定する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body">利用するフィルター名を指定する。これはstring_filter_typesの項で作ったフィルター名を指定する。デフォルトで利用できるフィルターはない。</td>
</tr>
<tr class="field-odd field"><th class="field-name">suffix:</th><td class="field-body">変換後の結果を格納するkeyのサフィックスを指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;key&#8221;の指定の仕方は、string_filter_rulesを参照のこと。</p>
</div>
</div>
<div class="section" id="feature-exctraction-from-string">
<span id="construct"></span><h2>feature exctraction (from string)<a class="headerlink" href="#feature-exctraction-from-string" title="Permalink to this headline">¶</a></h2>
<p>文字列型に対する特徴抽出器と、その抽出規則の適用方法について解説する。
以下に、設定の例を示す。
この例では、&#8221;user/name&#8221;の値はそのまま特徴量として使用し、&#8221;message&#8221;は文字2グラムを特徴量とし、&#8221;message-detagged&#8221;はスペース文字で分割した単語を特徴量とする。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;bigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_rules&quot;</span><span class="o">:</span>
<span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/name&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;bigram&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;tf&quot;</span><span class="p">,</span>  <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span>  <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="string-types">
<h3>string_types<a class="headerlink" href="#string-types" title="Permalink to this headline">¶</a></h3>
<p>string_typesで文字列特徴抽出器を定義します。主に、パスなどの引数を指定しなければならない特徴抽出器は、一度string_typesで指定してから利用しなければならない。
string_filter_typesなどと同様、&lt;抽出器名&gt;: &lt;引数&gt;　からなる辞書を指定する。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">ngram</tt></dt>
<dd><p>隣接するN文字を特徴量として利用する。こうした特徴量は文字N-gram特徴と呼ばれる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">char_num:</th><td class="field-body">利用する文字数の文字列表現を指定する。文字数は0より大きい必要がある。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>例として、連続する2文字およぼ3文字を特徴として利用する、bigramとtrigramを定義する方法を記す。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;bigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span> <span class="p">},</span>
    <span class="s2">&quot;trigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span> <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインの場所をフルパスで指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="string-rules">
<h3>string_rules<a class="headerlink" href="#string-rules" title="Permalink to this headline">¶</a></h3>
<p>文字列特徴の抽出規則を指定する。
string_filter_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key&#8221;, &#8220;type&#8221;, &#8220;sample_weight&#8221;, &#8220;global_weight&#8221;からなる辞書で指定する。
文字列データの場合、与えられた文字列から特徴量を抽出し、そこに対して重みを設定する必要がある。
重みの設定の仕方を決めるのが、&#8221;sample_weight&#8221;と&#8221;global_weight&#8221;の2つのパラメータである。
実際に利用する重みは、2つの重みの積を重み付けとして利用する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body"><p class="first">datumの各要素のどのkeyとマッチさせるかを指定する。string_filter_rulesを参照。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body"><p class="first">利用する抽出器名を指定する。これはstring_typesの項で作った抽出器名を指定する。また、以下の抽出器はデフォルトで利用できる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">str:</th><td class="field-body">文字列分割を行わず、指定された文字列そのものを特徴として利用する。</td>
</tr>
<tr class="field-even field"><th class="field-name">space:</th><td class="field-body">スペース文字で分割を行い、分割された部分文字列を特徴として利用する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">sample_weight:</th><td class="field-body"><p class="first">各key-value毎の重み設定の仕方を指定する。これはkey-value一つに対して決定される重みである。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">bin:</th><td class="field-body">重みを常に1とする。</td>
</tr>
<tr class="field-even field"><th class="field-name">tf:</th><td class="field-body">与えられた文字列中で出現する回数で重み付けをする。例えば5回&#8221;hello&#8221;が出現したら、重みを5にする、などである。</td>
</tr>
<tr class="field-odd field"><th class="field-name">log_tf:</th><td class="field-body">tfの値に1を足してlogを取った値を重み付けに利用する。例えば5回&#8221;hello&#8221;が出現したら、重みはlog(5 + 1)にする、などである。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">global_weight:</th><td class="field-body"><p class="first">今までの通算データをから算出される、大域的な重み付けを指定する。</p>
<blockquote class="last">
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">bin:</th><td class="field-body">重みを常に1とする。</td>
</tr>
<tr class="field-even field"><th class="field-name">idf:</th><td class="field-body">文書正規化頻度の逆数の対数を利用する。例えば文書1000件中で50件にその特徴が含まれた場合、重みはlog(1000/50)にする、などである。大まかには出現頻度の少ない特徴ほど大きな重みが設定される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>sample_weightとglobal_weightは、ともにbinにしておいても通常のケースでは正しく動作する。
また、例えば分類問題など重み自体を学習するケースでは、ともにbinにしておいても自動的に調整される。</p>
</div>
</div>
<div class="section" id="feature-extraction-from-number">
<h2>feature extraction (from number)<a class="headerlink" href="#feature-extraction-from-number" title="Permalink to this headline">¶</a></h2>
<p>数値型に対しても、文字列型同様変換ルールを記述する。
また、数値型に関しても、ユーザー定義の変換器を定義することができる。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;num_types&quot;</span><span class="o">:</span>
<span class="p">{},</span>
<span class="s2">&quot;num_rules&quot;</span><span class="o">:</span>
<span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/income&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">}</span>
<span class="p">]}</span>
</pre></div>
</div>
<div class="section" id="num-types">
<h3>num_types<a class="headerlink" href="#num-types" title="Permalink to this headline">¶</a></h3>
<p>num_typesで数値データに対しる特徴抽出器を定義する。
string_typesなどと同様、&lt;抽出器名&gt;: &lt;引数&gt;　からなる辞書を指定する。
引数は文字列から文字列への辞書で、必ず&#8221;method&#8221;を指定する必要がある。
それ以外に必要な引数は&#8221;method&#8221;に応じて異なる。
指定できる&#8221;method&#8221;の値と、それぞれに対応した引数は以下のとおりである。</p>
<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>プラグインを利用する。詳細は後述する。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">プラグインの場所をフルパスで指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">プラグインの呼び出し関数を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="num-rules">
<h3>num_rules<a class="headerlink" href="#num-rules" title="Permalink to this headline">¶</a></h3>
<p>数値特徴の抽出規則を指定する。
string_rulesなどと同様、複数の規則を羅列する。
各規則は、&#8221;key&#8221;, &#8220;type&#8221;からなる辞書で指定する。
重みの付け方や特徴名の指定の仕方もそれぞれの&#8221;type&#8221;ごとに異なる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body"><p class="first">datumの各要素のどのkeyとマッチさせるかを指定する。詳細はstring_filter_rulesを参照のこと。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body"><p class="first">利用する抽出器名を指定する。これはnum_typesの項で作った抽出器名を指定する。ただし、以下の抽出器はデフォルトで利用できる。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">num:</th><td class="field-body">与えられた数値をそのまま重みに利用する。</td>
</tr>
<tr class="field-even field"><th class="field-name">log:</th><td class="field-body">与えられた数値の対数を重みに利用する。但し、数値が1以下の場合は0とする。</td>
</tr>
<tr class="field-odd field"><th class="field-name">str:</th><td class="field-body">与えられた数値を文字列として扱う。これは、例えばIDなど、数値自体の大きさに意味のないデータに対して利用する。重みは1とする。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">suffix:</th><td class="field-body"><p class="first last">変換後の結果を格納するkeyのサフィックスを指定する。</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="plugin">
<span id="conversion-plugin"></span><h2>plugin<a class="headerlink" href="#plugin" title="Permalink to this headline">¶</a></h2>
<p>以上のフィルターと抽出器は、それぞれプラグインを作ったり、利用することができる。
プラグインは単体の動的ライブラリファイル（.soファイル）からなる。
プラグインの作り方は、別の章を参照するとして、ここではプラグインの使い方について解説する。</p>
<p>各フィルターと抽出器のいずれの場合も、プラグインの指定の仕方は同じである。
XXX_typesで、フィルターや抽出器を指定する際のパラメータで、&#8221;method&#8221;に&#8221;dynamic&#8221;を、&#8221;path&#8221;に.soファイルへのフルパスを、&#8221;function&#8221;に各プラグイン固有の呼び出し関数名を指定する。
また、その他のパラメータに関しては、各プラグイン固有のパラメータを渡す。</p>
<p>Jubatusでは最初から以下の2つの文字列特徴量のプラグインが存在する。
ただし、それぞれコンパイルオプションで指定しないとコンパイルされないので注意すること。</p>
<dl class="describe">
<dt>
<tt class="descname">libmecab_splitter.so</tt></dt>
<dd><p>string_typesで指定できる。
MeCabを利用して、与えられば文書を単語分割し、各単語を特徴量として利用する。&#8211;enable-mecabオプション付きでコンパイルすると、/usr/local/lib以下に作成される。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">&#8220;create&#8221;を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">arg:</th><td class="field-body">MeCabエンジンに渡す引数を指定する。この指定がないと、何もMeCabのデフォルト設定で動作する。引数の指定の仕方は、MeCabのマニュアルを参照する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span>
<span class="p">{</span> <span class="s2">&quot;mecab&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
             <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;/usr/local/lib/libmecab_splitter.so&quot;</span><span class="p">,</span>
             <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
             <span class="s2">&quot;arg&quot;</span><span class="o">:</span> <span class="s2">&quot;-d /path/to/mecab/dic&quot;</span> <span class="p">}</span> <span class="p">},</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">libux_splitter.so</tt></dt>
<dd><p>string_typesで指定できる。ux-trieを利用して、与えられた文書から最長一致で辞書マッチするキーワードを抜き出して、それぞれを特徴量として利用する。単純な最長一致なので、高速だが精度が悪い可能性がある点には注意すること。&#8211;enable-uxオプション付きでコンパイルすると、/usr/local/lib以下に作成される。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">&#8220;create&#8221;を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">dict_path:</th><td class="field-body">1行1キーワードで書かれた辞書ファイルの場所を、フルパスで指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span>
<span class="p">{</span> <span class="s2">&quot;ux&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
          <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;/usr/local/lib/libmecab_splitter.so&quot;</span><span class="p">,</span>
          <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
          <span class="s2">&quot;dict_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/path/to/keyword/dic&quot;</span> <span class="p">}</span> <span class="p">},</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">libre2_splitter.so</tt></dt>
<dd><p>string_typesで指定できる。re2を利用して、与えられた文書から正規表現を利用してキーワードを抜き出して、それぞれを特徴量として利用する。正規表現マッチは連続的に行われ、マッチした  箇所全てを特徴として使う。&#8211;disable-re2を指定 <strong>しない</strong> と、/usr/local/lib以下に作成される。</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">&#8220;create&#8221;を指定する。</td>
</tr>
<tr class="field-even field"><th class="field-name">pattern:</th><td class="field-body">マッチさせる正規表現を指定する。</td>
</tr>
<tr class="field-odd field"><th class="field-name">group:</th><td class="field-body">キーワードとして取り出すグループを指定する。0ならマッチした全体で、1以上の値を指定すると () で取り出したグループだけをキーワードとする。省略すると0として扱う。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>最も簡単な例として、以下では日付表現を全て取り出す。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span>
<span class="p">{</span> <span class="s2">&quot;date&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;/usr/local/lib/libre2_splitter.so&quot;</span><span class="p">,</span>
            <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;[0-9]{4}/[0-9]{2}/[0-9]{2}&quot;</span> <span class="p">}</span> <span class="p">},</span>
</pre></div>
</div>
<p>パターンの一部だけを利用するときは、 &#8220;group&#8221; 引数を利用する。たとえば、以下の様な設定で年齢が取れるだろう。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span>
<span class="p">{</span> <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
           <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;/usr/local/lib/libre2_splitter.so&quot;</span><span class="p">,</span>
           <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
           <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;([0-9]+)(歳|才)&quot;</span><span class="p">,</span>
           <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span> <span class="p">}</span> <span class="p">},</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="overview-of-data-conversion">
<h2>overview of data conversion<a class="headerlink" href="#overview-of-data-conversion" title="Permalink to this headline">¶</a></h2>
<p>大まかな処理の流れは以下のようになっている。
datumは文字列データと数値データの2つがあるため、それぞれが別々の処理フローを流れる。
文字列データには、まずstring_filter_rulesが適用されて、フィルター済みデータが追加される。
その状態で、string_rulesによって文字列データからの特徴量が抽出される。
数値データには、まずnum_filter_rulesが適用されて、フィルター済みデータが追加される。
その状態で、num_rulesによって数値データからの特徴量が抽出される。
フィルターと特徴抽出器には引数を必要とするものもあるため、それらはtypesで事前に準備することによって各規則で利用することができるようになる。</p>
<div class="figure">
<img alt="feature vector converter" src="_images/convert_flow.png" style="width: 90%;" />
<p class="caption">図: 変換エンジンの構成</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plugin.html" title="Plugin Develpment"
             >next</a> |</li>
        <li class="right" >
          <a href="idl.html" title="Client generation using IDL generator"
             >previous</a> |</li>
        <li><a href="index.html">Jubatus 0.2.2 documentation</a> &raquo;</li>
          <li><a href="documentation.html" >Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011,2012 PFI&amp;NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/abad93f42020b733148435e2cd92ce15c542d320/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" />
      </a>
  </body>
</html>