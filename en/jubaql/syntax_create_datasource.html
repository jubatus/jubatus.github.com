
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CREATE DATASOURCE &mdash; Jubatus</title>
    <link rel="stylesheet" href="../_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="../index.html" />
    <link rel="up" title="JubaQL Syntax" href="jubaql_syntax.html" />
    <link rel="next" title="CREATE MODEL" href="syntax_create_model.html" />
    <link rel="prev" title="JubaQL Syntax" href="jubaql_syntax.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../rb-modindex.html" title="Ruby Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="syntax_create_model.html" title="CREATE MODEL"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="jubaql_syntax.html" title="JubaQL Syntax"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="jubaql.html" >JubaQL</a> &raquo;</li>
          <li><a href="jubaql_syntax.html" accesskey="U">JubaQL Syntax</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="../index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CREATE DATASOURCE</a><ul>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
<li><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="jubaql_syntax.html"
                        title="previous chapter">JubaQL Syntax</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="syntax_create_model.html"
                        title="next chapter">CREATE MODEL</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/jubaql/syntax_create_datasource.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JubatusOfficial"  data-widget-id="258379257628196864">Tweets by @JubatusOfficial</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="create-datasource">
<h1>CREATE DATASOURCE<a class="headerlink" href="#create-datasource" title="Permalink to this headline">¶</a></h1>
<p>Syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">DATASOURCE</span> <span class="n">source_name</span> <span class="p">[</span> <span class="p">(</span><span class="n">column_name</span> <span class="n">data_type</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="n">FROM</span> <span class="p">(</span><span class="n">STORAGE</span><span class="p">:</span> <span class="s1">&#39;storage_location&#39;</span> <span class="p">[,</span> <span class="n">STREAM</span><span class="p">:</span> <span class="s1">&#39;storage_location&#39;</span> <span class="p">])</span>
</pre></div>
</div>
<p>Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">jubaql</span><span class="o">&gt;</span> <span class="n">CREATE</span> <span class="n">DATASOURCE</span> <span class="n">nbpds</span> <span class="p">(</span><span class="n">label</span> <span class="n">string</span><span class="p">,</span> <span class="n">name</span> <span class="n">string</span><span class="p">)</span>
        <span class="n">FROM</span> <span class="p">(</span><span class="n">STORAGE</span><span class="p">:</span> <span class="s1">&#39;hdfs:///jubatus-on-yarn/sample/npb_data.json&#39;</span><span class="p">)</span>
<span class="n">CREATE</span> <span class="n">DATASOURCE</span>

<span class="n">jubaql</span><span class="o">&gt;</span> <span class="n">CREATE</span> <span class="n">DATASOURCE</span> <span class="n">nico</span> <span class="n">FROM</span> <span class="p">(</span><span class="n">STORAGE</span><span class="p">:</span> <span class="s1">&#39;hdfs:///user/fluentd&#39;</span><span class="p">,</span>
        <span class="n">STREAM</span><span class="p">:</span> <span class="s1">&#39;kafka://hdp8:2181,hdp9:2181,hdp10:2181/fluentd/1&#39;</span><span class="p">)</span>
<span class="n">CREATE</span> <span class="n">DATASOURCE</span>
</pre></div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">DATASOURCE</span></code> defines an abstract data source with a unified view of a static data set and (optionally) a data stream. Data is assumed to contain one JSON document per line.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">source_name</span></code> is a user-defined string that will identify this data source later on.</li>
<li>A schema of <code class="docutils literal"><span class="pre">column_name</span></code> and <code class="docutils literal"><span class="pre">data_type</span></code> (one of <code class="docutils literal"><span class="pre">numeric</span></code>, <code class="docutils literal"><span class="pre">string</span></code>, <code class="docutils literal"><span class="pre">boolean</span></code>) may be specified, providing a row-column shape for the JSON data.
If a schema is not given, it will be inferred from the data in each batch.</li>
<li><code class="docutils literal"><span class="pre">storage_location</span></code> is a string indicating the location of the data. Valid formats are:<ul>
<li><code class="docutils literal"><span class="pre">file://&lt;path&gt;</span></code>, <code class="docutils literal"><span class="pre">hdfs://&lt;path&gt;</span></code> and <code class="docutils literal"><span class="pre">empty</span></code> (for STORAGE)</li>
<li><code class="docutils literal"><span class="pre">kafka://&lt;zookeeper&gt;/&lt;topic&gt;/&lt;consumer-group&gt;</span></code> (for STREAM)</li>
</ul>
</li>
</ul>
<p>After a <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">DATASOURCE</span></code> statement has been processed successfully, the user can use the specified <code class="docutils literal"><span class="pre">source_name</span></code> in other statements whenever a <code class="docutils literal"><span class="pre">STREAM</span></code> is referenced. The second of the above examples is in spirit similar to PostgreSQL&#8217;s <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">VIEW</span> <span class="pre">ds</span> <span class="pre">AS</span> <span class="pre">SELECT</span> <span class="pre">json-&gt;'label'</span> <span class="pre">AS</span> <span class="pre">label,</span> <span class="pre">json-&gt;'name'</span> <span class="pre">AS</span> <span class="pre">name</span> <span class="pre">FROM</span> <span class="pre">hdfs_table</span></code>.</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>To retrieve data from fluentd, fluentd must be configured to push its data to Kafka using <a class="reference external" href="https://github.com/htgc/fluent-plugin-kafka/">fluent-plugin-kafka</a>. This is required because fluentd expects to <em>push</em> data somewhere while Spark expects to <em>pull</em> data from somewhere, so there is a message queue needed in between. Kafka seems to fulfill this requirement quite well.</li>
<li>When seamless switching from static to stream processing is desired, there must be a field with the key <code class="docutils literal"><span class="pre">&quot;jubaql_timestamp&quot;</span></code> in every data item with strictly increasing (as per string ordering) string values.
Otherwise items in the Kafka queue that are also in the previously processed static data set will be processed again.</li>
<li>Schema inference increases processing time and carries the risk of a wrongly inferred data type (since only a sampled subset is considered for inference), leading to type cast errors at runtime.
Also, an empty schema will be inferred for empty batches, leading to problems with many other statements.
Unless data is directly fed from a data source to a a model update process, schema inference should therefore be avoided at the moment.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../rb-modindex.html" title="Ruby Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="syntax_create_model.html" title="CREATE MODEL"
             >next</a> |</li>
        <li class="right" >
          <a href="jubaql_syntax.html" title="JubaQL Syntax"
             >previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="jubaql.html" >JubaQL</a> &raquo;</li>
          <li><a href="jubaql_syntax.html" >JubaQL Syntax</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2016 PFN &amp; NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.6.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>