

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>JubaQL Quick Start &mdash; Jubatus</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Jubatus" href="../index.html"/>
        <link rel="up" title="JubaQL" href="index.html"/>
        <link rel="next" title="JubaQL Overview" href="overview.html"/>
        <link rel="prev" title="JubaQL" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Jubatus
          

          
            
            <img src="../_static/title.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_distributed.html">Distributed Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fv_convert.html">Data Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../method.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/index.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_faqs/index.html">Tips and FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jubakit/index.html">Jubakit</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">JubaQL</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">JubaQL Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#jubaql-requirements">JubaQL Requirements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-maven-repository">Using Maven Repository</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#development-mode">Development mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#test-the-setup">Test the setup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-on-yarn-with-local-gateway">Run on YARN with local gateway</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">Test the setup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-on-yarn-with-remote-gateway">Run on YARN with remote gateway</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">JubaQL Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">JubaQL Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="jubaql_syntax.html">JubaQL Syntax</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About This Project</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Jubatus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">JubaQL</a> &raquo;</li>
      
    <li>JubaQL Quick Start</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="jubaql-quick-start">
<h1>JubaQL Quick Start<a class="headerlink" href="#jubaql-quick-start" title="Permalink to this headline">¶</a></h1>
<div class="section" id="jubaql-requirements">
<h2>JubaQL Requirements<a class="headerlink" href="#jubaql-requirements" title="Permalink to this headline">¶</a></h2>
<p>The following components are requried to run JubaQL.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="13%" />
<col width="10%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Software</th>
<th class="head">Version</th>
<th class="head">Required</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>JDK</td>
<td>7</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Spark</td>
<td>1.2.1+ <a class="footnote-reference" href="#id4" id="id1">[1]</a></td>
<td>✔ <a class="footnote-reference" href="#id5" id="id2">[2]</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Jubatus</td>
<td>0.8.0</td>
<td>✔ <a class="footnote-reference" href="#id6" id="id3">[3]</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Hadoop YARN</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&#160;</td>
<td>Only when running JubaQL in Production mode.</td>
</tr>
<tr class="row-even"><td>Jubatus on YARN</td>
<td>1.0</td>
<td>&#160;</td>
<td>Only when running JubaQL in Production mode.</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Spark 1.1.x (or earlier), 1.2.0 or 1.3.x (or later) cannot be used.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Spark must be installed on nodes that run JubaQL Gateway.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>When running JubaQL in Development mode, Jubatus must be installed on nodes that run JubaQL Gateway.
When running JubaQL in Production mode, Jubatus must be installed on all YARN nodes.</td></tr>
</tbody>
</table>
<p>To build JubaQL or Jubatus on YARN, you need to install <a class="reference external" href="http://www.scala-sbt.org/">sbt</a> command.</p>
<div class="section" id="using-maven-repository">
<h3>Using Maven Repository<a class="headerlink" href="#using-maven-repository" title="Permalink to this headline">¶</a></h3>
<p>When using Jubatus on YARN from your Scala application, you can use the Maven repository.
Add the following to the build.sbt file of your project.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Jubatus</span> <span class="n">Maven</span> <span class="n">Repository</span>
<span class="n">resolvers</span> <span class="o">+=</span> <span class="s2">&quot;Jubatus&quot;</span> <span class="n">at</span> <span class="s2">&quot;http://download.jubat.us/maven&quot;</span>

<span class="o">//</span> <span class="n">Dependencies</span>
<span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="n">Seq</span><span class="p">(</span>
  <span class="s2">&quot;us.jubat&quot;</span>                   <span class="o">%%</span> <span class="s2">&quot;jubatus-on-yarn-client&quot;</span>    <span class="o">%</span> <span class="s2">&quot;1.0&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="development-mode">
<h2>Development mode<a class="headerlink" href="#development-mode" title="Permalink to this headline">¶</a></h2>
<p>For development purposes, it is possible to run gateway and processor
without a Hadoop cluster. In this case the gateway will not start
the processor using YARN but as a local process.</p>
<p>Get a Hadoop-enabled version of <a class="reference external" href="http://spark.apache.org/">Apache Spark</a> 1.2.2:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">d3kbcqa49mib13</span><span class="o">.</span><span class="n">cloudfront</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">spark</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="nb">bin</span><span class="o">-</span><span class="n">hadoop2</span><span class="o">.</span><span class="mf">4.</span><span class="n">tgz</span>
</pre></div>
</div>
<p>and unpack it</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xzf</span> <span class="n">spark</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="nb">bin</span><span class="o">-</span><span class="n">hadoop2</span><span class="o">.</span><span class="mf">4.</span><span class="n">tgz</span> <span class="o">&amp;&amp;</span> <span class="n">export</span> <span class="n">SPARK_DIST</span><span class="o">=</span><span class="s2">&quot;$(pwd)/spark-1.2.2-bin-hadoop2.4/&quot;</span>
</pre></div>
</div>
<p>Build JubaQLClient</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jubatus</span><span class="o">/</span><span class="n">jubaql</span><span class="o">-</span><span class="n">client</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">jubaql</span><span class="o">-</span><span class="n">client</span> <span class="o">&amp;&amp;</span> <span class="n">sbt</span> <span class="n">start</span><span class="o">-</span><span class="n">script</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="o">..</span>
</pre></div>
</div>
<p>Build JubaQLServer</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jubatus</span><span class="o">/</span><span class="n">jubaql</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">jubaql</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">processor</span> <span class="o">&amp;&amp;</span> <span class="n">sbt</span> <span class="n">assembly</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="o">../..</span>
<span class="n">cd</span> <span class="n">jubaql</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">gateway</span> <span class="o">&amp;&amp;</span> <span class="n">sbt</span> <span class="n">assembly</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="o">../..</span>
</pre></div>
</div>
<div class="section" id="test-the-setup">
<h3>Test the setup<a class="headerlink" href="#test-the-setup" title="Permalink to this headline">¶</a></h3>
<p>In order to test that your setup is working correctly, you can do a
simple classification using the data from the <a class="reference external" href="https://github.com/jubatus/jubatus-example/tree/master/shogun">shogun example</a>.
The training data is located at ./jubaql-server/data/shogun_data.json.</p>
<p>Start the JubaQLGateway</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">jubaql</span><span class="o">-</span><span class="n">server</span> <span class="o">&amp;&amp;</span> \
<span class="n">java</span> <span class="o">-</span><span class="n">Dspark</span><span class="o">.</span><span class="n">distribution</span><span class="o">=</span><span class="s2">&quot;$SPARK_DIST&quot;</span> \
     <span class="o">-</span><span class="n">Djubaql</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">fatjar</span><span class="o">=</span><span class="n">processor</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">scala</span><span class="o">-</span><span class="mf">2.10</span><span class="o">/</span><span class="n">jubaql</span><span class="o">-</span><span class="n">processor</span><span class="o">-</span><span class="n">assembly</span><span class="o">-</span><span class="mf">1.3</span><span class="o">.</span><span class="mf">0.</span><span class="n">jar</span> \
     <span class="o">-</span><span class="n">jar</span> <span class="n">gateway</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">scala</span><span class="o">-</span><span class="mf">2.10</span><span class="o">/</span><span class="n">jubaql</span><span class="o">-</span><span class="n">gateway</span><span class="o">-</span><span class="n">assembly</span><span class="o">-</span><span class="mf">1.3</span><span class="o">.</span><span class="mf">0.</span><span class="n">jar</span> \
     <span class="o">-</span><span class="n">i</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
</pre></div>
</div>
<p>In a different shell, start the JubaQLClient:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">jubaql</span><span class="o">-</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">start</span>
</pre></div>
</div>
<ul class="simple">
<li>You will see the prompt <code class="docutils literal"><span class="pre">jubaql&gt;</span></code> in the shell and you will in fact
be able to type your commands there, but until the JubaQLProcessor is
up and running correctly, you will see the message: &#8220;This session has
not been registered. Wait a second.&#8221;</li>
</ul>
<p>Run the following JubaQL commands in the client:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">CLASSIFIER</span> <span class="n">MODEL</span> <span class="n">test</span> <span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="n">label</span><span class="p">)</span> <span class="n">AS</span> <span class="n">name</span> <span class="n">WITH</span> <span class="n">unigram</span> <span class="n">CONFIG</span> <span class="s1">&#39;{&quot;method&quot;: &quot;AROW&quot;, &quot;parameter&quot;: {&quot;regularization_weight&quot; : 1.0}}&#39;</span>
<span class="n">CREATE</span> <span class="n">DATASOURCE</span> <span class="n">shogun</span> <span class="p">(</span><span class="n">label</span> <span class="n">string</span><span class="p">,</span> <span class="n">name</span> <span class="n">string</span><span class="p">)</span> <span class="n">FROM</span> <span class="p">(</span><span class="n">STORAGE</span><span class="p">:</span> <span class="s2">&quot;file://jubaql-server/data/shogun_data.json&quot;</span><span class="p">)</span>
<span class="n">UPDATE</span> <span class="n">MODEL</span> <span class="n">test</span> <span class="n">USING</span> <span class="n">train</span> <span class="n">FROM</span> <span class="n">shogun</span>
<span class="n">START</span> <span class="n">PROCESSING</span> <span class="n">shogun</span>
<span class="n">ANALYZE</span> <span class="s1">&#39;{&quot;name&quot;: &quot;慶喜&quot;}&#39;</span> <span class="n">BY</span> <span class="n">MODEL</span> <span class="n">test</span> <span class="n">USING</span> <span class="n">classify</span>
<span class="n">SHUTDOWN</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-on-yarn-with-local-gateway">
<h2>Run on YARN with local gateway<a class="headerlink" href="#run-on-yarn-with-local-gateway" title="Permalink to this headline">¶</a></h2>
<p>The gateway itself is not a YARN application, it only <em>launches</em>
a YARN application. Therefore it is also possible to run the
gateway on the user&#8217;s machine, as long as the firewall permits
access to the YARN cluster.</p>
<p>To run JubaQL with a local gateway, do the following:</p>
<ul class="simple">
<li>Set up a Hadoop cluster with YARN and HDFS in place, for example using
<a class="reference external" href="http://www.cloudera.com/content/cloudera/en/downloads/cloudera_manager.html">Cloudera Manager</a>
or one of the <a class="reference external" href="http://hortonworks.com/hdp/downloads/">Hortonworks Packages</a>.</li>
<li><a class="reference external" href="http://jubat.us/en/quickstart.html#install-jubatus">Install Jubatus</a> on all cluster nodes.</li>
<li>Get JubaQL and compile it as described above. (This time, Jubatus is
not required locally.)</li>
<li>Install the <a class="reference external" href="https://github.com/jubatus/jubatus-on-yarn">Jubatus on
YARN</a> libraries in
HDFS as described in <a class="reference external" href="https://github.com/jubatus/jubatus-on-yarn/blob/master/document/instruction.md#creating-the-required-files">the
instructions</a>.
Make sure that the HDFS directory <code class="docutils literal"><span class="pre">/jubatus-on-yarn/application-master/jubaconfig/</span></code> exists and is
writeable by the user running the JubaQLProcessor application.</li>
</ul>
<div class="section" id="id7">
<h3>Test the setup<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>To test the setup, also copy the file <code class="docutils literal"><span class="pre">shogun-data.json</span></code> from the
JubaQL source tree&#8217;s <code class="docutils literal"><span class="pre">data/</span></code> directory to
<code class="docutils literal"><span class="pre">/jubatus-on-yarn/sample/shogun_data.json</span></code> in HDFS.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">hdfs</span> <span class="n">dfs</span> <span class="o">-</span><span class="n">put</span> <span class="o">./</span><span class="n">jubaql</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">shogun_data</span><span class="o">.</span><span class="n">json</span> <span class="o">/</span><span class="n">jubatus</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">yarn</span><span class="o">/</span><span class="n">sample</span><span class="o">/</span>
</pre></div>
</div>
<p>Copy the files <code class="docutils literal"><span class="pre">core-site.xml</span></code>, <code class="docutils literal"><span class="pre">yarn-site.xml</span></code>,
<code class="docutils literal"><span class="pre">hdfs-site.xml</span></code> containing your Hadoop setup description from one
of your cluster nodes to some directory and point the environment
variable <code class="docutils literal"><span class="pre">HADOOP_CONF_DIR</span></code> (e.g. /etc/hadoop/conf)to that directory.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">core</span><span class="o">-</span><span class="n">site</span><span class="o">.</span><span class="n">xml</span> <span class="n">yarn</span><span class="o">-</span><span class="n">site</span><span class="o">.</span><span class="n">xml</span> <span class="n">hdfs</span><span class="o">-</span><span class="n">site</span><span class="o">.</span><span class="n">xml</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hadoop</span><span class="o">/</span><span class="n">conf</span>
<span class="n">export</span> <span class="n">HADOOP_CONF_DIR</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hadoop</span><span class="o">/</span><span class="n">conf</span>
</pre></div>
</div>
<p>Get your local computer&#8217;s IP address that points towards the cluster.
On Linux, given the IP address of one of your cluster nodes, this
should be possible with something like</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>export MY_IP=$(ip route get 12.34.56.78 | grep -Po &#39;src \K.+&#39;)
</pre></div>
</div>
<p>Make sure that this IP address can be connected to from the cluster
nodes and no firewall rules etc. are blocking access.</p>
<p>Get the addresses of your Zookeeper nodes and concatenate their
<code class="docutils literal"><span class="pre">host:port</span></code> locations with a comma</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">MY_ZOOKEEPER</span><span class="o">=</span><span class="n">zk1</span><span class="p">:</span><span class="mi">2181</span><span class="p">,</span><span class="n">zk2</span><span class="p">:</span><span class="mi">2181</span>
</pre></div>
</div>
<p>Locate a temporary directory in HDFS that Spark can use for
checkpointing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CHECKPOINT</span><span class="o">=</span><span class="n">hdfs</span><span class="p">:</span><span class="o">///</span><span class="n">tmp</span><span class="o">/</span><span class="n">spark</span>
</pre></div>
</div>
<p>Start the JubaQLGateway</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd jubaql-server &amp;&amp; \
java -Drun.mode=production \
     -Djubaql.checkpointdir=$CHECKPOINT \
     -Djubaql.zookeeper=$MY_ZOOKEEPER \
     -Dspark.distribution=&quot;$SPARK_DIST&quot; \
     -Djubaql.processor.fatjar=processor/target/scala-2.10/jubaql-processor-assembly-1.3.0.jar \
     -jar gateway/target/scala-2.10/jubaql-gateway-assembly-1.3.0.jar \
     -i $MY_IP``
</pre></div>
</div>
<p>In adifferent shell, start the JubaQLClient</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">jubaql</span><span class="o">-</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">start</span>
</pre></div>
</div>
<p>You will see the prompt <code class="docutils literal"><span class="pre">jubaql&gt;</span></code> in the shell and you will in fact
be able to type your commands there, but until the JubaQLProcessor is
up and running correctly, you will see the message: &#8220;This session has
not been registered. Wait a second.&#8221;</p>
<p>In order to test that your setup is working correctly, you can do a
simple classification using the <code class="docutils literal"><span class="pre">shogun-data.json</span></code> file you copied to
HDFS before. Run the following JubaQL commands in the client:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">CLASSIFIER</span> <span class="n">MODEL</span> <span class="n">test</span> <span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="n">label</span><span class="p">)</span> <span class="n">AS</span> <span class="n">name</span> <span class="n">WITH</span> <span class="n">unigram</span> <span class="n">CONFIG</span> <span class="s1">&#39;{&quot;method&quot;: &quot;AROW&quot;, &quot;parameter&quot;: {&quot;regularization_weight&quot; : 1.0}}&#39;</span>
<span class="n">CREATE</span> <span class="n">DATASOURCE</span> <span class="n">shogun</span> <span class="p">(</span><span class="n">label</span> <span class="n">string</span><span class="p">,</span> <span class="n">name</span> <span class="n">string</span><span class="p">)</span> <span class="n">FROM</span> <span class="p">(</span><span class="n">STORAGE</span><span class="p">:</span> <span class="s2">&quot;hdfs:///jubatus-on-yarn/sample/shogun_data.json&quot;</span><span class="p">)</span>
<span class="n">UPDATE</span> <span class="n">MODEL</span> <span class="n">test</span> <span class="n">USING</span> <span class="n">train</span> <span class="n">FROM</span> <span class="n">shogun</span>
<span class="n">START</span> <span class="n">PROCESSING</span> <span class="n">shogun</span>
<span class="n">ANALYZE</span> <span class="s1">&#39;{&quot;name&quot;: &quot;慶喜&quot;}&#39;</span> <span class="n">BY</span> <span class="n">MODEL</span> <span class="n">test</span> <span class="n">USING</span> <span class="n">classify</span>
<span class="n">SHUTDOWN</span>
</pre></div>
</div>
<p>The JSON returned by the <code class="docutils literal"><span class="pre">ANALYZE</span></code> statement should indicate that the
label &#8220;徳川&#8221; has the highest score. Note that the score may differ from
the result in development since multiple Jubatus instances are used for
training.</p>
<p>Note:</p>
<ul class="simple">
<li>When the JubaQLProcessor is started, first the files
<code class="docutils literal"><span class="pre">spark-assembly-1.2.2-hadoop2.4.0.jar</span></code> and
<code class="docutils literal"><span class="pre">jubaql-processor-assembly-1.3.0.jar</span></code> will be uploaded to the cluster
and added to
HDFS, from where they will be downloaded by each executor.
It is possible to skip the upload of the Spark libraries by copying the Spark
jar file to HDFS manually and adding the parameter
<code class="docutils literal"><span class="pre">-Dspark.yarn.jar=hdfs:///path/to/spark-assembly-1.2.2-hadoop2.4.0.jar</span></code>
when starting the JubaQLGateway.</li>
<li>In theory, it is also possible to do
the same for the JubaQLProcessor application jar file. However, at the
moment we rely on extracting a <code class="docutils literal"><span class="pre">log4j.xml</span></code> file from that jar locally
before upload, so there is no support for also storing that file in
HDFS, yet.</li>
</ul>
</div>
</div>
<div class="section" id="run-on-yarn-with-remote-gateway">
<h2>Run on YARN with remote gateway<a class="headerlink" href="#run-on-yarn-with-remote-gateway" title="Permalink to this headline">¶</a></h2>
<p>In general, this setup is very similar to the setup in the previous
section. The only difference is that the execution of the gateway takes
place on a remote host. Therefore, the jar files for JubaQLProcessor and
JubaQLGateway as well as the Hadoop configuration files must be copied
there and the JubaQLGateway started there. Also, pass the
<code class="docutils literal"><span class="pre">-h</span> <span class="pre">hostname</span></code> parameter to the JubaQLClient to connect to the remote
server.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="overview.html" class="btn btn-neutral float-right" title="JubaQL Overview" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="JubaQL" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2018 PFN &amp; NTT.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>