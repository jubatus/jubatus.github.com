
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JubaQL Quick Start &mdash; Jubatus</title>
    <link rel="stylesheet" href="../_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="../index.html" />
    <link rel="up" title="JubaQL" href="jubaql.html" />
    <link rel="next" title="JubaQL Overview" href="overview.html" />
    <link rel="prev" title="JubaQL" href="jubaql.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../rb-modindex.html" title="Ruby Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="overview.html" title="JubaQL Overview"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="jubaql.html" title="JubaQL"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="jubaql.html" accesskey="U">JubaQL</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="../index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">JubaQL Quick Start</a><ul>
<li><a class="reference internal" href="#jubaql-requirements">JubaQL Requirements</a><ul>
<li><a class="reference internal" href="#using-maven-repository">Using Maven Repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#development-mode">Development mode</a><ul>
<li><a class="reference internal" href="#test-the-setup">Test the setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#run-on-yarn-with-local-gateway">Run on YARN with local gateway</a><ul>
<li><a class="reference internal" href="#id7">Test the setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#run-on-yarn-with-remote-gateway">Run on YARN with remote gateway</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="jubaql.html"
                        title="previous chapter">JubaQL</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="overview.html"
                        title="next chapter">JubaQL Overview</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/jubaql/quickstart.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JubatusOfficial"  data-widget-id="258379257628196864">Tweets by @JubatusOfficial</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="jubaql-quick-start">
<h1>JubaQL Quick Start<a class="headerlink" href="#jubaql-quick-start" title="Permalink to this headline">¶</a></h1>
<div class="section" id="jubaql-requirements">
<h2>JubaQL Requirements<a class="headerlink" href="#jubaql-requirements" title="Permalink to this headline">¶</a></h2>
<p>The following components are requried to run JubaQL.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="13%" />
<col width="10%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Software</th>
<th class="head">Version</th>
<th class="head">Required</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>JDK</td>
<td>7</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>Spark</td>
<td>1.2.1+ <a class="footnote-reference" href="#id4" id="id1">[1]</a></td>
<td>✔ <a class="footnote-reference" href="#id5" id="id2">[2]</a></td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Jubatus</td>
<td>0.8.0</td>
<td>✔ <a class="footnote-reference" href="#id6" id="id3">[3]</a></td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>Hadoop YARN</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>Only when running JubaQL in Production mode.</td>
</tr>
<tr class="row-even"><td>Jubatus on YARN</td>
<td>1.0</td>
<td>&nbsp;</td>
<td>Only when running JubaQL in Production mode.</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Spark 1.1.x (or earlier), 1.2.0 or 1.3.x (or later) cannot be used.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Spark must be installed on nodes that run JubaQL Gateway.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>When running JubaQL in Development mode, Jubatus must be installed on nodes that run JubaQL Gateway.
When running JubaQL in Production mode, Jubatus must be installed on all YARN nodes.</td></tr>
</tbody>
</table>
<p>To build JubaQL or Jubatus on YARN, you need to install <a class="reference external" href="http://www.scala-sbt.org/">sbt</a> command.</p>
<div class="section" id="using-maven-repository">
<h3>Using Maven Repository<a class="headerlink" href="#using-maven-repository" title="Permalink to this headline">¶</a></h3>
<p>When using Jubatus on YARN from your Scala application, you can use the Maven repository.
Add the following to the build.sbt file of your project.</p>
<div class="highlight-python"><div class="highlight"><pre>// Jubatus Maven Repository
resolvers += &quot;Jubatus&quot; at &quot;http://download.jubat.us/maven&quot;

// Dependencies
libraryDependencies ++= Seq(
  &quot;us.jubat&quot;                   %% &quot;jubatus-on-yarn-client&quot;    % &quot;1.0&quot;
)
</pre></div>
</div>
</div>
</div>
<div class="section" id="development-mode">
<h2>Development mode<a class="headerlink" href="#development-mode" title="Permalink to this headline">¶</a></h2>
<p>For development purposes, it is possible to run gateway and processor
without a Hadoop cluster. In this case the gateway will not start
the processor using YARN but as a local process.</p>
<p>Get a Hadoop-enabled version of <a class="reference external" href="http://spark.apache.org/">Apache Spark</a> 1.2.2:</p>
<div class="highlight-python"><div class="highlight"><pre>wget http://d3kbcqa49mib13.cloudfront.net/spark-1.2.2-bin-hadoop2.4.tgz
</pre></div>
</div>
<p>and unpack it</p>
<div class="highlight-python"><div class="highlight"><pre>tar -xzf spark-1.2.2-bin-hadoop2.4.tgz &amp;&amp; export SPARK_DIST=&quot;$(pwd)/spark-1.2.2-bin-hadoop2.4/&quot;
</pre></div>
</div>
<p>Build JubaQLClient</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/jubatus/jubaql-client.git
cd jubaql-client &amp;&amp; sbt start-script &amp;&amp; cd ..
</pre></div>
</div>
<p>Build JubaQLServer</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/jubatus/jubaql-server.git
cd jubaql-server/processor &amp;&amp; sbt assembly &amp;&amp; cd ../..
cd jubaql-server/gateway &amp;&amp; sbt assembly &amp;&amp; cd ../..
</pre></div>
</div>
<div class="section" id="test-the-setup">
<h3>Test the setup<a class="headerlink" href="#test-the-setup" title="Permalink to this headline">¶</a></h3>
<p>In order to test that your setup is working correctly, you can do a
simple classification using the data from the <a class="reference external" href="https://github.com/jubatus/jubatus-example/tree/master/shogun">shogun example</a>.
The training data is located at ./jubaql-server/data/shogun_data.json.</p>
<p>Start the JubaQLGateway</p>
<div class="highlight-python"><div class="highlight"><pre>cd jubaql-server &amp;&amp; \
java -Dspark.distribution=&quot;$SPARK_DIST&quot; \
     -Djubaql.processor.fatjar=processor/target/scala-2.10/jubaql-processor-assembly-1.3.0.jar \
     -jar gateway/target/scala-2.10/jubaql-gateway-assembly-1.3.0.jar \
     -i 127.0.0.1
</pre></div>
</div>
<p>In a different shell, start the JubaQLClient:</p>
<div class="highlight-python"><div class="highlight"><pre>./jubaql-client/target/start
</pre></div>
</div>
<ul class="simple">
<li>You will see the prompt <code class="docutils literal"><span class="pre">jubaql&gt;</span></code> in the shell and you will in fact
be able to type your commands there, but until the JubaQLProcessor is
up and running correctly, you will see the message: &#8220;This session has
not been registered. Wait a second.&#8221;</li>
</ul>
<p>Run the following JubaQL commands in the client:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE CLASSIFIER MODEL test (label: label) AS name WITH unigram CONFIG &#39;{&quot;method&quot;: &quot;AROW&quot;, &quot;parameter&quot;: {&quot;regularization_weight&quot; : 1.0}}&#39;
CREATE DATASOURCE shogun (label string, name string) FROM (STORAGE: &quot;file://jubaql-server/data/shogun_data.json&quot;)
UPDATE MODEL test USING train FROM shogun
START PROCESSING shogun
ANALYZE &#39;{&quot;name&quot;: &quot;慶喜&quot;}&#39; BY MODEL test USING classify
SHUTDOWN
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-on-yarn-with-local-gateway">
<h2>Run on YARN with local gateway<a class="headerlink" href="#run-on-yarn-with-local-gateway" title="Permalink to this headline">¶</a></h2>
<p>The gateway itself is not a YARN application, it only <em>launches</em>
a YARN application. Therefore it is also possible to run the
gateway on the user&#8217;s machine, as long as the firewall permits
access to the YARN cluster.</p>
<p>To run JubaQL with a local gateway, do the following:</p>
<ul class="simple">
<li>Set up a Hadoop cluster with YARN and HDFS in place, for example using
<a class="reference external" href="http://www.cloudera.com/content/cloudera/en/downloads/cloudera_manager.html">Cloudera Manager</a>
or one of the <a class="reference external" href="http://hortonworks.com/hdp/downloads/">Hortonworks Packages</a>.</li>
<li><a class="reference external" href="http://jubat.us/en/quickstart.html#install-jubatus">Install Jubatus</a> on all cluster nodes.</li>
<li>Get JubaQL and compile it as described above. (This time, Jubatus is
not required locally.)</li>
<li>Install the <a class="reference external" href="https://github.com/jubatus/jubatus-on-yarn">Jubatus on
YARN</a> libraries in
HDFS as described in <a class="reference external" href="https://github.com/jubatus/jubatus-on-yarn/blob/master/document/instruction.md#creating-the-required-files">the
instructions</a>.
Make sure that the HDFS directory <code class="docutils literal"><span class="pre">/jubatus-on-yarn/application-master/jubaconfig/</span></code> exists and is
writeable by the user running the JubaQLProcessor application.</li>
</ul>
<div class="section" id="id7">
<h3>Test the setup<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>To test the setup, also copy the file <code class="docutils literal"><span class="pre">shogun-data.json</span></code> from the
JubaQL source tree&#8217;s <code class="docutils literal"><span class="pre">data/</span></code> directory to
<code class="docutils literal"><span class="pre">/jubatus-on-yarn/sample/shogun_data.json</span></code> in HDFS.</p>
<div class="highlight-python"><div class="highlight"><pre>hdfs dfs -put ./jubaql-server/data/shogun_data.json /jubatus-on-yarn/sample/
</pre></div>
</div>
<p>Copy the files <code class="docutils literal"><span class="pre">core-site.xml</span></code>, <code class="docutils literal"><span class="pre">yarn-site.xml</span></code>,
<code class="docutils literal"><span class="pre">hdfs-site.xml</span></code> containing your Hadoop setup description from one
of your cluster nodes to some directory and point the environment
variable <code class="docutils literal"><span class="pre">HADOOP_CONF_DIR</span></code> (e.g. /etc/hadoop/conf)to that directory.</p>
<div class="highlight-python"><div class="highlight"><pre>cp core-site.xml yarn-site.xml hdfs-site.xml /etc/hadoop/conf
export HADOOP_CONF_DIR=/etc/hadoop/conf
</pre></div>
</div>
<p>Get your local computer&#8217;s IP address that points towards the cluster.
On Linux, given the IP address of one of your cluster nodes, this
should be possible with something like</p>
<div class="highlight-python"><div class="highlight"><pre>export MY_IP=$(ip route get 12.34.56.78 | grep -Po &#39;src \K.+&#39;)
</pre></div>
</div>
<p>Make sure that this IP address can be connected to from the cluster
nodes and no firewall rules etc. are blocking access.</p>
<p>Get the addresses of your Zookeeper nodes and concatenate their
<code class="docutils literal"><span class="pre">host:port</span></code> locations with a comma</p>
<div class="highlight-python"><div class="highlight"><pre>export MY_ZOOKEEPER=zk1:2181,zk2:2181
</pre></div>
</div>
<p>Locate a temporary directory in HDFS that Spark can use for
checkpointing</p>
<div class="highlight-python"><div class="highlight"><pre>export CHECKPOINT=hdfs:///tmp/spark
</pre></div>
</div>
<p>Start the JubaQLGateway</p>
<div class="highlight-python"><div class="highlight"><pre>cd jubaql-server &amp;&amp; \
java -Drun.mode=production \
     -Djubaql.checkpointdir=$CHECKPOINT \
     -Djubaql.zookeeper=$MY_ZOOKEEPER \
     -Dspark.distribution=&quot;$SPARK_DIST&quot; \
     -Djubaql.processor.fatjar=processor/target/scala-2.10/jubaql-processor-assembly-1.3.0.jar \
     -jar gateway/target/scala-2.10/jubaql-gateway-assembly-1.3.0.jar \
     -i $MY_IP``
</pre></div>
</div>
<p>In adifferent shell, start the JubaQLClient</p>
<div class="highlight-python"><div class="highlight"><pre>./jubaql-client/target/start
</pre></div>
</div>
<p>You will see the prompt <code class="docutils literal"><span class="pre">jubaql&gt;</span></code> in the shell and you will in fact
be able to type your commands there, but until the JubaQLProcessor is
up and running correctly, you will see the message: &#8220;This session has
not been registered. Wait a second.&#8221;</p>
<p>In order to test that your setup is working correctly, you can do a
simple classification using the <code class="docutils literal"><span class="pre">shogun-data.json</span></code> file you copied to
HDFS before. Run the following JubaQL commands in the client:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE CLASSIFIER MODEL test (label: label) AS name WITH unigram CONFIG &#39;{&quot;method&quot;: &quot;AROW&quot;, &quot;parameter&quot;: {&quot;regularization_weight&quot; : 1.0}}&#39;
CREATE DATASOURCE shogun (label string, name string) FROM (STORAGE: &quot;hdfs:///jubatus-on-yarn/sample/shogun_data.json&quot;)
UPDATE MODEL test USING train FROM shogun
START PROCESSING shogun
ANALYZE &#39;{&quot;name&quot;: &quot;慶喜&quot;}&#39; BY MODEL test USING classify
SHUTDOWN
</pre></div>
</div>
<p>The JSON returned by the <code class="docutils literal"><span class="pre">ANALYZE</span></code> statement should indicate that the
label &#8220;徳川&#8221; has the highest score. Note that the score may differ from
the result in development since multiple Jubatus instances are used for
training.</p>
<p>Note:</p>
<ul class="simple">
<li>When the JubaQLProcessor is started, first the files
<code class="docutils literal"><span class="pre">spark-assembly-1.2.2-hadoop2.4.0.jar</span></code> and
<code class="docutils literal"><span class="pre">jubaql-processor-assembly-1.3.0.jar</span></code> will be uploaded to the cluster
and added to
HDFS, from where they will be downloaded by each executor.
It is possible to skip the upload of the Spark libraries by copying the Spark
jar file to HDFS manually and adding the parameter
<code class="docutils literal"><span class="pre">-Dspark.yarn.jar=hdfs:///path/to/spark-assembly-1.2.2-hadoop2.4.0.jar</span></code>
when starting the JubaQLGateway.</li>
<li>In theory, it is also possible to do
the same for the JubaQLProcessor application jar file. However, at the
moment we rely on extracting a <code class="docutils literal"><span class="pre">log4j.xml</span></code> file from that jar locally
before upload, so there is no support for also storing that file in
HDFS, yet.</li>
</ul>
</div>
</div>
<div class="section" id="run-on-yarn-with-remote-gateway">
<h2>Run on YARN with remote gateway<a class="headerlink" href="#run-on-yarn-with-remote-gateway" title="Permalink to this headline">¶</a></h2>
<p>In general, this setup is very similar to the setup in the previous
section. The only difference is that the execution of the gateway takes
place on a remote host. Therefore, the jar files for JubaQLProcessor and
JubaQLGateway as well as the Hadoop configuration files must be copied
there and the JubaQLGateway started there. Also, pass the
<code class="docutils literal"><span class="pre">-h</span> <span class="pre">hostname</span></code> parameter to the JubaQLClient to connect to the remote
server.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../rb-modindex.html" title="Ruby Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="overview.html" title="JubaQL Overview"
             >next</a> |</li>
        <li class="right" >
          <a href="jubaql.html" title="JubaQL"
             >previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="jubaql.html" >JubaQL</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2015 PFN &amp; NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>