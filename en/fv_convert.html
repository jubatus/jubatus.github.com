

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Data Conversion &mdash; Jubatus</title>
    <link rel="stylesheet" href="_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="index.html" />
    <link rel="up" title="Documentation" href="documentation.html" />
    <link rel="next" title="Plugin Development" href="plugin.html" />
    <link rel="prev" title="Architecture" href="processes.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plugin.html" title="Plugin Development"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="processes.html" title="Architecture"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Jubatus</a> &raquo;</li>
          <li><a href="documentation.html" accesskey="U">Documentation</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Data Conversion</a><ul>
<li><a class="reference internal" href="#datum">Datum</a></li>
<li><a class="reference internal" href="#flow-of-data-conversion">Flow of Data Conversion</a></li>
<li><a class="reference internal" href="#filter">Filter</a><ul>
<li><a class="reference internal" href="#string-filter-types">string_filter_types</a></li>
<li><a class="reference internal" href="#string-filter-rules">string_filter_rules</a></li>
<li><a class="reference internal" href="#num-filter-types">num_filter_types</a></li>
<li><a class="reference internal" href="#num-filter-rules">num_filter_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#feature-extraction-from-strings">Feature Extraction from Strings</a><ul>
<li><a class="reference internal" href="#string-types">string_types</a></li>
<li><a class="reference internal" href="#string-rules">string_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#feature-extraction-from-numbers">Feature Extraction from Numbers</a><ul>
<li><a class="reference internal" href="#num-types">num_types</a></li>
<li><a class="reference internal" href="#num-rules">num_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#feature-extraction-from-binary-data">Feature Extraction from Binary Data</a><ul>
<li><a class="reference internal" href="#binary-types">binary_types</a></li>
<li><a class="reference internal" href="#binary-rules">binary_rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hashing-key-of-feature-vector">Hashing Key of Feature Vector</a></li>
<li><a class="reference internal" href="#plugins">Plugins</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="processes.html"
                        title="previous chapter">Architecture</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plugin.html"
                        title="next chapter">Plugin Development</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/fv_convert.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JubatusOfficial"  data-widget-id="258379257628196864">Tweets by @JubatusOfficial</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="data-conversion">
<span id="conversion"></span><h1>Data Conversion<a class="headerlink" href="#data-conversion" title="Permalink to this headline">¶</a></h1>
<p>Generally speaking, we cannot use unstructured data such as texts directly when we use machine-learning software.
Such data are converted to &#8220;feature vectors&#8221; by being process called feature extraction in advance to the tasks.
We use key-value type as feature vector in which keys are strings and values are numeric values.
Through this process, we can handle unstructured raw data such as natural language texts, pictures and voice in a unified way.
The data-conversion engine in Jubatus enables us to customize this feature-extraction process flexibly only by creating an easy configuration file.</p>
<p>Data-conversion is executed in two steps.
First, we sanitize data with filtering.
This filtering includes removing HTML tags and symbols which we know are unnecessary.
Next, we extract features from sanitized data by feature-extraction process.</p>
<p>We can expect a series of process works well by the easiest configuration in most cases.
The followings is one of the easiest configuration.
In this configuration, we use each word separated by spaces a feature for string data. For numeric data, we use the value itself a feature.
It is probable that doing some tuning this configuration to obtain training model with high precision and desirable result.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;space&quot;</span><span class="p">,</span> <span class="s">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;global_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="s">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span>  <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;num&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="s">&quot;binary_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;binary_rules&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="datum">
<h2>Datum<a class="headerlink" href="#datum" title="Permalink to this headline">¶</a></h2>
<p>It is very simple key-value called &#8220;datum&#8221; that we can use as a data type in Jubatus.
datum has three key-value&#8217;s.
One is &#8220;string_values&#8221;, whose key and value are both string data.
The second is &#8220;num_values&#8221;, whose key is string data as string_values is, but value is numeric data.
The last is &#8220;binary_values&#8221;, whose key is string data as string_values is, but value is arbitrary binary data.
We can store in string_values arbitrary text data such as name, text, profession etc.
We can store in num_values arbitrary numeric data such as age, income, the number of access etc. as a floating value.
And, we can store in binary_values arbitrary binary data such as multimedia data like images and sounds.
The data-conversion module extracts features which are used in machine learning tasks from these three types of data.
Each key-value is represented neither as a map type nor a dictionary type, but as a set of pairs of keys and values for efficiency.
The following is an example of a datum.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/id&quot;</span><span class="p">,</span> <span class="s">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/name&quot;</span><span class="p">,</span> <span class="s">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/age&quot;</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/income&quot;</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/image&quot;</span><span class="p">,</span> <span class="s">&quot;xxxxxxxx&quot;</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Name of keys cannot contain &#8220;$&#8221; sign.</p>
<p>For example, a datum consists of <tt class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">std::string&gt;</span> <span class="pre">&gt;</span></tt> ,  <tt class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::stirng,</span> <span class="pre">double&gt;</span> <span class="pre">&gt;</span></tt> and <tt class="docutils literal"><span class="pre">std::vector&lt;std::pair&lt;std::string,</span> <span class="pre">std::string&gt;</span> <span class="pre">&gt;</span></tt> in C++.
<tt class="docutils literal"><span class="pre">std::pair&lt;T,U&gt;</span></tt> (resp.  <tt class="docutils literal"><span class="pre">std::vector&lt;T&gt;</span></tt>) is to C++ what tuple (resp. vector) is to Python.</p>
</div>
<div class="section" id="flow-of-data-conversion">
<h2>Flow of Data Conversion<a class="headerlink" href="#flow-of-data-conversion" title="Permalink to this headline">¶</a></h2>
<p>The following is the overview of data conversion.</p>
<p>As datum consists of string data, numeric data and binary data, there are flows of processing for each type of data.</p>
<p>For string data, first &#8220;string_filter_rules&#8221; is applied and the filtered data are added to the datum.
Then, features are extracted from string data with &#8220;string_rules&#8221;.</p>
<p>For numeric data, first &#8220;num_filter_rules&#8221; is applied and filtered data are added to the datum.
Then, features are extracted from string data with &#8220;num_rules&#8221;.</p>
<p>For binary data, features are extracted from binary data with &#8220;binary_rules&#8221;.</p>
<p>As some filters and feature extractors requires arguments, these are available in &#8220;string_rules&#8221; and &#8220;num_rules&#8221; if we prepare them in &#8220;string_types&#8221; and &#8220;num_types&#8221;, respectively.</p>
<div class="figure">
<img alt="feature vector converter" src="_images/convert_flow.png" style="width: 90%;" />
<p class="caption">Figure : System of Conversion Engine</p>
</div>
</div>
<div class="section" id="filter">
<h2>Filter<a class="headerlink" href="#filter" title="Permalink to this headline">¶</a></h2>
<p>Jubatus has filtering system of raw data. This enables us to create additional key-value elements by converting existing key-value elements in a datum and to insert additional key-value elements by the filter.
For example, let us suppose we have an original text as an HTML.
Tags, such as &lt;a&gt;, in the data are in the way of training in many cases. Therefore, we want to filter and get rid of them in advance.
In another example, we may remove quotes in e-mails (i.e. lines starts with &#8220;&gt;&#8221;).
We can make use of the filtering system in such cases.</p>
<p>As an example of usage, we remove HTML tags from strings whose key is &#8220;message&#8221;. We do it in two steps.
First, we define a rule which states &#8220;remove HTML tags&#8221;. Second, we apply this rule to data where <tt class="docutils literal"><span class="pre">key</span> <span class="pre">=</span> <span class="pre">&quot;message&quot;</span></tt>.
This procedure is represented by the following configuration.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;detag&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_filter_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;detag&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;-detagged&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As a first step, we define a filter in &#8220;string_filter_types&#8221;. We name this filter &#8220;detag&#8221;.
In &#8220;detag&#8221;, we define a filter which applies a method named &#8220;regexp&#8221;, which replaces &#8220;&lt;[^&gt;]*&gt;&#8221; with &#8220;&#8221;.
Next, we define to which elements in datum and how we apply this filter. We write it in &#8220;string_filter_rules&#8221;.
The example above indicates that we apply the &#8220;detag&#8221; filter defined earlier to the value whose key is &#8220;message&#8221;, and that we store the resultant to &#8220;message-detagged&#8221; key, that is generated from the original key &#8220;message&#8221; and a suffix &#8220;-detagged&#8221;.</p>
<p>In another example, we can add one to &#8220;age&#8221; by the following configuration (in Japan, such a counting method is called &#8220;Kazoe Doshi&#8221;, or East Asian age reckoning).</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;num_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;add_1&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;num_filter_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;add_1&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;_kazoe&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The procedure is the same as the previous example. A value in &#8220;user/age&#8221; added by one is stored in &#8220;usr/age_kazoe&#8221;.</p>
<p>By applying these two filters, we obtain the datum like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/id&quot;</span><span class="p">,</span> <span class="s">&quot;ippy&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/name&quot;</span><span class="p">,</span> <span class="s">&quot;Loren Ipsum&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;H&gt;Hello World&lt;/H&gt;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">(</span><span class="s">&quot;user/age&quot;</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;user/income&quot;</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>These &#8220;types&#8221; and &#8220;rules&#8221; are optional.
When you don&#8217;t specify these configurations, they are regarded as empty lists.
Next section is devoted to more precise explanations of each filter.</p>
<div class="section" id="string-filter-types">
<h3>string_filter_types<a class="headerlink" href="#string-filter-types" title="Permalink to this headline">¶</a></h3>
<p>Specifies a dictionary that consists of &lt;filter name&gt;:&lt;argument&gt;.
&lt;filter name&gt; is a string and &lt;argument&gt; is a dictionary whose keys and values are both strings.
&lt;argument&gt; must contains a key named &#8220;method&#8221;.
The rest of keys in &lt;argument&gt; are dependent on the value of &#8220;method&#8221;.
The followings are available values of &#8220;method&#8221; and keys that must be specified.</p>
<dl class="describe">
<dt>
<tt class="descname">regexp</tt></dt>
<dd><p>This filter converts substrings that a specified regular expression matches to a specified string.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pattern:</th><td class="field-body">Specifies a regular expression to match.</td>
</tr>
<tr class="field-even field"><th class="field-name">replace:</th><td class="field-body">Specifies a string to replace with.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>For list of regular expressions available, refer to the documentation of the regular expression engine (<a class="reference external" href="http://www.geocities.jp/kosako3/oniguruma/doc/RE.txt">oniguruma</a> or <a class="reference external" href="http://code.google.com/p/re2/wiki/Syntax">re2</a>).
The regular expression engine can be selected at compile time (oniguruma is used when using binary packages).</p>
<p>For example, in order to remove all HTML tags, we should define such a string_filter_type.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;detag&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>Use a plugin. See below for further detail.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">Specifies a path to the plugin.</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">Specifies a function to be called in a plugin. It depends on the plugin.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="string-filter-rules">
<h3>string_filter_rules<a class="headerlink" href="#string-filter-rules" title="Permalink to this headline">¶</a></h3>
<p>Specifies rules how to apply filters.
The rules are checked in order.
If a datum is matched to a rule, the corresponding filter is applied and a converted value is stored to the datum.
Application is called recursively, that is, rest of filters is applied to the original values and the converted values.
Each rule is represented as a dictionary whose keys are &#8220;key&#8221;, &#8220;except&#8221; (optional), &#8220;type&#8221; and &#8220;suffix&#8221;.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">Specifies to which keys in a datum we apply the rule. We describe it in datail later.</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">Specifies which keys to exclude from the match. This is an optional parameter. We describe it in datail later.</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">Specidies the name of the filter used. This filter must de defined in &#8220;string_filter_types&#8221;. No filters are available by default.</td>
</tr>
<tr class="field-even field"><th class="field-name">suffix:</th><td class="field-body">Specifies a suffix of a key where the result of filtering is stored. For example, if &#8220;suffix&#8221; is &#8220;-detagged&#8221; and a filter is applied to &#8220;name&#8221; key in a datum, the result is stored in &#8220;name-detagged&#8221; key.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&#8220;key&#8221; and &#8220;except&#8221; can be specified in one of the following formats.
For each key in a datum, all rules checked to be applicable.
It means that if a single key matches n rules, every corresponding filter will be applied to the original key. Then, new n keys are added to the datum.
Every &#8220;key&#8221; and &#8220;except&#8221; in this document is in the same format. Similarly, it happens that multiple rules are applied to a single key.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;*&#8221; or &#8220;&#8221;</td>
<td>Matches all keys in a datum. That is, this rule is applied to every keys in the datum.</td>
</tr>
<tr class="row-odd"><td>&#8220;XXX*&#8221;</td>
<td>Matches keys whose prefixes are &#8220;XXX&#8221;.</td>
</tr>
<tr class="row-even"><td>&#8220;*XXX&#8221;</td>
<td>Matches keys whose suffixes are &#8220;XXX&#8221;.</td>
</tr>
<tr class="row-odd"><td>&#8220;/XXX/&#8221;</td>
<td>&#8220;XXX&#8221; is interpreted as a regular expression. Matches keys that the expression matches.</td>
</tr>
<tr class="row-even"><td>otherwise</td>
<td>If the key is none of the above, it matches to keys that are identical to the given string.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>When &#8220;except&#8221; is specified and both &#8220;key&#8221; and &#8220;except&#8221; matched, the rule will be skipped.
For example, by using {&#8220;key&#8221;: &#8220;*&#8221;, &#8220;except&#8221;: &#8220;foo&#8221;, ... }, you can define the rule which will be applied for every keys other than &#8220;foo&#8221;.</p>
</div>
<div class="section" id="num-filter-types">
<h3>num_filter_types<a class="headerlink" href="#num-filter-types" title="Permalink to this headline">¶</a></h3>
<p>Specifies a dictionary consists of &lt;filter name&gt;:&lt;argument&gt;, same as &#8220;string_filter_types&#8221;.
We can use it almost in the same way as &#8220;string_filter_types&#8221;.
&lt;filter name&gt; is a string and &lt;argument&gt; is a dictionary whose keys and values are both strings.
&lt;argument&gt; must contains a key named &#8220;method&#8221;. The rest of keys in &lt;argument&gt; are dependent on the value of &#8220;method&#8221;.
The followings are available values of &#8220;method&#8221; and keys that must be specified.</p>
<dl class="describe">
<dt>
<tt class="descname">add</tt></dt>
<dd><p>Add specified value to the original value.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">value:</th><td class="field-body">Specifies value to add. For example, if we add 3 to the original value, we use &#8220;3&#8221;. Note that it is not numeric but a string.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>Use a plugin. See below for further detail.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">Specifies a full path of a plugin.</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">Specifies a function to be called in the plugin.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="num-filter-rules">
<h3>num_filter_rules<a class="headerlink" href="#num-filter-rules" title="Permalink to this headline">¶</a></h3>
<p>Like &#8220;string_filter_rules&#8221;, it specifies rules how to apply filters.
Each rule is a dictionary whose keys are &#8220;key&#8221;, &#8220;except&#8221; (optional), &#8220;type&#8221; and &#8220;suffix&#8221;.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">Specifies to which keys in a datum we apply the rule. For further explanation, please read counterpart in &#8220;string_filter_rules&#8221; section.</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">Specifies which keys to exclude from the match. This is an optional parameter. For further explanation, please read counterpart in &#8220;string_filter_rules&#8221; section.</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">Specidies a name of a filter used. This filter must de defined in &#8220;string_filter_types&#8221;. No filter is available if no filter is defined in &#8220;string_filter_types&#8221;.</td>
</tr>
<tr class="field-even field"><th class="field-name">suffix:</th><td class="field-body">Specifies a suffix of a key where the result of a filtering is stored. For example, if &#8220;suffix&#8221; is &#8220;-detagged&#8221; and a filter is applied to &#8220;name&#8221; key in a datum, the result is stored in &#8220;name-detagged&#8221; key.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Format of &#8220;key&#8221; and &#8220;except&#8221; is written in &#8220;string_filter_rules&#8221; section.</p>
</div>
</div>
<div class="section" id="feature-extraction-from-strings">
<span id="construct"></span><h2>Feature Extraction from Strings<a class="headerlink" href="#feature-extraction-from-strings" title="Permalink to this headline">¶</a></h2>
<p>In this section, we explain mechanism of the feature extraction from strings. We also explain how to apply these extraction rules.
The following is an example of a configuration.
In this configuration, we use as features &#8220;user/name&#8221; itself, every 2-grams of &#8220;message&#8221;, and every word in &#8220;message-detagged&#8221; separated by spaces.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;bigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span> <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;string_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/name&quot;</span><span class="p">,</span>        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>    <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span>          <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;bigram&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;tf&quot;</span><span class="p">,</span>  <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;message-detagged&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span>  <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bin&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="string-types">
<h3>string_types<a class="headerlink" href="#string-types" title="Permalink to this headline">¶</a></h3>
<p>Feature extractors of strings are defined in &#8220;string_types&#8221;.
Some feature extractors must be defined in &#8220;string_types&#8221;. An exapmle of such extractors is one which requires arguments such as path.
As &#8220;string_filter_types&#8221;, it specifies a dictionary which consists of &lt;extractor name&gt;:&lt;argument&gt;.
Name of extractors cannot contain &#8220;&#64;&#8221; sign.
&lt;argument&gt; is a dictionary whose key and value are both strings and it must contain a key named &#8220;method&#8221;.
The rest of the keys in &lt;argument&gt; are dependent on the value of &#8220;method&#8221;.
The followings are available values of &#8220;method&#8221; and keys that must be specified.</p>
<dl class="describe">
<dt>
<tt class="descname">ngram</tt></dt>
<dd><p>Use contiguous N characters as a feature. Such a feature is called an N-gram feature.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">char_num:</th><td class="field-body">Specifies N or length of substring. N must be a positive integer. &#8220;char_num&#8221; must be specified with string type (e.g. &#8220;2&#8221;), not numeric type (e.g. 2).</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The following configuration specifies bigram (2-gram) and trigram (3-gram).</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;bigram&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span> <span class="p">},</span>
  <span class="s2">&quot;trigram&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;ngram&quot;</span><span class="p">,</span> <span class="s2">&quot;char_num&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">regexp</tt></dt>
<dd><p>Extract keywords from given document by way of regular expression matching with and use each keyword as a feature.
Matching is executed continuously, that is, every match is used as a feature.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pattern:</th><td class="field-body">Specifies mathing pattrn.</td>
</tr>
<tr class="field-even field"><th class="field-name">group:</th><td class="field-body">Specifies group to be extracted as a keyword. If this value is 0, whole match is used as a keyword. If value is positive integer, only specified group extracted with () is used. Default value is 0. &#8220;group&#8221; must be specified with string type (e.g. &#8220;2&#8221;), not numeric type (e.g. 2).</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>For list of regular expressions available, refer to the documentation of the regular expression engine (<a class="reference external" href="http://www.geocities.jp/kosako3/oniguruma/doc/RE.txt">oniguruma</a> or <a class="reference external" href="http://code.google.com/p/re2/wiki/Syntax">re2</a>).
The regular expression engine can be selected at compile time (oniguruma is used when using binary packages).</p>
<p>The following is simplest example in which we extract every representation of date (YYYY/MM/DD).</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;date&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;[0-9]{4}/[0-9]{2}/[0-9]{2}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If we use only a part of the matches, we make use of &#8220;group&#8221; argument. For example, representation of age may be extracted with such a configuration.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;regexp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pattern&quot;</span><span class="o">:</span> <span class="s2">&quot;(age|Age)([ :=])([0-9]+)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="s2">&quot;3&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>Use a plugin. See below for further detail.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">Specifies a path to a plugin.</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">Specifies a function to be called in a plugin.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="string-rules">
<h3>string_rules<a class="headerlink" href="#string-rules" title="Permalink to this headline">¶</a></h3>
<p>Specifies how to extract string features.
As &#8220;string_filter_rules&#8221;, it consists of multiple rules.
Each rule is a dictionary whose keys are &#8220;key&#8221;, &#8220;except&#8221; (optional), &#8220;type&#8221;, &#8220;sample_weight&#8221; and &#8220;global_weight&#8221;.
These rules specifies how we extract rules from given strings and their weights used in calculating scores.
A weight is calculated with two parameters, &#8220;sample_weight&#8221; and &#8220;global_weight&#8221;.
In concrete, the weight is the product of these two weights.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body"><p class="first">Specifies to which keys in a datum we apply the rule. For further explanation, please read counterpart in &#8220;string_filter_rules&#8221; section.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body"><p class="first">Specifies which keys to exclude from the match. This is an optional parameter. For further explanation, please read counterpart in &#8220;string_filter_rules&#8221; section.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body"><p class="first">Specifies the name of an extractor in use. The extractor is either one defined in &#8220;string_types&#8221; or one of pre-defined extractors. The followings are the pre-defined extractors.</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;str&quot;</span></tt></td>
<td>Use given string itself as a feature without separating it.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;space&quot;</span></tt></td>
<td>Separate given string by spaces and use a set of substrings as features.</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="field-even field"><th class="field-name">sample_weight:</th><td class="field-body"><p class="first">Specifies weight of each feature. Note that as term frequency is, &#8220;sample_weight&#8221; is uniquely defined if feature and datum are specified.</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;bin&quot;</span></tt></td>
<td>sample_weight is 1 for all features and all data.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;tf&quot;</span></tt></td>
<td>sample_weight is frequency of the feature in given string. It is called Term Frequency. For example, if &#8220;hello&#8221; is appeared five times, its sample_weight for this string is 5.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;log_tf&quot;</span></tt></td>
<td>sample_weight is the logarithm of tf added by 1. For example, if &#8220;hello&#8221; is appeared five times, its sample_weight is log(5+1).</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">global_weight:</th><td class="field-body"><p class="first">Specifies global weight calculated from data inputted so far.</p>
<table border="1" class="last docutils">
<colgroup>
<col width="4%" />
<col width="96%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;bin&quot;</span></tt></td>
<td>global_weight is 1 for all features.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;idf&quot;</span></tt></td>
<td>global_weight is the inverse of logarithm of normalized document frequency. It is called Inverse Document Frequency. For example, if a feature is included in 50 documents of all 1000 documents, its global_weight is log(1000/50). Roughly speaking, the less a feature frequently appears, the greater its idf is.</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>In most of machine learning tasks, it works well even if we use &#8220;bin&#8221; in both sample_weight and global_weight.
In some kind of tasks, in which weight itself is trained, weight are adjusted automatically even if we set &#8220;bin&#8221; in sample_weight and global_weight. Classification is an example of such a task.</p>
</div>
</div>
<div class="section" id="feature-extraction-from-numbers">
<h2>Feature Extraction from Numbers<a class="headerlink" href="#feature-extraction-from-numbers" title="Permalink to this headline">¶</a></h2>
<p>As with strings, feature extraction rules are also described for numeric types.
We can make user-defined extractors for numeric types, too.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;num_types&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="p">},</span>
<span class="s2">&quot;num_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age&quot;</span><span class="p">,</span>       <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/income&quot;</span><span class="p">,</span>    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;user/age_kazoe&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;num&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="num-types">
<h3>num_types<a class="headerlink" href="#num-types" title="Permalink to this headline">¶</a></h3>
<p>Feature extractors for numeric data are defined in &#8220;num_types&#8221;.
As with &#8220;string_types&#8221;, it specifies a dictionary which consists of &lt;extractor name&gt;:&lt;argument&gt;.
&lt;argument&gt; is a dictionary whose keys and values are both strings and must contain a key named &#8220;method&#8221;.
The rest of keys in &lt;argument&gt; are dependent on the value of &#8220;method&#8221;.
The followings are available values of &#8220;method&#8221; and keys that must be specified.</p>
<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>Use a plugin. See below for further detail.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">Specifies a path to a plugin.</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">Specifies a function to be called in a plugin.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="num-rules">
<h3>num_rules<a class="headerlink" href="#num-rules" title="Permalink to this headline">¶</a></h3>
<p>Specifies how to extract numeric features.
As &#8220;string_rules&#8221;, it consists of multiple rules.
Each rule is a dictionary whose keys are &#8220;key&#8221;, &#8220;except&#8221; (optional) and &#8220;type&#8221;.
It depends on &#8220;type&#8221; how to specify weight and name features.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body"><p class="first">Specifies to which keys in a datum we apply the rule. For further explanation, please read counterpart in &#8220;string_filter_rules&#8221; section.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body"><p class="first">Specifies which keys to exclude from the match. This is an optional parameter. For further explanation, please read counterpart in &#8220;string_filter_rules&#8221; section.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body"><p class="first">Specifies the name of extractor in use. The extractor is either one defined in &#8220;num_types&#8221; or one of pre-defined extractors. The followings are the pre-defined extractors.</p>
<table border="1" class="last docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;num&quot;</span></tt></td>
<td>Use given number itself as weight.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;log&quot;</span></tt></td>
<td>Use logarithm of given number as weight. If the number is not positive, weight is 0.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;str&quot;</span></tt></td>
<td>Use given number as a string. This extractor is used when the value of the number is not important, such as user ID. Weight is set to be 1.</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="feature-extraction-from-binary-data">
<h2>Feature Extraction from Binary Data<a class="headerlink" href="#feature-extraction-from-binary-data" title="Permalink to this headline">¶</a></h2>
<p>As with strings, feature extraction rules are also described for binary types.
We can make user-defined extractors for binary types, too.</p>
<div class="section" id="binary-types">
<h3>binary_types<a class="headerlink" href="#binary-types" title="Permalink to this headline">¶</a></h3>
<p>Feature extractors for binary data are defined in &#8220;binary_types&#8221;.
As with &#8220;string_types&#8221;, it specifies a dictionary which consists of &lt;extractor name&gt;:&lt;argument&gt;.
&lt;argument&gt; is a dictionary whose keys and values are both strings and must contain a key named &#8220;method&#8221;.
The rest of keys in &lt;argument&gt; are dependent on the value of &#8220;method&#8221;.
The followings are available values of &#8220;method&#8221; and keys that must be specified.</p>
<dl class="describe">
<dt>
<tt class="descname">dynamic</tt></dt>
<dd><p>Use a plugin. See below for further detail.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">path:</th><td class="field-body">Specifies a path to a plugin.</td>
</tr>
<tr class="field-even field"><th class="field-name">function:</th><td class="field-body">Specifies a function to be called in a plugin.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="binary-rules">
<h3>binary_rules<a class="headerlink" href="#binary-rules" title="Permalink to this headline">¶</a></h3>
<p>Specifies how to extract binary features.
As &#8220;string_rules&#8221;, it consists of multiple rules.
Each rule is a dictionary whose keys are &#8220;key&#8221;, &#8220;except&#8221; (optional) and &#8220;type&#8221;.
It depends on &#8220;type&#8221; how to specify weight and name features.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">key:</th><td class="field-body">Specifies to which keys in a datum we apply the rule. For further explanation, please read counterpart in &#8220;string_filter_rules&#8221; section.</td>
</tr>
<tr class="field-even field"><th class="field-name">except:</th><td class="field-body">Specifies which keys to exclude from the match. This is an optional parameter. For further explanation, please read counterpart in &#8220;string_filter_rules&#8221; section.</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body">Specifies the name of extractor in use. The extractor is either one defined in &#8220;binary_types&#8221;. Note that no pre-defined extractors are prepared.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="hashing-key-of-feature-vector">
<h2>Hashing Key of Feature Vector<a class="headerlink" href="#hashing-key-of-feature-vector" title="Permalink to this headline">¶</a></h2>
<p>To reduce memory consumption, Jubatus can hash keys of feature vectors.
By hashing feature vector keys, you can limit a maximum dimension of feature vectors, although this may decrease the accuracy of the result when one hash value collides with another.</p>
<p>This function is disabled by default.
To use this option, specify the <tt class="docutils literal"><span class="pre">hash_max_size</span></tt> in the converter configuration.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;global_weight&quot;</span> <span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">}],</span>
  <span class="s">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&quot;key&quot;</span> <span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;num&quot;</span><span class="p">}],</span>
  <span class="s">&quot;binary_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s">&quot;binary_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s">&quot;hash_max_size&quot;</span><span class="p">:</span> <span class="mi">16</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The appropriate number of <tt class="docutils literal"><span class="pre">hash_max_size</span></tt> depends on the data set you use and your environment.
Note that <tt class="docutils literal"><span class="pre">hash_max_size</span></tt> is not a limit for a number of keys in the original datum, but a number of keys in (converted) feature vectors.</p>
</div>
<div class="section" id="plugins">
<span id="conversion-plugin"></span><h2>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h2>
<p>We can use plugins of filters and extractors in fv_converter.
A plugin is a single dynamic library file (.so file).
We will explain how to make plugins later. In this section, we will describe how to use plugins.</p>
<p>How to specify plugin is same in both filters and extractors.
In CLASS_types (CLASS is either <tt class="docutils literal"><span class="pre">string</span></tt> or <tt class="docutils literal"><span class="pre">num</span></tt>), we should specify &#8220;dynamic&#8221; in &#8220;method&#8221;, a path to a .so file in &#8220;path&#8221; and the name of function defined in the plugin in &#8220;function&#8221;.
Path to the plugin may either be a full path, or a file name if the plugin is in the default plugin directory (<tt class="docutils literal"><span class="pre">$PREFIX/lib/jubatus/plugin</span></tt> or <tt class="docutils literal"><span class="pre">$PREFIX/lib64/jubatus/plugin</span></tt> in most cases).
Argument of the function is specified by other parameters.</p>
<p>In Jubatus we can make use of three pre-defined plugins which aim to extraction of features from strings.
Note that some plugins are not available depending on your compile options.</p>
<dl class="describe">
<dt>
<tt class="descname">libmecab_splitter.so</tt></dt>
<dd><p>We can specify this plugin in &#8220;string_types&#8221;.
Separate given Japanese document into words by <a class="reference external" href="http://code.google.com/p/mecab/">MeCab</a> and use each word as a feature.
This plugin is available only when compiled with <tt class="docutils literal"><span class="pre">--enable-mecab</span></tt>.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">Specify &#8220;create&#8221;.</td>
</tr>
<tr class="field-even field"><th class="field-name">arg:</th><td class="field-body">Specify arguments to MeCab engine (in the following example, we use -d to specify the dictionary directory). &#8220;arg&#8221; is not specified, Mecab works with default configuration.
Refer to the <a class="reference external" href="http://mecab.googlecode.com/svn/trunk/mecab/doc/mecab.html">document of MeCab</a> about how to specify arguments.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;mecab&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libmecab_splitter.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arg&quot;</span><span class="o">:</span> <span class="s2">&quot;-d /usr/lib64/mecab/dic/ipadic&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">libux_splitter.so</tt></dt>
<dd><p>We can specify this plugin in &#8220;string_types&#8221;.
Extract keywords from given document by way of dictionary matching with <a class="reference external" href="http://code.google.com/p/ux-trie/">ux-trie</a> and use each keyword as a feature.
Matching is a simple longest matching. Note that it is fast but precision may be low.
This plugin is available only when compiled with <tt class="docutils literal"><span class="pre">--enable-ux</span></tt>.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">function:</th><td class="field-body">Specifies &#8220;create&#8221;.</td>
</tr>
<tr class="field-even field"><th class="field-name">dict_path:</th><td class="field-body">Specifies a full path of a dictionary file. The dictionary file is a text file that consists of keywords, one keyword per one line.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;ux&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;libux_splitter.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dict_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/path/to/keyword/dic.txt&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plugin.html" title="Plugin Development"
             >next</a> |</li>
        <li class="right" >
          <a href="processes.html" title="Architecture"
             >previous</a> |</li>
        <li><a href="index.html">Jubatus</a> &raquo;</li>
          <li><a href="documentation.html" >Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011,2013 PFI &amp; NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>