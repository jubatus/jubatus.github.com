

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; Jubatus 0.3.4 documentation</title>
    <link rel="stylesheet" href="../_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Jubatus 0.3.4 documentation" href="../index.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="documentation.html" title="Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Jubatus 0.3.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="../index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#scenario">Scenario</a></li>
<li><a class="reference internal" href="#standalone-mode">Standalone Mode</a><ul>
<li><a class="reference internal" href="#run-tutorial">Run Tutorial</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tutorial-in-detail">Tutorial in Detail</a><ul>
<li><a class="reference internal" href="#dataset">Dataset</a></li>
<li><a class="reference internal" href="#server-configuration">Server Configuration</a></li>
<li><a class="reference internal" href="#use-of-classifier-api-train-classify">Use of Classifier API: Train &amp; Classify</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cluster-mode">Cluster Mode</a><ul>
<li><a class="reference internal" href="#setup-zookeeper">Setup ZooKeeper</a></li>
<li><a class="reference internal" href="#jubatus-keeper">Jubatus Keeper</a></li>
<li><a class="reference internal" href="#join-jubatus-servers-to-cluster">Join Jubatus Servers to Cluster</a></li>
<li><a class="reference internal" href="#id1">Run Tutorial</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cluster-management-in-jubatus">Cluster Management in Jubatus</a><ul>
<li><a class="reference internal" href="#zookeepers-jubatus-keepers">ZooKeepers &amp; Jubatus Keepers</a></li>
<li><a class="reference internal" href="#jubavisor-process-management-agent">Jubavisor: Process Management Agent</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="documentation.html"
                        title="next chapter">Documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/en/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<script src="http://widgets.twimg.com/j/2/widget.js"></script>
<script>
new TWTR.Widget({
  version: 2,
  type: 'profile',
  rpp: 4,
  interval: 30000,
  width: 220,
  height: 300,
  theme: {
    shell: {
      background: '#333333',
      color: '#ffffff'
    },
    tweets: {
      background: '#000000',
      color: '#ffffff',
      links: '#4aed05'
    }
  },
  features: {
    scrollbar: false,
    loop: false,
    live: false,
    behavior: 'all'
  }
}).render().setUser('JubatusOfficial').start();
</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>Before trying the tutorial, you need to install Jubatus and Jubatus Python client. See <a class="reference internal" href="quickstart.html"><em>Quick Start</em></a> for instructions.</p>
<div class="section" id="scenario">
<h2>Scenario<a class="headerlink" href="#scenario" title="Permalink to this headline">¶</a></h2>
<p>This tutorial uses <a class="reference external" href="http://people.csail.mit.edu/jrennie/20Newsgroups/">News20</a> dataset (<tt class="docutils literal"><span class="pre">20news-bydate.tar.gz</span></tt>) which is a popular for experiments in text classiication.
News20 has 20 different newsgroups and users post thier message on a suitable newsgroup.
News20 is divided into learning data (20news-bydate-train, 80%) and experimental data (20news-bydata-test, 20%).</p>
<p>The goal of this tutorial is to learn model from 20news-bydate-train and to guess the newsgroup to post from 20news-bydate-test.</p>
</div>
<div class="section" id="standalone-mode">
<h2>Standalone Mode<a class="headerlink" href="#standalone-mode" title="Permalink to this headline">¶</a></h2>
<p>Simply run <tt class="docutils literal"><span class="pre">jubaclassifier</span></tt> program that provides classification feature.</p>
<div class="highlight-python"><pre>$ jubaclassifier
I1128 16:52:51.031333  4200 server_util.cpp:136] starting jubaclassifier 0.3.4 RPC server at 192.168.1.2:9199
  pid            : 4200
  user           : jubatus
  mode           : standalone mode
  timeout        : 10
  thread         : 2
  tmpdir         : /tmp
  logdir         :
  zookeeper      :
  name           :
  join           : false
  interval sec   : 16
  interval count : 512</pre>
</div>
<p>Jubatus classification service is now started.
Jubatus servers listen on TCP port 9199 by default.
If you would like to use another port, specify it using <tt class="docutils literal"><span class="pre">--rcp-port</span></tt> option.
For example, to use port 19199:</p>
<div class="highlight-python"><pre>$ jubaclassifier --rpc-port 19199</pre>
</div>
<p>Jubatus and Jubatus clients communicate with each other in <a class="reference external" href="http://msgpack.org">MessagePack-RPC</a> protocol over the TCP/IP network.</p>
<div class="figure">
<img alt="single client, single server" src="../_images/single_single.png" style="width: 70%;" />
</div>
<div class="section" id="run-tutorial">
<h3>Run Tutorial<a class="headerlink" href="#run-tutorial" title="Permalink to this headline">¶</a></h3>
<p>Download the <a class="reference external" href="https://github.com/jubatus/jubatus-tutorial-python">tutorial program</a> and the dataset.</p>
<div class="highlight-python"><pre>$ git clone https://github.com/jubatus/jubatus-tutorial-python.git
$ cd jubatus-tutorial-python
$ wget http://people.csail.mit.edu/jrennie/20Newsgroups/20news-bydate.tar.gz
$ tar xvzf 20news-bydate.tar.gz</pre>
</div>
<p>Then, run the program.</p>
<div class="highlight-python"><pre>$ python tutorial.py</pre>
</div>
<p>Now you&#8217;ll see the result of classification!
Read below for more detailed description.</p>
</div>
</div>
<div class="section" id="tutorial-in-detail">
<h2>Tutorial in Detail<a class="headerlink" href="#tutorial-in-detail" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dataset">
<h3>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h3>
<p>After expanding <tt class="docutils literal"><span class="pre">20news-bydate.tar.gz</span></tt>, you see files like this:</p>
<div class="highlight-python"><pre>20news-bydate-train
|-- alt.atheism
|   |-- 49960
|   |-- 51060
|   |-- 51119
|   |-- 51120
:   :     :
|-- comp.graphics
|-- comp.os.ms-windows.misc
|-- comp.sys.ibm.pc.hardware
|-- comp.sys.mac.hardware
|-- comp.windows.x
|-- misc.forsale
|-- rec.autos
|-- rec.motorcycles
|-- rec.sport.baseball
|-- rec.sport.hockey
|-- sci.crypt
|-- sci.electronics
|-- sci.med
|-- sci.space
|-- soc.religion.christian
|-- talk.politics.guns
|-- talk.politics.mideast
|-- talk.politics.misc
`-- talk.religion.misc</pre>
</div>
<p><tt class="docutils literal"><span class="pre">49960</span></tt> is one of messages and <tt class="docutils literal"><span class="pre">alt.atheism</span></tt> is one of newsgroups the message is posted.
For example, <tt class="docutils literal"><span class="pre">20news-bydate-train/rec.motorcycles/104435</span></tt> contains:</p>
<div class="highlight-python"><pre>From: karr@cs.cornell.edu (David Karr)
Subject: Re: BMW MOA members read this!
Organization: Cornell Univ. CS Dept, Ithaca NY 14853
Lines: 19

In article &lt;C5Joz9.HLn@cup.hp.com&gt; Chris Steinbroner &lt;hesh@cup.hp.com&gt; writes:
&gt;Wm. L. Ranck (ranck@joesbar.cc.vt.edu) wrote:
&gt;: As a new BMW owner I was thinking about signing up for the MOA, but
&gt;: right now it is beginning to look suspiciously like throwing money
&gt;: down a rathole.
&gt;
&gt;[...] i'm going to
&gt;let my current membership lapse when it's
&gt;up for renewal.
&gt;
&gt;-- hesh

In my case that's not for another 3+ years, so I'd appreciate any
hints on what will keep the organization in business that long.  (And
preferably longer, of course, and worth being part of.)

-- David Karr (karr@cs.cornell.edu)</pre>
</div>
<p>In this tutorial, we use these text as the training data.</p>
</div>
<div class="section" id="server-configuration">
<h3>Server Configuration<a class="headerlink" href="#server-configuration" title="Permalink to this headline">¶</a></h3>
<p>You can setup a behavior of <tt class="docutils literal"><span class="pre">jubaclassifier</span></tt> using <tt class="docutils literal"><span class="pre">set_config</span></tt> API.
There are two configurable parameter: <tt class="docutils literal"><span class="pre">method</span></tt> and <tt class="docutils literal"><span class="pre">converter</span></tt>.
Examle of these parameters are as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">converter</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s">&#39;string_filter_types&#39;</span><span class="p">:</span> <span class="p">{},</span>
          <span class="s">&#39;string_filter_rules&#39;</span><span class="p">:[],</span>
          <span class="s">&#39;num_filter_types&#39;</span><span class="p">:</span> <span class="p">{},</span>
          <span class="s">&#39;num_filter_rules&#39;</span><span class="p">:</span> <span class="p">[],</span>
          <span class="s">&#39;string_types&#39;</span><span class="p">:</span> <span class="p">{},</span>
          <span class="s">&#39;string_rules&#39;</span><span class="p">:</span> <span class="p">[],</span>
          <span class="s">&#39;num_types&#39;</span><span class="p">:</span> <span class="p">{},</span>
          <span class="s">&#39;num_rules&#39;</span><span class="p">:</span> <span class="p">[]</span>
         <span class="p">}</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">config_data</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">algo</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">converter</span><span class="p">))</span>
</pre></div>
</div>
<p>You can choose one of the following algorithm as <tt class="docutils literal"><span class="pre">method</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">perceptron</span></tt></li>
<li><tt class="docutils literal"><span class="pre">PA</span></tt>, <tt class="docutils literal"><span class="pre">PA1</span></tt>, <tt class="docutils literal"><span class="pre">PA2</span></tt></li>
<li><tt class="docutils literal"><span class="pre">CW</span></tt></li>
<li><tt class="docutils literal"><span class="pre">AROW</span></tt></li>
<li><tt class="docutils literal"><span class="pre">NHERD</span></tt></li>
</ul>
<p>We use <tt class="docutils literal"><span class="pre">PA</span></tt> in this tutorial.</p>
<p><tt class="docutils literal"><span class="pre">converter</span></tt> decides how to extract feature vector from input data (see <a class="reference internal" href="fv_convert.html"><em>Data Conversion</em></a> for details).</p>
<p>In this tutorial, input data is the text of natural language.
Many languages such as English, &lt;space&gt; and &lt;return&gt; can be split into words.
Jubatus supports this feature by default.
HTML tags are noisy to classify the contents so we will remove the part that is enclosed in &#8220;&lt;&gt;&#8221;.</p>
<p>Using this feature, you can apply multiple rules such as natural language process and weighting of values.
These rules expressed as follows in JSON.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">converter</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;string_filter_types&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;detag&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s">&quot;method&quot;</span><span class="p">:</span> <span class="s">&quot;regexp&quot;</span><span class="p">,</span> <span class="s">&quot;pattern&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span> <span class="p">}</span>
         <span class="p">},</span>
        <span class="s">&#39;string_filter_rules&#39;</span><span class="p">:</span>
           <span class="p">[</span>
          <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;detag&quot;</span><span class="p">,</span> <span class="s">&quot;suffix&quot;</span><span class="p">:</span> <span class="s">&quot;-detagged&quot;</span> <span class="p">}</span>
           <span class="p">],</span>
          <span class="s">&#39;num_filter_types&#39;</span><span class="p">:</span> <span class="p">{},</span>
          <span class="s">&#39;num_filter_rules&#39;</span><span class="p">:</span> <span class="p">[],</span>
          <span class="s">&#39;string_types&#39;</span><span class="p">:</span> <span class="p">{},</span>
          <span class="s">&#39;string_rules&#39;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;message-detagged&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&quot;space&quot;</span><span class="p">,</span> <span class="s">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;global_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">}</span>
              <span class="p">],</span>
          <span class="s">&#39;num_types&#39;</span><span class="p">:</span> <span class="p">{},</span>
          <span class="s">&#39;num_rules&#39;</span><span class="p">:</span> <span class="p">[]</span>
          <span class="p">}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">get_config</span></tt> will return the configuration currently set in the server.</p>
</div>
<div class="section" id="use-of-classifier-api-train-classify">
<h3>Use of Classifier API: Train &amp; Classify<a class="headerlink" href="#use-of-classifier-api-train-classify" title="Permalink to this headline">¶</a></h3>
<p>Call <tt class="docutils literal"><span class="pre">train</span></tt> API (RPC method) to update models in the classifier.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">train_dat</span> <span class="o">=</span> <span class="p">[</span>
              <span class="p">(</span>
                <span class="s">&quot;comp.sys.mac.hardware&quot;</span><span class="p">,</span>
                <span class="p">[[</span><span class="s">&quot;message&quot;</span> <span class="p">,</span> <span class="s">&quot;I want to buy a new mac book air...&quot;</span><span class="p">],</span> <span class="p">[]]</span>
              <span class="p">)</span>
            <span class="p">]</span>
</pre></div>
</div>
<p>Call <tt class="docutils literal"><span class="pre">classify</span></tt> API to analyze (in this case, let Jubatus classify the given data) with models.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">classify_dat</span> <span class="o">=</span> <span class="p">[</span>
                 <span class="p">[[</span><span class="s">&quot;message&quot;</span> <span class="p">,</span> <span class="s">&quot;I bought a new mac book air...&quot;</span><span class="p">],</span> <span class="p">[]]</span>
               <span class="p">]</span>
</pre></div>
</div>
<p>The return format of <tt class="docutils literal"><span class="pre">classify</span></tt> method is as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[[</span>
     <span class="p">[</span><span class="s">&quot;comp.sys.mac.hardware&quot;</span><span class="p">,</span> <span class="mf">1.10477745533</span><span class="p">],</span>
     <span class="o">...</span>
     <span class="p">[</span><span class="s">&quot;rec.sport.hockey&quot;</span><span class="p">,</span> <span class="mf">2.0973217487300002</span><span class="p">],</span>
     <span class="p">[</span><span class="s">&quot;comp.os.ms-windows.misc&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.065333858132400002</span><span class="p">],</span>
     <span class="p">[</span><span class="s">&quot;sci.electronics&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.184129983187</span><span class="p">],</span>
     <span class="p">[</span><span class="s">&quot;talk.religion.misc&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.092822007834899994</span><span class="p">]</span>
<span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cluster-mode">
<h2>Cluster Mode<a class="headerlink" href="#cluster-mode" title="Permalink to this headline">¶</a></h2>
<p>You can run Jubatus in a distributed environment using ZooKeeper and Jubatus keepers.</p>
<div class="figure">
<img alt="single client, multi servers" src="../_images/single_multi.png" style="width: 70%;" />
</div>
<div class="section" id="setup-zookeeper">
<h3>Setup ZooKeeper<a class="headerlink" href="#setup-zookeeper" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://zookeeper.apache.org/">ZooKeeper</a> is a centralized service for maintaining configuration information, naming, providing distributed synchronization, and providing group services.
Jubatus in cluster mode uses ZooKeeper to manage Jubatus servers and keepers in cluster environment.</p>
<p>Run ZooKeeper server like this:</p>
<div class="highlight-python"><pre>$ /path/to/zookeeper/bin/zkServer.sh start
JMX enabled by default
Using config: /path/to/zookeeper/bin/../conf/zoo.cfg
Starting zookeeper ...
STARTED</pre>
</div>
<p>Here we assume that ZooKeeper is running on localhost:2181. You can change it in the <tt class="docutils literal"><span class="pre">zoo.cfg</span></tt> file.</p>
</div>
<div class="section" id="jubatus-keeper">
<h3>Jubatus Keeper<a class="headerlink" href="#jubatus-keeper" title="Permalink to this headline">¶</a></h3>
<p>Jubatus keepers proxy RPC requests from clients to servers.
In distributed environment, make RPC requests from clients to keepers, not directly to servers.</p>
<p>Jubatus keepers are provided for each Jubatus servers.
For the classifier, <tt class="docutils literal"><span class="pre">jubaclassifier_keeper</span></tt> is the corresponding keeper.</p>
<div class="highlight-python"><pre>$ jubaclassifier_keeper --zookeeper=localhost:2181 --rpc-port=9198</pre>
</div>
<p>Now <tt class="docutils literal"><span class="pre">jubaclassifier_keeper</span></tt> started listening on TCP 9198 port.</p>
</div>
<div class="section" id="join-jubatus-servers-to-cluster">
<h3>Join Jubatus Servers to Cluster<a class="headerlink" href="#join-jubatus-servers-to-cluster" title="Permalink to this headline">¶</a></h3>
<p>To start Jubatus servers in cluster mode, give <tt class="docutils literal"><span class="pre">--name</span></tt> and <tt class="docutils literal"><span class="pre">--zookeeper</span></tt> option when executing servers.
Server processes started with same name belongs to the same cluster and they collaborate with one another.</p>
<p>If you want to start multiple server processes on the same machine, please note that you must change the port for each processes.</p>
<div class="highlight-python"><pre>$ jubaclassifier --rpc-port=9180 --name=tutorial --zookeeper=localhost:2181 &amp;
$ jubaclassifier --rpc-port=9181 --name=tutorial --zookeeper=localhost:2181 &amp;
$ jubaclassifier --rpc-port=9182 --name=tutorial --zookeeper=localhost:2181 &amp;</pre>
</div>
<p>When Jubatus servers are started in cluster mode, they create a node in ZooKeeper system.
You can verify that three server processes are registered to ZooKeeper system by using ZooKeeper client.</p>
<div class="highlight-python"><pre>$ /path/to/zookeeper/bin/zkCli.sh -server localhost:2181
[zk: localhost:2181(CONNECTED) 0] ls /jubatus/actors/classifier/tutorial/nodes
[XXX.XXX.XXX.XXX_9180, XXX.XXX.XXX.XXX__9181, XXX.XXX.XXX.XXX__9182]</pre>
</div>
</div>
<div class="section" id="id1">
<h3>Run Tutorial<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Run the tutorial program again, but this time we use options to specify port to connect to keepers instead of servers.
In cluster mode, you also need to specify the cluster name when making RPC request to keepers.</p>
<div class="highlight-python"><pre>$ python tutorial.py --server_port=9198 --name=tutorial</pre>
</div>
<p>Note that you can use the same client code for both standalone mode and distributed mode.</p>
</div>
</div>
<div class="section" id="cluster-management-in-jubatus">
<h2>Cluster Management in Jubatus<a class="headerlink" href="#cluster-management-in-jubatus" title="Permalink to this headline">¶</a></h2>
<p>Jubatus has a mechanism to centrally manage various processes.
In this tutorial, you will execute some process on each servers like the following table.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">IP Address</th>
<th class="head">Processes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>192.168.0.1</td>
<td>Terminal</td>
</tr>
<tr class="row-odd"><td>192.168.0.11</td>
<td>jubaclassifier - 1</td>
</tr>
<tr class="row-even"><td>192.168.0.12</td>
<td>jubaclassifier - 2</td>
</tr>
<tr class="row-odd"><td>192.168.0.13</td>
<td>jubaclassifier - 3</td>
</tr>
<tr class="row-even"><td>192.168.0.101</td>
<td>jubaclassifier_keeper/client - 1</td>
</tr>
<tr class="row-odd"><td>192.168.0.102</td>
<td>jubaclassifier_keeper/client - 2</td>
</tr>
<tr class="row-even"><td>192.168.0.103</td>
<td>jubaclassifier_keeper/client - 3</td>
</tr>
<tr class="row-odd"><td>192.168.0.211</td>
<td>ZooKeeper - 1</td>
</tr>
<tr class="row-even"><td>192.168.0.212</td>
<td>ZooKeeper - 2</td>
</tr>
<tr class="row-odd"><td>192.168.0.213</td>
<td>ZooKeeper - 3</td>
</tr>
</tbody>
</table>
<p>For the best practices, see <a class="reference internal" href="admin.html"><em>Administration Guide</em></a>.</p>
<div class="figure">
<img alt="multi clients, multi servers" src="../_images/multi_multi.png" style="width: 70%;" />
</div>
<div class="section" id="zookeepers-jubatus-keepers">
<h3>ZooKeepers &amp; Jubatus Keepers<a class="headerlink" href="#zookeepers-jubatus-keepers" title="Permalink to this headline">¶</a></h3>
<p>Start ZooKeeper servers (make sure you configure an ensemble between them).</p>
<div class="highlight-python"><pre>[192.168.0.211]$ bin/zkServer.sh start
[192.168.0.212]$ bin/zkServer.sh start
[192.168.0.213]$ bin/zkServer.sh start</pre>
</div>
<p>Start <tt class="docutils literal"><span class="pre">jubaclassifier_keeper</span></tt> processes. <tt class="docutils literal"><span class="pre">jubaclassifier_keeper</span></tt> uses TCP 9199 port by default.</p>
<div class="highlight-python"><pre>[192.168.0.101]$ jubaclassifier_keeper --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181
[192.168.0.102]$ jubaclassifier_keeper --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181
[192.168.0.103]$ jubaclassifier_keeper --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181</pre>
</div>
</div>
<div class="section" id="jubavisor-process-management-agent">
<h3>Jubavisor: Process Management Agent<a class="headerlink" href="#jubavisor-process-management-agent" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">jubavisor</span></tt> is an agent process that manages server processes.</p>
<p><tt class="docutils literal"><span class="pre">jubavisor</span></tt> can manage each Jubatus server processes by receiving RPC requests from <tt class="docutils literal"><span class="pre">jubactl</span></tt>, a controller command.
<tt class="docutils literal"><span class="pre">jubavisor</span></tt> uses TCP 9198 port by default.</p>
<div class="highlight-python"><pre>[192.168.0.11]$ jubavisor --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181 --daemon
[192.168.0.22]$ jubavisor --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181 --daemon
[192.168.0.33]$ jubavisor --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181 --daemon</pre>
</div>
<p>Now send commands from <tt class="docutils literal"><span class="pre">jubactl</span></tt> to <tt class="docutils literal"><span class="pre">jubavisor</span></tt>.</p>
<div class="highlight-python"><pre>[192.168.0.1]$ jubactl -c start  --server=classifier --type=classifier --name=tutorial --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181
[192.168.0.1]$ jubactl -c status --server=classifier --type=classifier --name=tutorial --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181
active jubaclassifier_keeper members:
 192.168.0.101_9199
 192.168.0.102_9199
 192.168.0.103_9199
active jubavisor members:
 192.168.0.11_9198
 192.168.0.12_9198
 192.168.0.13_9198
active tutorial members:
 192.168.0.11_9199
 192.168.0.12_9199
 192.168.0.13_9199</pre>
</div>
<p>From members list, you can see the server is running.
Now run clients simultaneously, from multiple hosts.</p>
<div class="highlight-python"><pre>[192.168.0.101]$ python tutorial.py --name=tutorial --server_ip 127.0.0.1:9199
[192.168.0.102]$ python tutorial.py --name=tutorial --server_ip 127.0.0.1:9199
[192.168.0.103]$ python tutorial.py --name=tutorial --server_ip 127.0.0.1:9199</pre>
</div>
<p>You can also stop instance of Jubatus server from <tt class="docutils literal"><span class="pre">jubactl</span></tt>.</p>
<div class="highlight-python"><pre>[192.168.0.1]$ jubactl -c stop --server=classifier --type=classifier --name=tutorial --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="documentation.html" title="Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             >previous</a> |</li>
        <li><a href="../index.html">Jubatus 0.3.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011,2012 PFI&amp;NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>