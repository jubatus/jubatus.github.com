

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Java &mdash; Jubatus</title>
    <link rel="stylesheet" href="../_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="../index.html" />
    <link rel="up" title="Regression" href="regression.html" />
    <link rel="next" title="Graph" href="graph.html" />
    <link rel="prev" title="Ruby" href="regression_ruby.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="graph.html" title="Graph"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="regression_ruby.html" title="Ruby"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="../tutorial.html" >Tutorial</a> &raquo;</li>
          <li><a href="regression.html" accesskey="U">Regression</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="../index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Java</a><ul>
<li><a class="reference internal" href="#source-code">Source_code</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
<li><a class="reference internal" href="#run-the-sample-program">Run the sample program</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="regression_ruby.html"
                        title="previous chapter">Ruby</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="graph.html"
                        title="next chapter">Graph</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorial/regression_java.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JubatusOfficial"  data-widget-id="258379257628196864">Tweets by @JubatusOfficial</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="java">
<h1>Java<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h1>
<p>Here we explain the sample program of Regression in Java.</p>
<div class="section" id="source-code">
<h2>Source_code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>In this sample program, we will explain 1) how to configure the learning-algorithms that used by Jubatus, with the example file &#8216;rent.json&#8217;; 2) how to train the model by &#8216;rent.java&#8217; with the training data in &#8216;rent-data.csv&#8217; file, and how to predict with the estimation data in &#8216;myhome.yml&#8217; file. Here are the source codes of &#8216;rent.json&#8217;, &#8216;rent.java&#8217; and &#8216;myhome.yml&#8217;.</p>
<p><strong>rent.json</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="mo">01</span> <span class="p">:</span> <span class="p">{</span>
<span class="mo">02</span> <span class="p">:</span>   <span class="s">&quot;method&quot;</span><span class="p">:</span> <span class="s">&quot;PA&quot;</span><span class="p">,</span>
<span class="mo">03</span> <span class="p">:</span>   <span class="s">&quot;converter&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="mo">04</span> <span class="p">:</span>     <span class="s">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="mo">05</span> <span class="p">:</span>     <span class="s">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="mo">06</span> <span class="p">:</span>     <span class="s">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="mo">07</span> <span class="p">:</span>     <span class="s">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="mi">08</span> <span class="p">:</span>     <span class="s">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="mi">09</span> <span class="p">:</span>     <span class="s">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="mi">10</span> <span class="p">:</span>       <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;num&quot;</span> <span class="p">}</span>
<span class="mi">11</span> <span class="p">:</span>     <span class="p">],</span>
<span class="mi">12</span> <span class="p">:</span>     <span class="s">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="mi">13</span> <span class="p">:</span>     <span class="s">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="mi">14</span> <span class="p">:</span>       <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;aspect&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;global_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span> <span class="p">}</span>
<span class="mi">15</span> <span class="p">:</span>     <span class="p">]</span>
<span class="mi">16</span> <span class="p">:</span>   <span class="p">},</span>
<span class="mi">17</span> <span class="p">:</span>   <span class="s">&quot;parameter&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="mi">18</span> <span class="p">:</span>     <span class="s">&quot;sensitivity&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="mi">19</span> <span class="p">:</span>     <span class="s">&quot;regularization_weight&quot;</span><span class="p">:</span> <span class="mf">3.402823e+38</span>
<span class="mi">20</span> <span class="p">:</span>   <span class="p">}</span>
<span class="mi">21</span> <span class="p">:</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>rent.java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="mi">001</span> <span class="o">:</span> <span class="kn">package</span> <span class="n">rent</span><span class="o">;</span>
<span class="mi">002</span> <span class="o">:</span>
<span class="mi">003</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="mi">004</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="mi">005</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.io.FileNotFoundException</span><span class="o">;</span>
<span class="mi">006</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.io.FileReader</span><span class="o">;</span>
<span class="mi">007</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="mi">008</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.math.BigDecimal</span><span class="o">;</span>
<span class="mi">009</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="mi">010</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="mi">011</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="mi">012</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="mi">013</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="mi">014</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="mi">015</span> <span class="o">:</span>
<span class="mi">016</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">org.ho.yaml.Yaml</span><span class="o">;</span>
<span class="mi">017</span> <span class="o">:</span>
<span class="mi">018</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">us.jubat.regression.Datum</span><span class="o">;</span>
<span class="mi">019</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">us.jubat.regression.RegressionClient</span><span class="o">;</span>
<span class="mi">020</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">us.jubat.regression.TupleFloatDatum</span><span class="o">;</span>
<span class="mi">021</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">us.jubat.regression.TupleStringDouble</span><span class="o">;</span>
<span class="mi">022</span> <span class="o">:</span> <span class="kn">import</span> <span class="nn">us.jubat.regression.TupleStringString</span><span class="o">;</span>
<span class="mi">023</span> <span class="o">:</span>
<span class="mi">024</span> <span class="o">:</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">rent</span> <span class="o">{</span>
<span class="mi">025</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">HOST</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="o">;</span>
<span class="mi">026</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">PORT</span> <span class="o">=</span> <span class="mi">9199</span><span class="o">;</span>
<span class="mi">027</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;rent&quot;</span><span class="o">;</span>
<span class="mi">028</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FILE_PATH</span> <span class="o">=</span> <span class="s">&quot;./src/main/resources/&quot;</span><span class="o">;</span>
<span class="mi">029</span> <span class="o">:</span>
<span class="mi">030</span> <span class="o">:</span>  <span class="c1">// Definie the column name in CSV file</span>
<span class="mi">031</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">CSV_COLUMN</span> <span class="o">=</span> <span class="o">{</span>
<span class="mi">032</span> <span class="o">:</span>          <span class="s">&quot;rent&quot;</span><span class="o">,</span>
<span class="mi">033</span> <span class="o">:</span>          <span class="s">&quot;distance&quot;</span><span class="o">,</span>
<span class="mi">034</span> <span class="o">:</span>          <span class="s">&quot;space&quot;</span><span class="o">,</span>
<span class="mi">035</span> <span class="o">:</span>          <span class="s">&quot;age&quot;</span><span class="o">,</span>
<span class="mi">036</span> <span class="o">:</span>          <span class="s">&quot;stair&quot;</span><span class="o">,</span>
<span class="mi">037</span> <span class="o">:</span>          <span class="s">&quot;aspect&quot;</span>
<span class="mi">038</span> <span class="o">:</span>          <span class="o">};</span>
<span class="mi">039</span> <span class="o">:</span>
<span class="mi">040</span> <span class="o">:</span>  <span class="c1">// Item in String type</span>
<span class="mi">041</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">STRING_COLUMN</span> <span class="o">=</span> <span class="o">{</span>
<span class="mi">042</span> <span class="o">:</span>          <span class="s">&quot;aspect&quot;</span>
<span class="mi">043</span> <span class="o">:</span>          <span class="o">};</span>
<span class="mi">044</span> <span class="o">:</span>
<span class="mi">045</span> <span class="o">:</span>  <span class="c1">// Items in Double type</span>
<span class="mi">046</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">DOUBLE_COLUMN</span> <span class="o">=</span> <span class="o">{</span>
<span class="mi">047</span> <span class="o">:</span>          <span class="s">&quot;distance&quot;</span><span class="o">,</span>
<span class="mi">048</span> <span class="o">:</span>          <span class="s">&quot;space&quot;</span><span class="o">,</span>
<span class="mi">049</span> <span class="o">:</span>          <span class="s">&quot;age&quot;</span><span class="o">,</span>
<span class="mi">050</span> <span class="o">:</span>          <span class="s">&quot;stair&quot;</span><span class="o">,</span>
<span class="mi">051</span> <span class="o">:</span>          <span class="o">};</span>
<span class="mi">052</span> <span class="o">:</span>
<span class="mi">053</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kt">void</span> <span class="n">update</span><span class="o">(</span><span class="n">String</span> <span class="n">cvsName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="mi">054</span> <span class="o">:</span>          <span class="c1">// 1. Connect to Jubatus Server</span>
<span class="mi">055</span> <span class="o">:</span>          <span class="n">RegressionClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RegressionClient</span><span class="o">(</span><span class="n">HOST</span><span class="o">,</span> <span class="n">PORT</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
<span class="mi">056</span> <span class="o">:</span>
<span class="mi">057</span> <span class="o">:</span>          <span class="c1">// 2. Prepare the training data</span>
<span class="mi">058</span> <span class="o">:</span>          <span class="n">List</span><span class="o">&lt;</span><span class="n">TupleFloatDatum</span><span class="o">&gt;</span> <span class="n">trainData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">TupleFloatDatum</span><span class="o">&gt;</span> <span class="o">();</span>
<span class="mi">059</span> <span class="o">:</span>          <span class="n">Datum</span> <span class="n">datum</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="mi">060</span> <span class="o">:</span>
<span class="mi">061</span> <span class="o">:</span>           <span class="k">try</span> <span class="o">{</span>
<span class="mi">062</span> <span class="o">:</span>                  <span class="n">File</span> <span class="n">csv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">FILE_PATH</span> <span class="o">+</span> <span class="n">cvsName</span> <span class="o">);</span> <span class="c1">// CSVデータファイル</span>
<span class="mi">063</span> <span class="o">:</span>
<span class="mi">064</span> <span class="o">:</span>                  <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">csv</span><span class="o">));</span>
<span class="mi">065</span> <span class="o">:</span>                  <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">();</span>
<span class="mi">066</span> <span class="o">:</span>                  <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">doubleList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">();</span>
<span class="mi">067</span> <span class="o">:</span>
<span class="mi">068</span> <span class="o">:</span>                  <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
<span class="mi">069</span> <span class="o">:</span>
<span class="mi">070</span> <span class="o">:</span>                  <span class="c1">// read data line by line, until the last one.</span>
<span class="mi">071</span> <span class="o">:</span>                  <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
<span class="mi">072</span> <span class="o">:</span>                          <span class="n">strList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
<span class="mi">073</span> <span class="o">:</span>                          <span class="n">doubleList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
<span class="mi">074</span> <span class="o">:</span>                          <span class="n">TupleFloatDatum</span> <span class="n">train</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TupleFloatDatum</span><span class="o">();</span>
<span class="mi">075</span> <span class="o">:</span>
<span class="mi">076</span> <span class="o">:</span>                          <span class="c1">// split the data in one line into items</span>
<span class="mi">077</span> <span class="o">:</span>                          <span class="n">String</span><span class="o">[]</span> <span class="n">strAry</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">);</span>
<span class="mi">078</span> <span class="o">:</span>
<span class="mi">079</span> <span class="o">:</span>                          <span class="c1">// check the number of CSV columns and the comment</span>
<span class="mi">080</span> <span class="o">:</span>                          <span class="k">if</span><span class="o">(</span> <span class="n">strAry</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="n">CSV_COLUMN</span><span class="o">.</span><span class="na">length</span> <span class="o">||</span> <span class="n">strAry</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">startsWith</span><span class="o">(</span><span class="s">&quot;#&quot;</span><span class="o">)){</span>
<span class="mi">081</span> <span class="o">:</span>                                  <span class="k">continue</span><span class="o">;</span>
<span class="mi">082</span> <span class="o">:</span>                          <span class="o">}</span>
<span class="mi">083</span> <span class="o">:</span>
<span class="mi">084</span> <span class="o">:</span>                          <span class="c1">// make lists for String and Double items</span>
<span class="mi">085</span> <span class="o">:</span>                          <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">strAry</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
<span class="mi">086</span> <span class="o">:</span>                                  <span class="k">if</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">STRING_COLUMN</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">CSV_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">])){</span>
<span class="mi">087</span> <span class="o">:</span>                                          <span class="n">strList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">strAry</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
<span class="mi">088</span> <span class="o">:</span>                                  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">DOUBLE_COLUMN</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">CSV_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">])){</span>
<span class="mi">089</span> <span class="o">:</span>                                          <span class="n">doubleList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">strAry</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
<span class="mi">090</span> <span class="o">:</span>                                  <span class="o">}</span>
<span class="mi">091</span> <span class="o">:</span>                          <span class="o">}</span>
<span class="mi">092</span> <span class="o">:</span>                          <span class="c1">// make datum</span>
<span class="mi">093</span> <span class="o">:</span>                          <span class="n">datum</span> <span class="o">=</span> <span class="n">makeDatum</span><span class="o">(</span><span class="n">strList</span><span class="o">,</span> <span class="n">doubleList</span><span class="o">);</span>
<span class="mi">094</span> <span class="o">:</span>
<span class="mi">095</span> <span class="o">:</span>                          <span class="n">train</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">strAry</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="mi">096</span> <span class="o">:</span>                          <span class="n">train</span><span class="o">.</span><span class="na">second</span> <span class="o">=</span> <span class="n">datum</span><span class="o">;</span>
<span class="mi">097</span> <span class="o">:</span>
<span class="mi">098</span> <span class="o">:</span>                          <span class="n">trainData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">train</span><span class="o">);</span>
<span class="mi">099</span> <span class="o">:</span>                  <span class="o">}</span>
<span class="mi">100</span> <span class="o">:</span>                  <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="mi">101</span> <span class="o">:</span>
<span class="mi">102</span> <span class="o">:</span>                  <span class="c1">// shuffle the training data</span>
<span class="mi">103</span> <span class="o">:</span>                  <span class="n">Collections</span><span class="o">.</span><span class="na">shuffle</span><span class="o">(</span><span class="n">trainData</span><span class="o">);</span>
<span class="mi">104</span> <span class="o">:</span>
<span class="mi">105</span> <span class="o">:</span>                  <span class="c1">// 3. Data training (update model)</span>
<span class="mi">106</span> <span class="o">:</span>                  <span class="kt">int</span> <span class="n">trainCount</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">train</span><span class="o">(</span> <span class="n">NAME</span><span class="o">,</span> <span class="n">trainData</span><span class="o">);</span>
<span class="mi">107</span> <span class="o">:</span>
<span class="mi">108</span> <span class="o">:</span>                  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;train ... &quot;</span> <span class="o">+</span> <span class="n">trainCount</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">);</span>
<span class="mi">109</span> <span class="o">:</span>
<span class="mi">110</span> <span class="o">:</span>           <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="mi">111</span> <span class="o">:</span>                   <span class="c1">// catch the exception in File object creation</span>
<span class="mi">112</span> <span class="o">:</span>                   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="mi">113</span> <span class="o">:</span>           <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="mi">114</span> <span class="o">:</span>                   <span class="c1">// catch the exception when closing BufferedReader object</span>
<span class="mi">115</span> <span class="o">:</span>                   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="mi">116</span> <span class="o">:</span>           <span class="o">}</span>
<span class="mi">117</span> <span class="o">:</span>          <span class="k">return</span><span class="o">;</span>
<span class="mi">118</span> <span class="o">:</span>  <span class="o">}</span>
<span class="mi">119</span> <span class="o">:</span>
<span class="mi">120</span> <span class="o">:</span>  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;unchecked&quot;</span><span class="o">)</span>
<span class="mi">121</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kt">void</span> <span class="n">analyze</span><span class="o">(</span><span class="n">String</span> <span class="n">yamlName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="mi">122</span> <span class="o">:</span>          <span class="n">RegressionClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RegressionClient</span><span class="o">(</span><span class="n">HOST</span><span class="o">,</span> <span class="n">PORT</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
<span class="mi">123</span> <span class="o">:</span>
<span class="mi">124</span> <span class="o">:</span>          <span class="c1">// 4. Prepare the estimation data</span>
<span class="mi">125</span> <span class="o">:</span>          <span class="n">List</span><span class="o">&lt;</span><span class="n">Datum</span><span class="o">&gt;</span> <span class="n">datumList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Datum</span><span class="o">&gt;</span> <span class="o">();</span>
<span class="mi">126</span> <span class="o">:</span>          <span class="c1">// result list</span>
<span class="mi">127</span> <span class="o">:</span>          <span class="n">List</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="o">();</span>
<span class="mi">128</span> <span class="o">:</span>
<span class="mi">129</span> <span class="o">:</span>          <span class="k">try</span> <span class="o">{</span>
<span class="mi">130</span> <span class="o">:</span>                  <span class="c1">// read the configuration from YAML file</span>
<span class="mi">131</span> <span class="o">:</span>                  <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">hash</span> <span class="o">=</span> <span class="o">(</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;)</span> <span class="n">Yaml</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">FILE_PATH</span> <span class="o">+</span> <span class="n">yamlName</span> <span class="o">));</span>
<span class="mi">132</span> <span class="o">:</span>
<span class="mi">133</span> <span class="o">:</span>                  <span class="c1">// make the estimation data</span>
<span class="mi">134</span> <span class="o">:</span>                  <span class="n">datumList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">makeDatum</span><span class="o">(</span><span class="n">hash</span><span class="o">));</span>
<span class="mi">135</span> <span class="o">:</span>
<span class="mi">136</span> <span class="o">:</span>                  <span class="c1">// 5. Predict by the model learned</span>
<span class="mi">137</span> <span class="o">:</span>                  <span class="n">result</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">estimate</span><span class="o">(</span> <span class="n">NAME</span><span class="o">,</span> <span class="n">datumList</span><span class="o">));</span>
<span class="mi">138</span> <span class="o">:</span>
<span class="mi">139</span> <span class="o">:</span>                  <span class="c1">// change the result into BigDecimal type</span>
<span class="mi">140</span> <span class="o">:</span>                  <span class="n">BigDecimal</span> <span class="n">bd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
<span class="mi">141</span> <span class="o">:</span>                  <span class="c1">// rounding at the 2nd decimal</span>
<span class="mi">142</span> <span class="o">:</span>                  <span class="n">BigDecimal</span> <span class="n">bd2</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="na">setScale</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">ROUND_HALF_UP</span><span class="o">);</span>
<span class="mi">143</span> <span class="o">:</span>
<span class="mi">144</span> <span class="o">:</span>                  <span class="c1">// 6. Output result</span>
<span class="mi">145</span> <span class="o">:</span>                  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;rent .... &quot;</span> <span class="o">+</span> <span class="n">bd2</span> <span class="o">);</span>
<span class="mi">146</span> <span class="o">:</span>
<span class="mi">147</span> <span class="o">:</span>          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="mi">148</span> <span class="o">:</span>                   <span class="c1">// capture the exception in File object creation.</span>
<span class="mi">149</span> <span class="o">:</span>                   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="mi">150</span> <span class="o">:</span>          <span class="o">}</span>
<span class="mi">151</span> <span class="o">:</span>
<span class="mi">152</span> <span class="o">:</span>          <span class="k">return</span><span class="o">;</span>
<span class="mi">153</span> <span class="o">:</span>  <span class="o">}</span>
<span class="mi">154</span> <span class="o">:</span>
<span class="mi">155</span> <span class="o">:</span>  <span class="c1">// Create the lists with the name given in the Datum (for list)</span>
<span class="mi">156</span> <span class="o">:</span>  <span class="kd">private</span> <span class="n">Datum</span> <span class="n">makeDatum</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strList</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">doubleList</span><span class="o">)</span> <span class="o">{</span>
<span class="mi">157</span> <span class="o">:</span>
<span class="mi">158</span> <span class="o">:</span>          <span class="n">Datum</span> <span class="n">datum</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Datum</span><span class="o">();</span>
<span class="mi">159</span> <span class="o">:</span>          <span class="n">datum</span><span class="o">.</span><span class="na">string_values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">TupleStringString</span><span class="o">&gt;();</span>
<span class="mi">160</span> <span class="o">:</span>          <span class="n">datum</span><span class="o">.</span><span class="na">num_values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">TupleStringDouble</span><span class="o">&gt;();</span>
<span class="mi">161</span> <span class="o">:</span>
<span class="mi">162</span> <span class="o">:</span>          <span class="k">for</span><span class="o">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">strList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
<span class="mi">163</span> <span class="o">:</span>                  <span class="n">TupleStringString</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TupleStringString</span><span class="o">();</span>
<span class="mi">164</span> <span class="o">:</span>                  <span class="n">data</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">STRING_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
<span class="mi">165</span> <span class="o">:</span>                  <span class="n">data</span><span class="o">.</span><span class="na">second</span> <span class="o">=</span> <span class="n">strList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
<span class="mi">166</span> <span class="o">:</span>
<span class="mi">167</span> <span class="o">:</span>                  <span class="n">datum</span><span class="o">.</span><span class="na">string_values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="mi">168</span> <span class="o">:</span>          <span class="o">}</span>
<span class="mi">169</span> <span class="o">:</span>
<span class="mi">170</span> <span class="o">:</span>          <span class="k">try</span> <span class="o">{</span>
<span class="mi">171</span> <span class="o">:</span>                  <span class="k">for</span><span class="o">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">doubleList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
<span class="mi">172</span> <span class="o">:</span>                          <span class="n">TupleStringDouble</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TupleStringDouble</span><span class="o">();</span>
<span class="mi">173</span> <span class="o">:</span>                          <span class="n">data</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">DOUBLE_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
<span class="mi">174</span> <span class="o">:</span>                          <span class="n">data</span><span class="o">.</span><span class="na">second</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">doubleList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
<span class="mi">175</span> <span class="o">:</span>
<span class="mi">176</span> <span class="o">:</span>                          <span class="n">datum</span><span class="o">.</span><span class="na">num_values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="mi">177</span> <span class="o">:</span>                  <span class="o">}</span>
<span class="mi">178</span> <span class="o">:</span>          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">){</span>
<span class="mi">179</span> <span class="o">:</span>                  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="mi">180</span> <span class="o">:</span>                  <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="mi">181</span> <span class="o">:</span>          <span class="o">}</span>
<span class="mi">182</span> <span class="o">:</span>
<span class="mi">183</span> <span class="o">:</span>          <span class="k">return</span> <span class="n">datum</span><span class="o">;</span>
<span class="mi">184</span> <span class="o">:</span>  <span class="o">}</span>
<span class="mi">185</span> <span class="o">:</span>
<span class="mi">186</span> <span class="o">:</span>  <span class="c1">// Create the lists with the name given in the Datum (for Map)</span>
<span class="mi">187</span> <span class="o">:</span>  <span class="kd">private</span> <span class="n">Datum</span> <span class="n">makeDatum</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">hash</span><span class="o">)</span> <span class="o">{</span>
<span class="mi">188</span> <span class="o">:</span>
<span class="mi">189</span> <span class="o">:</span>          <span class="n">Datum</span> <span class="n">datum</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Datum</span><span class="o">();</span>
<span class="mi">190</span> <span class="o">:</span>          <span class="n">datum</span><span class="o">.</span><span class="na">string_values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">TupleStringString</span><span class="o">&gt;();</span>
<span class="mi">191</span> <span class="o">:</span>          <span class="n">datum</span><span class="o">.</span><span class="na">num_values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">TupleStringDouble</span><span class="o">&gt;();</span>
<span class="mi">192</span> <span class="o">:</span>
<span class="mi">193</span> <span class="o">:</span>          <span class="k">for</span><span class="o">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">STRING_COLUMN</span><span class="o">.</span><span class="na">length</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
<span class="mi">194</span> <span class="o">:</span>                  <span class="c1">// Insert into Datum only if it is contained by HashMap and not NULL</span>
<span class="mi">195</span> <span class="o">:</span>                  <span class="k">if</span><span class="o">(</span> <span class="n">hash</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">STRING_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">&amp;&amp;</span> <span class="n">hash</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">STRING_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
<span class="mi">196</span> <span class="o">:</span>                          <span class="n">TupleStringString</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TupleStringString</span><span class="o">();</span>
<span class="mi">197</span> <span class="o">:</span>
<span class="mi">198</span> <span class="o">:</span>                          <span class="n">data</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">STRING_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
<span class="mi">199</span> <span class="o">:</span>                          <span class="n">data</span><span class="o">.</span><span class="na">second</span> <span class="o">=</span> <span class="n">hash</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">STRING_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">]).</span><span class="na">toString</span><span class="o">();</span>
<span class="mi">200</span> <span class="o">:</span>
<span class="mi">201</span> <span class="o">:</span>                          <span class="n">datum</span><span class="o">.</span><span class="na">string_values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="mi">202</span> <span class="o">:</span>                  <span class="o">}</span>
<span class="mi">203</span> <span class="o">:</span>          <span class="o">}</span>
<span class="mi">204</span> <span class="o">:</span>
<span class="mi">205</span> <span class="o">:</span>          <span class="k">try</span> <span class="o">{</span>
<span class="mi">206</span> <span class="o">:</span>                  <span class="k">for</span><span class="o">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DOUBLE_COLUMN</span><span class="o">.</span><span class="na">length</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
<span class="mi">207</span> <span class="o">:</span>                          <span class="c1">// Insert into Datum only if it is contained by HashMap and not NULL</span>
<span class="mi">208</span> <span class="o">:</span>                          <span class="k">if</span><span class="o">(</span> <span class="n">hash</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">DOUBLE_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">&amp;&amp;</span> <span class="n">hash</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">DOUBLE_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
<span class="mi">209</span> <span class="o">:</span>                                  <span class="n">TupleStringDouble</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TupleStringDouble</span><span class="o">();</span>
<span class="mi">210</span> <span class="o">:</span>
<span class="mi">211</span> <span class="o">:</span>                                  <span class="n">data</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">DOUBLE_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
<span class="mi">212</span> <span class="o">:</span>                                  <span class="n">data</span><span class="o">.</span><span class="na">second</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">hash</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">DOUBLE_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">]).</span><span class="na">toString</span><span class="o">());</span>
<span class="mi">213</span> <span class="o">:</span>
<span class="mi">214</span> <span class="o">:</span>                                  <span class="n">datum</span><span class="o">.</span><span class="na">num_values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="mi">215</span> <span class="o">:</span>                          <span class="o">}</span>
<span class="mi">216</span> <span class="o">:</span>                  <span class="o">}</span>
<span class="mi">217</span> <span class="o">:</span>          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">){</span>
<span class="mi">218</span> <span class="o">:</span>                  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="mi">219</span> <span class="o">:</span>                  <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="mi">220</span> <span class="o">:</span>          <span class="o">}</span>
<span class="mi">221</span> <span class="o">:</span>
<span class="mi">222</span> <span class="o">:</span>          <span class="k">return</span> <span class="n">datum</span><span class="o">;</span>
<span class="mi">223</span> <span class="o">:</span>  <span class="o">}</span>
<span class="mi">224</span> <span class="o">:</span>
<span class="mi">225</span> <span class="o">:</span>  <span class="c1">// Main methods</span>
<span class="mi">226</span> <span class="o">:</span>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="mi">227</span> <span class="o">:</span>
<span class="mi">228</span> <span class="o">:</span>          <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">){</span>
<span class="mi">229</span> <span class="o">:</span>                  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;Please set the arguments.\n&quot;</span> <span class="o">+</span>
<span class="mi">230</span> <span class="o">:</span>                                                  <span class="s">&quot;1st argument： YML file name (required)\n&quot;</span> <span class="o">+</span>
<span class="mi">231</span> <span class="o">:</span>                                                  <span class="s">&quot;2nd argument： CSV file name (when there is training data)\n&quot;</span><span class="o">);</span>
<span class="mi">232</span> <span class="o">:</span>                  <span class="k">return</span><span class="o">;</span>
<span class="mi">233</span> <span class="o">:</span>          <span class="o">}</span>
<span class="mi">234</span> <span class="o">:</span>
<span class="mi">235</span> <span class="o">:</span>          <span class="c1">// when there is the 2nd argument, start the update method for model training.</span>
<span class="mi">236</span> <span class="o">:</span>          <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">])){</span>
<span class="mi">237</span> <span class="o">:</span>                  <span class="k">new</span> <span class="n">rent</span><span class="o">().</span><span class="na">update</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
<span class="mi">238</span> <span class="o">:</span>          <span class="o">}</span>
<span class="mi">239</span> <span class="o">:</span>          <span class="k">if</span><span class="o">(!</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">])){</span>
<span class="mi">240</span> <span class="o">:</span>                  <span class="k">new</span> <span class="n">rent</span><span class="o">().</span><span class="na">analyze</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="mi">241</span> <span class="o">:</span>          <span class="o">}</span>
<span class="mi">242</span> <span class="o">:</span>
<span class="mi">243</span> <span class="o">:</span>          <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="mi">244</span> <span class="o">:</span>  <span class="o">}</span>
<span class="mi">245</span> <span class="o">:</span> <span class="o">}</span>
</pre></div>
</div>
<p><strong>myhome.yml</strong></p>
<div class="highlight-python"><pre>01 :  #
02 :  # distance : distance from station (walking time in minutes)
03 :  # space    : the footprint of the house (m*m)
04 :  # age      : build age (year)
05 :  # stair    : floors
06 :  # aspect   : direction [ N / NE / E / SE / S / SW / W / NW ]
07 :  #
08 :  distance : 8
09 :  space    : 32.00
10 :  age      : 15
11 :  stair    : 5
12 :  aspect   : "S"</pre>
</div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p><strong>rent.json</strong></p>
<p>The configuration information is given by the JSON unit. Here is the meaning of each JSON filed.</p>
<ul class="simple">
<li>method</li>
</ul>
<blockquote>
<div>Specify the algorithm used in regression.
Currently, we have &#8220;PA&#8221; (Passive Aggressive) only, so we specify it with &#8220;PA&#8221;.</div></blockquote>
<ul class="simple">
<li>converter</li>
</ul>
<blockquote>
<div><p>Specify the configurations in feature converter.
In this example, we will set the &#8220;num_rules&#8221; and &#8220;string_rules&#8221;.</p>
<p>&#8220;num_rules&#8221; are used to specify the extraction rules of numercial features.
&#8220;key&#8221; is &#8220;*&#8221;, it means all the &#8220;key&#8221; are taken into consideration, &#8220;type&#8221; is &#8220;num&#8221;, it means the number(value) specified will be directly used as the input for training the model.
For example, if the &#8220;age = 2&#8221;, use 2 as the input; if the &#8220;stair = 6&#8221;, use 6 as the input.</p>
<p>&#8220;string_rules&#8221; are used to specify the extraction rules of string features.
Here, &#8220;key = aspect&#8221;, &#8220;type = str&#8221;, &#8220;sample_weight = bin&#8221;, and &#8220;global_weight = bin&#8221;.
Their meaning are: the &#8220;aspect&#8221; is treated as a string, and used as the input feature without reform; the weight of each key-value feature is specified to be &#8220;1&#8221;; and the global weight of each feature is specified to be &#8220;1&#8221;.</p>
</div></blockquote>
<ul class="simple">
<li>parameter</li>
</ul>
<blockquote>
<div><p>Specify the parameters to be passed to the algorithm.
The method specified here is &#8220;PA&#8221;, with its configuration as &#8220;&#8221;sensitivity&#8221; and &#8220;regularization_weight&#8221;.</p>
<p>&#8220;sensitivity&#8221; specifies the tolerable range of error. When its value increases, it becomes resistant to noise, but makes errors remain easily instead.
&#8220;regularization_weight&#8221; specifies the sensitivity parameter in the learning. When its value increases, the learning becomes faster, but the method become susceptible to the noise.</p>
<p>In addition, the &#8220;regularization_weight&#8221; above plays various roles in different algorithms, so please be careful in configuring its values in different algorithms.</p>
</div></blockquote>
<p><strong>rent.java</strong></p>
<p>We explain the learning and prediction processes in this example.</p>
<blockquote>
<div><p>To write the Client program for Regression, we can use the RegressionClient class defined in &#8216;us.jubat.regression&#8217;. There are two methods used in this program. The &#8216;train&#8217; method for learning process, and the &#8216;estimate&#8217; method for prediction with the data learnt.</p>
<ol class="arabic simple">
<li>Connect to Jubatus Server</li>
</ol>
<blockquote>
<div>Connect to Jubatus Server (Row 55)
Setting the IP addr., RPC port of Jubatus Server, and the connection waiting time.</div></blockquote>
<ol class="arabic simple" start="2">
<li>Prepare the training data</li>
</ol>
<blockquote>
<div><p>RegressionClient puts the training data into a TupleFloatDatum List, and sends the data to train() methods for the model training.
In this example, the training data is generated from the CSV file that privided by a housing rental website.
Factors in the rental information includes rent, aspect, distance, space, age and stairs.
Figure below shows the training data. (The following are four examples from over one hundred housing info. listed in the rent-data.csv)</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="18%" />
<col width="20%" />
<col width="23%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="5">TupleFloatDatum</th>
</tr>
<tr class="row-even"><th class="head" rowspan="3">label(Float)</th>
<th class="head" colspan="4">Datum</th>
</tr>
<tr class="row-odd"><th class="head" colspan="2">TupleStringString(List)</th>
<th class="head" colspan="2">TupleStringDoubel(List)</th>
</tr>
<tr class="row-even"><th class="head">key(String)</th>
<th class="head">value(String)</th>
<th class="head">key(String)</th>
<th class="head">value(double)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>5.0</td>
<td>&#8220;aspect&#8221;</td>
<td>&#8220;SW&#8221;</td>
<td><div class="first last line-block">
<div class="line">&#8220;distance&#8221;</div>
<div class="line">&#8220;space&#8221;</div>
<div class="line">&#8220;age&#8221;</div>
<div class="line">&#8220;stair&#8221;</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10</div>
<div class="line">20.04</div>
<div class="line">12</div>
<div class="line">1</div>
</div>
</td>
</tr>
<tr class="row-even"><td>6.3</td>
<td>&#8220;aspect&#8221;</td>
<td>&#8220;N&#8221;</td>
<td><div class="first last line-block">
<div class="line">&#8220;distance&#8221;</div>
<div class="line">&#8220;space&#8221;</div>
<div class="line">&#8220;age&#8221;</div>
<div class="line">&#8220;stair&#8221;</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">8</div>
<div class="line">21.56</div>
<div class="line">23</div>
<div class="line">2</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>7.5</td>
<td>&#8220;aspect&#8221;</td>
<td>&#8220;SE&#8221;</td>
<td><div class="first last line-block">
<div class="line">&#8220;distance&#8221;</div>
<div class="line">&#8220;space&#8221;</div>
<div class="line">&#8220;age&#8221;</div>
<div class="line">&#8220;stair&#8221;</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">25</div>
<div class="line">22.82</div>
<div class="line">23</div>
<div class="line">4</div>
</div>
</td>
</tr>
<tr class="row-even"><td>9.23</td>
<td>&#8220;aspect&#8221;</td>
<td>&#8220;S&#8221;</td>
<td><div class="first last line-block">
<div class="line">&#8220;distance&#8221;</div>
<div class="line">&#8220;space&#8221;</div>
<div class="line">&#8220;age&#8221;</div>
<div class="line">&#8220;stair&#8221;</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10</div>
<div class="line">30.03</div>
<div class="line">0</div>
<div class="line">2</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>TupleFloatDatum contains 2 fields, &#8220;Datum&#8221; and the &#8220;label&#8221;.
&#8220;Datum&#8221; is composed of key-value data which could be processed by Jubatus, and there are 2 types of key-value data format.
In the first type, both the &#8220;key&#8221; and &#8220;value&#8221; are in string format (string_values); in the second one, the &#8220;key&#8221; is in string format, but the &#8220;value&#8221; is in numerical format (num_values).
These two types are represented in TupleStringString class and TupleStringDouble class, respectively.</p>
<div class="line-block">
<div class="line">Please have a view of the first example data in this table. Because the &#8220;aspect&#8221; is in string format, it is stored in the first list of the TupleStringString class</div>
<div class="line">in which, the key is set as &#8220;aspect&#8221;, value is set as &#8220;SW&#8221;.</div>
<div class="line">Because other items are numerical, they are stored in the list of the TupleStringDouble class, in which</div>
<div class="line">the first list&#8217;s key is set as &#8220;distance&#8221; and value is set as &#8220;10&#8221;,</div>
<div class="line">the second list&#8217;s key is set as &#8220;space&#8221; and value is set as &#8220;20.04&#8221;,</div>
<div class="line">the third list&#8217;s key is set as &#8220;age&#8221; and value is set as &#8220;15&#8221;,</div>
<div class="line">the fourth list&#8217;s key is set as &#8220;stair&#8221; and value is set as &#8220;1&#8221;.</div>
</div>
<p>The Datum of these 5 Lists is appended with a label of &#8220;5.0&#8221;, as its rent, and forms an instance of TupleFloatDatum class which retains the rent (of 5.0 * 10,000) and its corresponding housing condition info.
Thus, the housing rental data are generated in the format of (TupleFloatDatum) List, as the training data to be used.</p>
<p>Here is the detailed process for making the training data in this sample.</p>
<p>First, declare the variable of training data &#8220;trainDat&#8221;, as a TupleFloatDatum List (Row 58).
Next, read the source file (CSV file) of the training data.
Here, FileReader() and BuffererdReader() is used to read the items in CVS file line by line (Row 71-100).
Split the data read from each line in CSV file, by the &#8216;,&#8217; mark (Row 77).
Using the defined CSV item list (CSV_COLUMN),String item list (STRING_COLUMN) and Double item list (Double_COLUMN) to transfer the CSV data into strList or doubleList, if the item is in String or Double type (Row 85-91).
Then, create the &#8220;Datum&#8221; by using the 2 lists, as the arguments in the private method of [makeDatum] (Row 93).</p>
<p>The string item list and double item list in the arguments of [makeDatum] method are used to generate the TupleStringString list and TupleStringDouble list, respecitively (Row 156-184).
At first, create the instance of Datum class component: &#8220;string_values&#8221; list and &#8220;num_values&#8221; list (Row 158-160).
Next, generate the TupleStringString by reading the items from strList. The first element is the column name (as the key), and the second element is the value. The data is added into the string_values list (Row 162-168).
The Double type items are processed in the similar way as String type items, to generate TupleStringDouble. Please note that the elements of num_values are added with type conversion, because the argument is of String type List while the num_values in Datum is of Double type (Row 174).
Now, the Datum is created.</p>
<p>The Datum created in [makeDatum] above is appended with the rent label, so as to be used as one piece of training data (argument &#8216;train&#8217; in Row 95-96).
By looping the above processes, source data in the CSV file will be transferred into the training data line by line and stored in the trainData List (Row 103).</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Model Training (update learning model</li>
</ol>
<blockquote>
<div>Input the training data generated in step.2 into the train() method (Row 106).
The first parameter in train() is the unique name for task identification in Zookeeper.
(use null charactor &#8220;&#8221; for the stand-alone mode)
The second parameter specifies the Datum generated in step.2.
The returned result is the number of training data have been processed.</div></blockquote>
<ol class="arabic simple" start="4">
<li>Prepare the prediction data</li>
</ol>
<blockquote>
<div><p>Prepare the prediction data in the similar way of training Datum creation.
Here, we generate the data for prediction by using the YAML file (please download the library <a class="reference external" href="http://jyaml.sourceforge.net/download.html">JYaml</a> )
YAML is one kind of data format, in which objects and structure data are serialized.</p>
<p>Read the YAML file (myhome.yml) as a HashMap (Row 131).
Generate the prediction Datum by using the [makeDatum] method, as simliar as Step 2, with the HashMap.</p>
<p>However, since the argument used here is HashMap, although the output is the same, the generation process is different (Row 187-223).
In addition, there is no need to fill all the items in one Datum. The only required conditions are created in the Datum.</p>
<p>Add the Datum into the prediction data list, and send it into the estimate() method in &#8220;RegressionClient&#8221; for prediction.</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Prediction by the regression model</li>
</ol>
<blockquote>
<div>The prediction results are returned as a list by the estimate() method (Row 137).</div></blockquote>
<ol class="arabic simple" start="6">
<li>Output the result</li>
</ol>
<blockquote>
<div>The prediction results are returned in the same order of the prediction data. (In this sample, only one prediction data is used, thus only one result is returned.)
The result is rounded at 2nd decimal for output, because it is in Float type.</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="run-the-sample-program">
<h2>Run the sample program<a class="headerlink" href="#run-the-sample-program" title="Permalink to this headline">¶</a></h2>
<p><strong>[At Jubatus Server]</strong></p>
<blockquote>
<div><p>start &#8220;jubaregression&#8221; process.</p>
<div class="highlight-python"><pre>$ jubaregression --configpath rent.json</pre>
</div>
</div></blockquote>
<p><strong>[At Jubatus Client]</strong></p>
<blockquote>
<div>Get the required package and Java client ready.
| Specify the arguments and Run! (The 2nd arguments is optional.)
|  The first argument: YML file name (required)
|  The second argument: CSV file name (if there is training data)</div></blockquote>
<p><strong>[Result]</strong></p>
<blockquote>
<div><div class="highlight-python"><pre>train ... 145
rent .... 9.9</pre>
</div>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="graph.html" title="Graph"
             >next</a> |</li>
        <li class="right" >
          <a href="regression_ruby.html" title="Ruby"
             >previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="../tutorial.html" >Tutorial</a> &raquo;</li>
          <li><a href="regression.html" >Regression</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011,2013 PFI &amp; NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>