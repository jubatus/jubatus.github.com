

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ruby &mdash; Jubatus</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="Jubatus" href="../index.html"/>
        <link rel="up" title="Anomaly" href="anomaly.html"/>
        <link rel="next" title="Java" href="anomaly_java.html"/>
        <link rel="prev" title="Python" href="anomaly_python.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Jubatus
          

          
            
            <img src="../_static/title.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Basic Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="classifier.html">Classifier</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="anomaly.html">Anomaly</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="anomaly.html#abstract-of-sample-program">Abstract of sample program</a></li>
<li class="toctree-l3"><a class="reference internal" href="anomaly.html#processing-flow">Processing flow</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="anomaly.html#sample-program">Sample Program</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="anomaly_python.html">Python</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Ruby</a></li>
<li class="toctree-l4"><a class="reference internal" href="anomaly_java.html">Java</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="regression.html">Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph.html">Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="stat.html">Stat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_distributed.html">Distributed Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fv_convert.html">Data Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../method.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/index.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_faqs/index.html">Tips and FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jubakit/index.html">Jubakit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jubaql/index.html">JubaQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About This Project</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Jubatus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Tutorial</a> &raquo;</li>
      
          <li><a href="anomaly.html">Anomaly</a> &raquo;</li>
      
    <li>Ruby</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ruby">
<h1>Ruby<a class="headerlink" href="#ruby" title="Permalink to this headline">¶</a></h1>
<p>Here we explain the Ruby sample program of anomaly detection.</p>
<div class="section" id="source-code">
<h2>Source_code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>In this sample program, we will explain 1) how to configure the learning-algorithms in Jubatus with the config file &#8216;config.json&#8217;; 2) how to detect the anomaly data with the example file ‘anomaly.rb’. Here are the source codes of &#8216;config.json&#8217; and &#8216;anomaly.rb&#8217;.</p>
<p><strong>config.json</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;method&quot;</span> <span class="p">:</span> <span class="s2">&quot;lof&quot;</span><span class="p">,</span>
 <span class="s2">&quot;parameter&quot;</span> <span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;nearest_neighbor_num&quot;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s2">&quot;reverse_nearest_neighbor_num&quot;</span> <span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="s2">&quot;method&quot;</span> <span class="p">:</span> <span class="s2">&quot;euclid_lsh&quot;</span><span class="p">,</span>
  <span class="s2">&quot;parameter&quot;</span> <span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;hash_num&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
   <span class="s2">&quot;table_num&quot;</span> <span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
   <span class="s2">&quot;probe_num&quot;</span> <span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
   <span class="s2">&quot;bin_width&quot;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
   <span class="s2">&quot;seed&quot;</span> <span class="p">:</span> <span class="mi">1234</span>
  <span class="p">}</span>
 <span class="p">},</span>

 <span class="s2">&quot;converter&quot;</span> <span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span> <span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span> <span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;key&quot;</span> <span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;num&quot;</span><span class="p">}]</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><strong>anomaly.rb</strong></p>
<div class="highlight-ruby"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1">#!/usr/bin/env ruby</span>
 <span class="c1"># -*- coding: utf-8 -*-</span>

 <span class="vg">$host</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
 <span class="vg">$port</span> <span class="o">=</span> <span class="mi">9199</span>
 <span class="vg">$name</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>

 <span class="nb">require</span> <span class="s1">&#39;json&#39;</span>

 <span class="nb">require</span> <span class="s1">&#39;jubatus/anomaly/client&#39;</span>

 <span class="c1"># 0. set keyboard interruption handler&quot;</span>
 <span class="no">Signal</span><span class="o">.</span><span class="n">trap</span><span class="p">(</span><span class="ss">:INT</span><span class="p">)</span> <span class="p">{</span>
     <span class="nb">print</span> <span class="s2">&quot;You pressed Ctrl+C.&quot;</span>
     <span class="nb">print</span> <span class="s2">&quot;Stop running the job.&quot;</span>
     <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
 <span class="p">}</span>

 <span class="c1"># 1. Configuration to connect Jubatus Server</span>
 <span class="n">client</span> <span class="o">=</span> <span class="no">Jubatus</span><span class="o">::</span><span class="no">Anomaly</span><span class="o">::</span><span class="no">Client</span><span class="o">::</span><span class="no">Anomaly</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vg">$host</span><span class="p">,</span> <span class="vg">$port</span><span class="p">,</span> <span class="vg">$name</span><span class="p">)</span>

 <span class="c1"># 2. prepare training dataset</span>
 <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../kddcup.data_10_percent.txt&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
   <span class="n">f</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
     <span class="n">duration</span><span class="p">,</span> <span class="n">protocol_type</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">src_bytes</span><span class="p">,</span> <span class="n">dst_bytes</span><span class="p">,</span> <span class="n">land</span><span class="p">,</span> <span class="n">wrong_fragment</span><span class="p">,</span> <span class="n">urgent</span><span class="p">,</span> <span class="n">hot</span><span class="p">,</span> <span class="n">num_failed_logins</span><span class="p">,</span> <span class="n">logged_in</span><span class="p">,</span> <span class="n">num_compromised</span><span class="p">,</span> <span class="n">root_shell</span><span class="p">,</span> <span class="n">su_attempted</span><span class="p">,</span> <span class="n">num_root</span><span class="p">,</span> <span class="n">num_file_creations</span><span class="p">,</span> <span class="n">num_shells</span><span class="p">,</span> <span class="n">num_access_files</span><span class="p">,</span> <span class="n">num_outbound_cmds</span><span class="p">,</span> <span class="n">is_host_login</span><span class="p">,</span> <span class="n">is_guest_login</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">srv_count</span><span class="p">,</span> <span class="n">serror_rate</span><span class="p">,</span> <span class="n">srv_serror_rate</span><span class="p">,</span> <span class="n">rerror_rate</span><span class="p">,</span> <span class="n">srv_rerror_rate</span><span class="p">,</span> <span class="n">same_srv_rate</span><span class="p">,</span> <span class="n">diff_srv_rate</span><span class="p">,</span> <span class="n">srv_diff_host_rate</span><span class="p">,</span> <span class="n">dst_host_count</span><span class="p">,</span> <span class="n">dst_host_srv_count</span><span class="p">,</span> <span class="n">dst_host_same_srv_rate</span><span class="p">,</span> <span class="n">dst_host_diff_srv_rate</span><span class="p">,</span> <span class="n">dst_host_same_src_port_rate</span><span class="p">,</span> <span class="n">dst_host_srv_diff_host_rate</span><span class="p">,</span> <span class="n">dst_host_serror_rate</span><span class="p">,</span> <span class="n">dst_host_srv_serror_rate</span><span class="p">,</span> <span class="n">dst_host_rerror_rate</span><span class="p">,</span> <span class="n">dst_host_srv_rerror_rate</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
           <span class="n">data</span> <span class="o">=</span> <span class="no">Jubatus</span><span class="o">::</span><span class="no">Common</span><span class="o">::</span><span class="no">Datum</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
       <span class="s2">&quot;protocol_type&quot;</span> <span class="o">=&gt;</span> <span class="n">protocol_type</span><span class="p">,</span>
       <span class="s2">&quot;service&quot;</span> <span class="o">=&gt;</span> <span class="n">service</span><span class="p">,</span>
       <span class="s2">&quot;flag&quot;</span> <span class="o">=&gt;</span> <span class="n">flag</span><span class="p">,</span>
       <span class="s2">&quot;land&quot;</span> <span class="o">=&gt;</span> <span class="n">land</span><span class="p">,</span>
       <span class="s2">&quot;logged_in&quot;</span> <span class="o">=&gt;</span> <span class="n">logged_in</span><span class="p">,</span>
       <span class="s2">&quot;is_host_login&quot;</span> <span class="o">=&gt;</span> <span class="n">is_host_login</span><span class="p">,</span>
       <span class="s2">&quot;is_guest_login&quot;</span> <span class="o">=&gt;</span> <span class="n">is_guest_login</span><span class="p">,</span>
           <span class="s2">&quot;duration&quot;</span> <span class="o">=&gt;</span> <span class="n">duration</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;src_bytes&quot;</span> <span class="o">=&gt;</span> <span class="n">src_bytes</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_bytes&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_bytes</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;wrong_fragment&quot;</span> <span class="o">=&gt;</span> <span class="n">wrong_fragment</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;urgent&quot;</span> <span class="o">=&gt;</span> <span class="n">urgent</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;hot&quot;</span> <span class="o">=&gt;</span> <span class="n">hot</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;num_failed_logins&quot;</span> <span class="o">=&gt;</span> <span class="n">num_failed_logins</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;num_compromised&quot;</span> <span class="o">=&gt;</span> <span class="n">num_compromised</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;root_shell&quot;</span> <span class="o">=&gt;</span> <span class="n">root_shell</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;su_attempted&quot;</span> <span class="o">=&gt;</span> <span class="n">su_attempted</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;num_root&quot;</span> <span class="o">=&gt;</span> <span class="n">num_root</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;num_file_creations&quot;</span> <span class="o">=&gt;</span> <span class="n">num_file_creations</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;num_shells&quot;</span> <span class="o">=&gt;</span> <span class="n">num_shells</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;num_access_files&quot;</span> <span class="o">=&gt;</span> <span class="n">num_access_files</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;num_outbound_cmds&quot;</span> <span class="o">=&gt;</span> <span class="n">num_outbound_cmds</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;count&quot;</span> <span class="o">=&gt;</span> <span class="n">count</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;srv_count&quot;</span> <span class="o">=&gt;</span> <span class="n">srv_count</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;serror_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">serror_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;srv_serror_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">srv_serror_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;rerror_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">rerror_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;srv_rerror_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">srv_rerror_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;same_srv_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">same_srv_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;diff_srv_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">diff_srv_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;srv_diff_host_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">srv_diff_host_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_count&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_count</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_srv_count&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_srv_count</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_same_srv_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_same_srv_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_same_src_port_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_same_src_port_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_diff_srv_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_diff_srv_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_srv_diff_host_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_srv_diff_host_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_serror_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_serror_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_srv_serror_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_srv_serror_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_rerror_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_rerror_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">,</span>
       <span class="s2">&quot;dst_host_srv_rerror_rate&quot;</span> <span class="o">=&gt;</span> <span class="n">dst_host_srv_rerror_rate</span><span class="o">.</span><span class="n">to_f</span><span class="p">)</span>
     <span class="c1"># 3. training</span>
           <span class="n">ret</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


     <span class="c1"># 4. output results</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">score</span> <span class="o">!=</span> <span class="nb">Float</span><span class="o">::</span><span class="no">INFINITY</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">score</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
               <span class="nb">print</span> <span class="n">ret</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">label</span>
           <span class="k">end</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p><strong>config.json</strong></p>
<p>The configuration information is given by the JSON unit. Here is the meaning of each JSON field.</p>
<blockquote>
<div><ul class="simple">
<li>method</li>
</ul>
<blockquote>
<div>Specify the algorithm used in anomaly detection. Currently, Recommender based &#8220;lof&#8221;(Local Outlier Factor) and Nearest Neighbor based &#8220;light_lof&#8221; are supported for anomaly detection. Here, we use &#8220;lof&#8221;.</div></blockquote>
<ul class="simple">
<li>parameter</li>
</ul>
<blockquote>
<div>Specify the parameters for anomaly detection algorithm set as method.
Here, we use &#8220;lof&#8221; algorithm and set the parameters according to <a class="reference external" href="http://jubat.us/ja/api_recommender.html">Recommender API</a> .</div></blockquote>
<ul class="simple">
<li>converter</li>
</ul>
<blockquote>
<div><p>Specify the configurations in feature converter. In this sample, we will set &#8220;num_rules&#8221; and &#8220;string_rules&#8221;.</p>
<p>&#8220;num_rules&#8221; specifies the value extracting rules for values in numerical format.
&#8220;key&#8221; is set as &#8220;*&#8221; here, which means all the &#8220;key&#8221; will be taken into account. &#8220;type&#8221; is set as &#8220;num&#8221;, which means each value has its weight as equal as the value itself. For example, if data&#8217;s value i &#8220;2&#8221;, its weight is set as 2; if data&#8217;s value is &#8220;6&#8221;, its weight is set as 6.</p>
<p>&#8220;string_rules&#8221; specifies the value extracting rules for values in string format.
Here, &#8220;key&#8221; is set as &#8220;*&#8221;, &#8220;type&#8221; is &#8220;str&#8221;, &#8220;sample_weight&#8221; is &#8220;bin&#8221;, and &#8220;global_weight&#8221; is &#8220;bin&#8221;.
This means, all the &#8220;key&#8221; will be taken into account, the features in strings values will be used without convertion, the weight of each key-value will be calculated throughout the whole data have been used, and the global weight is a constant value of &#8220;1&#8221;.</p>
</div></blockquote>
</div></blockquote>
<p><strong>anomaly.rb</strong></p>
<blockquote>
<div><p>anomaly.rb will extract the data from text file, send them to Jubatus server, and get their anomaly detection result from the server.</p>
<ol class="arabic simple">
<li>Connect to Jubatus Server</li>
</ol>
<blockquote>
<div>Connect to Jubatus Server (Row 20).
Setting the IP addr., RPC port of Jubatus Server.</div></blockquote>
<ol class="arabic simple" start="2">
<li>Prepare the learning data</li>
</ol>
<blockquote>
<div>AnomalyClient will send the Datum to Jubatus server for data learning or anomaly detection, by using its &#8220;add&#8221; method.
In this example, the result-data in KDD Cup(Knowledge Discovery and Data Mining Cup) is used as the trainning data. At first, the program read the training data from the TEXT file, one line at a time (Row 23-24). The data in TEXT file are seperated by commas, so we split the items by ’,’ (Row 25).
Then, we make the data items stored in datum unit for model training later (Row 26-67).</div></blockquote>
<ol class="arabic simple" start="3">
<li>Model training (update learning model)</li>
</ol>
<blockquote>
<div>Input the training data generated in step.2 into the add() method of AnomalyClient (Row 69).
The first parameter in add() is the unique name for task identification in Zookeeper.
(use null charactor &#8220;&#8221; for the stand-alone mode)
The second parameter specifies the Datum generated in step.2.
The returned result &lt;string, float&gt; is consisted of the data ID and its estimated anomaly value.</div></blockquote>
<ol class="arabic simple" start="4">
<li>Display result</li>
</ol>
<blockquote>
<div>Display the returned value from add() method after a correction checking.
The anomaly value should not be infinity or　1.0　(Row 72-74).</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="run-the-sample-program">
<h2>Run the sample program<a class="headerlink" href="#run-the-sample-program" title="Permalink to this headline">¶</a></h2>
<p><strong>[Download Dataset]</strong></p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>$ wget http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz
$ gunzip kddcup.data_10_percent.gz
$ mv kddcup.data_10_percent kddcup.data_10_percent.txt
</pre></div>
</div>
</div></blockquote>
<dl class="docutils">
<dt><strong>［At Jubatus Server］</strong></dt>
<dd><p class="first">start &#8220;jubaanomaly&#8221; process.</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>$ jubaanomaly --configpath config.json
</pre></div>
</div>
</dd>
</dl>
<p><strong>［At Jubatus Client］</strong></p>
<blockquote>
<div><p>Get the required package and Ruby client ready.
Run!</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ruby anomaly.rb
</pre></div>
</div>
</div></blockquote>
<p><strong>［Result］</strong></p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">194</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.0000441074371338</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">494</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.4595649242401123</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1127</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.0642377138137817</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1148</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.0404019355773926</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1709</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.2717968225479126</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2291</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.388629674911499</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2357</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.0560613870620728</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2382</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">0.9994010925292969</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2499</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">0.7581642270088196</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2549</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.011017084121704</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>
<span class="n">id_with_score</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2553</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="mf">1.263816475868225</span><span class="p">}</span> <span class="n">normal</span><span class="o">.</span>

<span class="o">...</span>
<span class="o">...</span><span class="p">(</span><span class="n">omitted</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="anomaly_java.html" class="btn btn-neutral float-right" title="Java" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="anomaly_python.html" class="btn btn-neutral" title="Python" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2017 PFN &amp; NTT.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>