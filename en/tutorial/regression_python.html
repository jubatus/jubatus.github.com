

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python &mdash; Jubatus</title>
    <link rel="stylesheet" href="../_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="../index.html" />
    <link rel="up" title="Regression" href="regression.html" />
    <link rel="next" title="Ruby" href="regression_ruby.html" />
    <link rel="prev" title="Regression" href="regression.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="regression_ruby.html" title="Ruby"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="regression.html" title="Regression"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="../tutorial.html" >Tutorial</a> &raquo;</li>
          <li><a href="regression.html" accesskey="U">Regression</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="../index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Python</a><ul>
<li><a class="reference internal" href="#source-code">Source_code</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
<li><a class="reference internal" href="#run-the-sample-program">Run the sample program</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="regression.html"
                        title="previous chapter">Regression</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="regression_ruby.html"
                        title="next chapter">Ruby</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorial/regression_python.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JubatusOfficial"  data-widget-id="258379257628196864">Tweets by @JubatusOfficial</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="python">
<h1>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h1>
<p>Here we explain the sample program of Regression in Python.</p>
<div class="section" id="source-code">
<h2>Source_code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>In this sample program, we will explain 1) how to configure the learning-algorithms that used by Jubatus, with the example file &#8216;rent.json&#8217;; 2) how to train and predict by &#8216;main.py&#8217; with the training data in &#8216;rent-data.csv&#8217; file and the estimation data in &#8216;myhome.yml&#8217; file. Here are their source codes.</p>
<p><strong>rent.json</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="mo">01</span> <span class="p">:</span> <span class="p">{</span>
<span class="mo">02</span> <span class="p">:</span>   <span class="s">&quot;method&quot;</span><span class="p">:</span> <span class="s">&quot;PA&quot;</span><span class="p">,</span>
<span class="mo">03</span> <span class="p">:</span>   <span class="s">&quot;converter&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="mo">04</span> <span class="p">:</span>     <span class="s">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="mo">05</span> <span class="p">:</span>     <span class="s">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="mo">06</span> <span class="p">:</span>     <span class="s">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="mo">07</span> <span class="p">:</span>     <span class="s">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="mi">08</span> <span class="p">:</span>     <span class="s">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="mi">09</span> <span class="p">:</span>     <span class="s">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="mi">10</span> <span class="p">:</span>       <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;num&quot;</span> <span class="p">}</span>
<span class="mi">11</span> <span class="p">:</span>     <span class="p">],</span>
<span class="mi">12</span> <span class="p">:</span>     <span class="s">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="mi">13</span> <span class="p">:</span>     <span class="s">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="mi">14</span> <span class="p">:</span>       <span class="p">{</span> <span class="s">&quot;key&quot;</span><span class="p">:</span> <span class="s">&quot;aspect&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;global_weight&quot;</span><span class="p">:</span> <span class="s">&quot;bin&quot;</span> <span class="p">}</span>
<span class="mi">15</span> <span class="p">:</span>     <span class="p">]</span>
<span class="mi">16</span> <span class="p">:</span>   <span class="p">},</span>
<span class="mi">17</span> <span class="p">:</span>   <span class="s">&quot;parameter&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="mi">18</span> <span class="p">:</span>     <span class="s">&quot;sensitivity&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="mi">19</span> <span class="p">:</span>     <span class="s">&quot;regularization_weight&quot;</span><span class="p">:</span> <span class="mf">3.402823e+38</span>
<span class="mi">20</span> <span class="p">:</span>   <span class="p">}</span>
<span class="mi">21</span> <span class="p">:</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>main.py</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="mo">01</span> <span class="p">:</span> <span class="kn">import</span> <span class="nn">argparse</span>
<span class="mo">02</span> <span class="p">:</span> <span class="kn">import</span> <span class="nn">yaml</span>
<span class="mo">03</span> <span class="p">:</span>
<span class="mo">04</span> <span class="p">:</span> <span class="kn">from</span> <span class="nn">jubatus.regression.client</span> <span class="kn">import</span> <span class="n">regression</span>
<span class="mo">05</span> <span class="p">:</span> <span class="kn">from</span> <span class="nn">jubatus.regression.types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="mo">06</span> <span class="p">:</span> <span class="kn">from</span> <span class="nn">jubahomes.version</span> <span class="kn">import</span> <span class="n">get_version</span>
<span class="mo">07</span> <span class="p">:</span>
<span class="mi">08</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">parse_options</span><span class="p">():</span>
<span class="mi">09</span> <span class="p">:</span>   <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="mi">10</span> <span class="p">:</span>   <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="mi">11</span> <span class="p">:</span>     <span class="s">&#39;-a&#39;</span><span class="p">,</span>
<span class="mi">12</span> <span class="p">:</span>     <span class="n">required</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
<span class="mi">13</span> <span class="p">:</span>     <span class="n">help</span>     <span class="o">=</span> <span class="s">&#39;analyze data file (YAML)&#39;</span><span class="p">,</span>
<span class="mi">14</span> <span class="p">:</span>     <span class="n">metavar</span>  <span class="o">=</span> <span class="s">&#39;FILE&#39;</span><span class="p">,</span>
<span class="mi">15</span> <span class="p">:</span>     <span class="n">dest</span>     <span class="o">=</span> <span class="s">&#39;analyzedata&#39;</span>
<span class="mi">16</span> <span class="p">:</span>   <span class="p">)</span>
<span class="mi">17</span> <span class="p">:</span>   <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="mi">18</span> <span class="p">:</span>     <span class="s">&#39;-t&#39;</span><span class="p">,</span>
<span class="mi">19</span> <span class="p">:</span>     <span class="n">help</span>     <span class="o">=</span> <span class="s">&#39;train data file (CSV)&#39;</span><span class="p">,</span>
<span class="mi">20</span> <span class="p">:</span>     <span class="n">metavar</span>  <span class="o">=</span> <span class="s">&#39;FILE&#39;</span><span class="p">,</span>
<span class="mi">21</span> <span class="p">:</span>     <span class="n">dest</span>     <span class="o">=</span> <span class="s">&#39;traindata&#39;</span>
<span class="mi">22</span> <span class="p">:</span>   <span class="p">)</span>
<span class="mi">23</span> <span class="p">:</span>   <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="mi">24</span> <span class="p">:</span>     <span class="s">&#39;-v&#39;</span><span class="p">,</span>
<span class="mi">25</span> <span class="p">:</span>     <span class="s">&#39;--version&#39;</span><span class="p">,</span>
<span class="mi">26</span> <span class="p">:</span>     <span class="n">action</span>   <span class="o">=</span> <span class="s">&#39;version&#39;</span><span class="p">,</span>
<span class="mi">27</span> <span class="p">:</span>     <span class="n">version</span>  <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(prog)s</span><span class="s"> &#39;</span> <span class="o">+</span> <span class="n">get_version</span><span class="p">()</span>
<span class="mi">28</span> <span class="p">:</span>   <span class="p">)</span>
<span class="mi">29</span> <span class="p">:</span>   <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="mi">30</span> <span class="p">:</span>
<span class="mi">31</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="mi">32</span> <span class="p">:</span>   <span class="n">args</span> <span class="o">=</span> <span class="n">parse_options</span><span class="p">()</span>
<span class="mi">33</span> <span class="p">:</span>   <span class="c"># 1. Connect to Jubatus Server</span>
<span class="mi">34</span> <span class="p">:</span>   <span class="n">client</span> <span class="o">=</span> <span class="n">regression</span><span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">9199</span><span class="p">)</span>
<span class="mi">35</span> <span class="p">:</span>
<span class="mi">36</span> <span class="p">:</span>   <span class="c"># 2. Prepare the training data</span>
<span class="mi">37</span> <span class="p">:</span>   <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="mi">38</span> <span class="p">:</span>   <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">traindata</span><span class="p">:</span>
<span class="mi">39</span> <span class="p">:</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">traindata</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">traindata</span><span class="p">:</span>
<span class="mi">40</span> <span class="p">:</span>       <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">traindata</span><span class="p">:</span>
<span class="mi">41</span> <span class="p">:</span>
<span class="mi">42</span> <span class="p">:</span>         <span class="c"># skip comments</span>
<span class="mi">43</span> <span class="p">:</span>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
<span class="mi">44</span> <span class="p">:</span>           <span class="k">continue</span>
<span class="mi">45</span> <span class="p">:</span>         <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="mi">46</span> <span class="p">:</span>
<span class="mi">47</span> <span class="p">:</span>         <span class="n">rent</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">stair</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
<span class="mi">48</span> <span class="p">:</span>         <span class="n">string_values</span> <span class="o">=</span> <span class="p">[</span>
<span class="mi">49</span> <span class="p">:</span>           <span class="p">[</span><span class="s">&#39;aspect&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="p">]</span>
<span class="mi">50</span> <span class="p">:</span>         <span class="p">]</span>
<span class="mi">51</span> <span class="p">:</span>         <span class="n">num_values</span> <span class="o">=</span> <span class="p">[</span>
<span class="mi">52</span> <span class="p">:</span>           <span class="p">[</span><span class="s">&#39;distance&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span><span class="p">)],</span>
<span class="mi">53</span> <span class="p">:</span>           <span class="p">[</span><span class="s">&#39;space&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">space</span><span class="p">)],</span>
<span class="mi">54</span> <span class="p">:</span>           <span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">age</span><span class="p">)],</span>
<span class="mi">55</span> <span class="p">:</span>           <span class="p">[</span><span class="s">&#39;stair&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">stair</span><span class="p">)]</span>
<span class="mi">56</span> <span class="p">:</span>         <span class="p">]</span>
<span class="mi">57</span> <span class="p">:</span>         <span class="n">d</span> <span class="o">=</span> <span class="n">datum</span><span class="p">(</span><span class="n">string_values</span><span class="p">,</span> <span class="n">num_values</span><span class="p">)</span>
<span class="mi">58</span> <span class="p">:</span>         <span class="n">train_data</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">rent</span><span class="p">),</span> <span class="n">d</span><span class="p">]]</span>
<span class="mi">59</span> <span class="p">:</span>
<span class="mi">60</span> <span class="p">:</span>         <span class="c"># 3. Model training (update model)</span>
<span class="mi">61</span> <span class="p">:</span>         <span class="n">client</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>
<span class="mi">62</span> <span class="p">:</span>
<span class="mi">63</span> <span class="p">:</span>     <span class="c"># print train number</span>
<span class="mi">64</span> <span class="p">:</span>     <span class="k">print</span> <span class="s">&#39;train ...&#39;</span><span class="p">,</span> <span class="n">num</span>
<span class="mi">65</span> <span class="p">:</span>
<span class="mi">66</span> <span class="p">:</span>   <span class="c"># 4. Prepare predict data</span>
<span class="mi">67</span> <span class="p">:</span>   <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">analyzedata</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">analyzedata</span><span class="p">:</span>
<span class="mi">68</span> <span class="p">:</span>     <span class="n">myhome</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">analyzedata</span><span class="p">)</span>
<span class="mi">69</span> <span class="p">:</span>     <span class="n">string_values</span> <span class="o">=</span> <span class="p">[</span>
<span class="mi">70</span> <span class="p">:</span>       <span class="p">[</span><span class="s">&#39;aspect&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">myhome</span><span class="p">[</span><span class="s">&#39;aspect&#39;</span><span class="p">])]</span>
<span class="mi">71</span> <span class="p">:</span>     <span class="p">]</span>
<span class="mi">72</span> <span class="p">:</span>     <span class="n">num_values</span> <span class="o">=</span> <span class="p">[</span>
<span class="mi">73</span> <span class="p">:</span>       <span class="p">[</span><span class="s">&#39;distance&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">myhome</span><span class="p">[</span><span class="s">&#39;distance&#39;</span><span class="p">])],</span>
<span class="mi">74</span> <span class="p">:</span>       <span class="p">[</span><span class="s">&#39;space&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">myhome</span><span class="p">[</span><span class="s">&#39;space&#39;</span><span class="p">])],</span>
<span class="mi">75</span> <span class="p">:</span>       <span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">myhome</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">])],</span>
<span class="mi">76</span> <span class="p">:</span>       <span class="p">[</span><span class="s">&#39;stair&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">myhome</span><span class="p">[</span><span class="s">&#39;stair&#39;</span><span class="p">])]</span>
<span class="mi">77</span> <span class="p">:</span>     <span class="p">]</span>
<span class="mi">78</span> <span class="p">:</span>     <span class="n">d</span> <span class="o">=</span> <span class="n">datum</span><span class="p">(</span><span class="n">string_values</span><span class="p">,</span> <span class="n">num_values</span><span class="p">)</span>
<span class="mi">79</span> <span class="p">:</span>     <span class="n">analyze_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>
<span class="mi">80</span> <span class="p">:</span>
<span class="mi">81</span> <span class="p">:</span>     <span class="c"># 5. Predict by the regression model</span>
<span class="mi">82</span> <span class="p">:</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">analyze_data</span><span class="p">)</span>
<span class="mi">83</span> <span class="p">:</span>
<span class="mi">84</span> <span class="p">:</span>     <span class="c"># 6. Output result</span>
<span class="mi">85</span> <span class="p">:</span>     <span class="k">print</span> <span class="s">&#39;rent ....&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="mi">86</span> <span class="p">:</span>
</pre></div>
</div>
<p><strong>myhome.yml</strong></p>
<div class="highlight-python"><pre>01 :  #
02 :  # distance : distance from station (walking time in minutes)
03 :  # space    : the footprint of the house (m*m)
04 :  # age      : build age (year)
05 :  # stair    : floors
06 :  # aspect   : direction [ N / NE / E / SE / S / SW / W / NW ]
07 :  #
08 :  distance : 8
09 :  space    : 32.00
10 :  age      : 15
11 :  stair    : 5
12 :  aspect   : "S"</pre>
</div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p><strong>rent.json</strong></p>
<p>The configuration information is given by the JSON unit. Here is the meaning of each JSON filed.</p>
<ul>
<li><p class="first">method</p>
<p>Specify the algorithm used in regression.
Currently, we have &#8220;PA&#8221; (Passive Aggressive) only, so we specify it with &#8220;PA&#8221;.</p>
</li>
<li><p class="first">converter</p>
</li>
</ul>
<blockquote>
<div><p>Specify the configurations in feature converter.
In this example, we will set the &#8220;num_rules&#8221; and &#8220;string_rules&#8221;.</p>
<p>&#8220;num_rules&#8221; are used to specify the extraction rules of numercial features.
&#8220;key&#8221; is &#8220;*&#8221;, it means all the &#8220;key&#8221; are taken into consideration, &#8220;type&#8221; is &#8220;num&#8221;, it means the number(value) specified will be directly used as the input for training the model.
For example, if the &#8220;age = 2&#8221;, use 2 as the input; if the &#8220;stair = 6&#8221;, use 6 as the input.</p>
<p>&#8220;string_rules&#8221; are used to specify the extraction rules of string features.
Here, &#8220;key = aspect&#8221;, &#8220;type = str&#8221;, &#8220;sample_weight = bin&#8221;, and &#8220;global_weight = bin&#8221;.
Their meaning are: the &#8220;aspect&#8221; is treated as a string, and used as the input feature without reform; the weight of each key-value feature is specified to be &#8220;1&#8221;; and the global weight of each feature is specified to be &#8220;1&#8221;.</p>
</div></blockquote>
<ul class="simple">
<li>parameter</li>
</ul>
<blockquote>
<div><p>Specify the parameters to be passed to the algorithm.
The method specified here is &#8220;PA&#8221;, with its configuration as &#8220;&#8221;sensitivity&#8221; and &#8220;regularization_weight&#8221;.</p>
<p>&#8220;sensitivity&#8221; specifies the tolerable range of error. When its value increases, it becomes resistant to noise, but makes errors remain easily instead.
&#8220;regularization_weight&#8221; specifies the sensitivity parameter in the learning. When its value increases, the learning becomes faster, but the method become susceptible to the noise.</p>
<p>In addition, the &#8220;regularization_weight&#8221; above plays various roles in different algorithms, so please be careful in configuring its values in different algorithms.</p>
</div></blockquote>
<p><strong>main.py</strong></p>
<p>We explain the learning and prediction processes in this example codes.</p>
<blockquote>
<div><p>To write the Client program for Regression, we can use the RegressionClient class defined in &#8216;jubatus.regression&#8217;. There are two methods used in this program. The &#8216;train&#8217; method for learning process, and the &#8216;estimate&#8217; method for prediction with the data learnt.</p>
<ol class="arabic simple">
<li>Connect to Jubatus Server</li>
</ol>
<blockquote>
<div>Connect to Jubatus Server (Row 34)
Setting the IP addr. and RPC port of Jubatus Server.</div></blockquote>
<ol class="arabic simple" start="2">
<li>Prepare the training data</li>
</ol>
<blockquote>
<div><p>In this sample program, only if the training data source (CSV file) is specified by the option &#8220;-t&#8221;, processes of step 2-3 is taken. Here we explain these processes.</p>
<p>RegressionClient puts the training data into the List of list&lt;tuple&lt;float, datum&gt;&gt;, and sends the data to train() methods for the model training.
In this example, the training data is generated from the CSV file that privided by a housing rental website.
Factors in the rental information includes rent, aspect, distance, space, age and stairs.
Figure below shows the training data. (The following are four examples from over one hundred housing info. listed in the rent-data.csv)</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="18%" />
<col width="22%" />
<col width="22%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="5">list&lt;tuple&lt;float, datum&gt;&gt;</th>
</tr>
<tr class="row-even"><th class="head" rowspan="3">label(Float)</th>
<th class="head" colspan="4">Datum</th>
</tr>
<tr class="row-odd"><th class="head" colspan="2">list&lt;tuple&lt;string, string&gt;&gt;</th>
<th class="head" colspan="2">list&lt;tuple&lt;string, double&gt;&gt;</th>
</tr>
<tr class="row-even"><th class="head">key(String)</th>
<th class="head">value(String)</th>
<th class="head">key(String)</th>
<th class="head">value(double)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>5.0</td>
<td>&#8220;aspect&#8221;</td>
<td>&#8220;SW&#8221;</td>
<td><div class="first last line-block">
<div class="line">&#8220;distance&#8221;</div>
<div class="line">&#8220;space&#8221;</div>
<div class="line">&#8220;age&#8221;</div>
<div class="line">&#8220;stair&#8221;</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10</div>
<div class="line">20.04</div>
<div class="line">12</div>
<div class="line">1</div>
</div>
</td>
</tr>
<tr class="row-even"><td>6.3</td>
<td>&#8220;aspect&#8221;</td>
<td>&#8220;N&#8221;</td>
<td><div class="first last line-block">
<div class="line">&#8220;distance&#8221;</div>
<div class="line">&#8220;space&#8221;</div>
<div class="line">&#8220;age&#8221;</div>
<div class="line">&#8220;stair&#8221;</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">8</div>
<div class="line">21.56</div>
<div class="line">23</div>
<div class="line">2</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>7.5</td>
<td>&#8220;aspect&#8221;</td>
<td>&#8220;SE&#8221;</td>
<td><div class="first last line-block">
<div class="line">&#8220;distance&#8221;</div>
<div class="line">&#8220;space&#8221;</div>
<div class="line">&#8220;age&#8221;</div>
<div class="line">&#8220;stair&#8221;</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">25</div>
<div class="line">22.82</div>
<div class="line">23</div>
<div class="line">4</div>
</div>
</td>
</tr>
<tr class="row-even"><td>9.23</td>
<td>&#8220;aspect&#8221;</td>
<td>&#8220;S&#8221;</td>
<td><div class="first last line-block">
<div class="line">&#8220;distance&#8221;</div>
<div class="line">&#8220;space&#8221;</div>
<div class="line">&#8220;age&#8221;</div>
<div class="line">&#8220;stair&#8221;</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10</div>
<div class="line">30.03</div>
<div class="line">0</div>
<div class="line">2</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Tuple&lt;float, datum&gt; contains 2 fields, &#8220;Datum&#8221; and the &#8220;label&#8221;.
&#8220;Datum&#8221; is composed of key-value data which could be processed by Jubatus, and there are 2 types of key-value data format.
In the first type, both the &#8220;key&#8221; and &#8220;value&#8221; are in string format (string_values); in the second one, the &#8220;key&#8221; is in string format, but the &#8220;value&#8221; is in numerical format (num_values).
These two types are represented in list&lt;tuple&lt;string, string&gt;&gt; and list&lt;tuple&lt;string, double&gt;&gt;, respectively.</p>
<div class="line-block">
<div class="line">Please have a view of the first data in this table as an example. Because the &#8220;aspect&#8221; is in string format, it is stored in the first list of the list&lt;tuple&lt;string, string&gt;&gt;.</div>
<div class="line">in which, the key is set as &#8220;aspect&#8221;, value is set as &#8220;SW&#8221;.</div>
<div class="line">Because other items are numerical, they are stored in the list of the list&lt;tuple&lt;string, double&gt;&gt;, in which</div>
<div class="line">the first list&#8217;s key is set as &#8220;distance&#8221; and value is set as &#8220;10&#8221;,</div>
<div class="line">the second list&#8217;s key is set as &#8220;space&#8221; and value is set as &#8220;20.04&#8221;,</div>
<div class="line">the third list&#8217;s key is set as &#8220;age&#8221; and value is set as &#8220;15&#8221;,</div>
<div class="line">the fourth list&#8217;s key is set as &#8220;stair&#8221; and value is set as &#8220;1&#8221;.</div>
</div>
<p>The Datum of these 5 Lists is appended with a label of &#8220;5.0&#8221;, as its rent, and forms an instance of tuple&lt;float, datum&gt; which retains the rent (of 5.0 * 10,000) and its corresponding housing condition info.
Thus, the housing rental data are generated in the format of (tuple&lt;float, datum&gt;) List, as the training data to be used.</p>
<p>Here is the detailed process for making the training data in this sample.</p>
<p>First, declare the variable of training data &#8220;trainDat&#8221;, as a TupleFloatDatum List (Row 39).
Next, read the source file (CSV file) of the training data line by line (Row 40-61).
Split the data read from each line in CSV file, by the &#8216;,&#8217; mark (Row 47).</p>
<p>The string items and double items are stored into the Datum components of string_values and num_values (Row 48-56), respectively. Then, a Datum class is generated by datum() method (Row 57). Finally, the Datum is appended with the rent label, so as to be used as one piece of training data (argument &#8216;train&#8217; in Row 58).</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Model Training (update learning model</li>
</ol>
<blockquote>
<div>Input the training data generated in step.2 into the train() method (Row 61).
The first parameter in train() is the unique name for task identification in Zookeeper.
(use null charactor &#8220;&#8221; for the stand-alone mode)
The second parameter specifies the trainData generated in step.2.</div></blockquote>
<ol class="arabic simple" start="4">
<li>Prepare the prediction data</li>
</ol>
<blockquote>
<div><p>Prepare the prediction data in the similar way of training Datum creation.
Here, we generate the data for prediction by using the YAML file (please download the library <a class="reference external" href="http://jyaml.sourceforge.net/download.html">JYaml</a> )
YAML is one kind of data format, in which objects and structure data are serialized.</p>
<p>Read the YAML file (myhome.yml) by yaml.load() and get the return value in dict type (Row 68).
Generate the prediction Datum by using the simliar process as in step 2 (Row 69-78).</p>
<p>Add the Datum into the prediction data list, and send it into the estimate() method in &#8220;RegressionClient&#8221; for prediction.</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Prediction by the regression model</li>
</ol>
<blockquote>
<div>The prediction results are returned as a list by the estimate() method (Row 82).</div></blockquote>
<ol class="arabic simple" start="6">
<li>Output the result</li>
</ol>
<blockquote>
<div>The prediction results are returned in the same order of the prediction data. (In this sample, only one prediction data is used, thus only one result is returned.)
The result is rounded at 2nd decimal for output, because it is in Float type (Row 85).</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="run-the-sample-program">
<h2>Run the sample program<a class="headerlink" href="#run-the-sample-program" title="Permalink to this headline">¶</a></h2>
<p><strong>［At Jubatus Server］</strong></p>
<blockquote>
<div><p>start &#8220;jubaregression&#8221; process.</p>
<div class="highlight-python"><pre>$ jubaregression --configpath rent.json</pre>
</div>
</div></blockquote>
<p><strong>［At Jubatus Client］</strong></p>
<blockquote>
<div><p>Install the command line aplication for using this sample program.</p>
<div class="highlight-python"><pre>$ sudo python setup.py install</pre>
</div>
<p>Specify the option by using the command below.</p>
<div class="highlight-python"><pre>$ jubahomes -t dat/rent-data.csv -a dat/myhome.yml</pre>
</div>
<p><strong>-t</strong> ：CSV file name (if there is training data)</p>
<p><strong>-a</strong> ：YML file name (required)</p>
</div></blockquote>
<p><strong>［Result］</strong></p>
<blockquote>
<div><div class="highlight-python"><pre>train ... 145
rent .... 9.9</pre>
</div>
<p>You can change the dat/myhome.yaml file to predict housing rent under various conditions.</p>
<div class="highlight-python"><pre>$ edit dat/myhome.yml
$ jubahomes -a dat/myhome.yml
$ edit dat/myhome.yml
$ jubahomes -a dat/myhome.yml
  :</pre>
</div>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="regression_ruby.html" title="Ruby"
             >next</a> |</li>
        <li class="right" >
          <a href="regression.html" title="Regression"
             >previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="../tutorial.html" >Tutorial</a> &raquo;</li>
          <li><a href="regression.html" >Regression</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011,2013 PFI &amp; NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>