
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Java &mdash; Jubatus</title>
    <link rel="stylesheet" href="../_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="../index.html" />
    <link rel="up" title="Anomaly" href="anomaly.html" />
    <link rel="next" title="Setup in Distributed Mode" href="../tutorial_distributed.html" />
    <link rel="prev" title="Ruby" href="anomaly_ruby.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../rb-modindex.html" title="Ruby Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../tutorial_distributed.html" title="Setup in Distributed Mode"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="anomaly_ruby.html" title="Ruby"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="../tutorial.html" >Tutorial</a> &raquo;</li>
          <li><a href="anomaly.html" accesskey="U">Anomaly</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="../index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Java</a><ul>
<li><a class="reference internal" href="#source-code">Source_code</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
<li><a class="reference internal" href="#run-the-sample-program">Run the sample program</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="anomaly_ruby.html"
                        title="previous chapter">Ruby</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../tutorial_distributed.html"
                        title="next chapter">Setup in Distributed Mode</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorial/anomaly_java.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JubatusOfficial"  data-widget-id="258379257628196864">Tweets by @JubatusOfficial</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="java">
<h1>Java<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h1>
<p>Here we explain the java sample program of anomaly detection.</p>
<div class="section" id="source-code">
<h2>Source_code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>In this sample program, we will explain 1) how to configure the learning-algorithms in Jubatus with the config file &#8216;config.json&#8217;; 2) how to detect the anomaly data with the example file ‘lof.java’. Here are the source codes of &#8216;config.json&#8217; and &#8216;lof.java&#8217;.</p>
<p><strong>config.json</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;method&quot;</span> <span class="p">:</span> <span class="s2">&quot;lof&quot;</span><span class="p">,</span>
 <span class="s2">&quot;parameter&quot;</span> <span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;nearest_neighbor_num&quot;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s2">&quot;reverse_nearest_neighbor_num&quot;</span> <span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="s2">&quot;method&quot;</span> <span class="p">:</span> <span class="s2">&quot;euclid_lsh&quot;</span><span class="p">,</span>
  <span class="s2">&quot;parameter&quot;</span> <span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;hash_num&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
   <span class="s2">&quot;table_num&quot;</span> <span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
   <span class="s2">&quot;probe_num&quot;</span> <span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
   <span class="s2">&quot;bin_width&quot;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
   <span class="s2">&quot;seed&quot;</span> <span class="p">:</span> <span class="mi">1234</span>
  <span class="p">}</span>
 <span class="p">},</span>

 <span class="s2">&quot;converter&quot;</span> <span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;string_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;string_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;num_filter_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;num_filter_rules&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">&quot;string_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;string_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span> <span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span> <span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">}],</span>
  <span class="s2">&quot;num_types&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;num_rules&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;key&quot;</span> <span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;num&quot;</span><span class="p">}]</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><strong>anomaly.java</strong></p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="kn">package</span> <span class="nn">us.jubat.example.kddcup</span><span class="o">;</span>

  <span class="kn">import</span> <span class="nn">us.jubat.anomaly.AnomalyClient</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">us.jubat.anomaly.IdWithScore</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">us.jubat.common.Datum</span><span class="o">;</span>

  <span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lof</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">HOST</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="o">;</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">PORT</span> <span class="o">=</span> <span class="mi">9199</span><span class="o">;</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;anom_kddcup&quot;</span><span class="o">;</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FILE_PATH</span> <span class="o">=</span> <span class="s">&quot;../&quot;</span><span class="o">;</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TEXT_NAME</span> <span class="o">=</span> <span class="s">&quot;kddcup.data_10_percent.txt&quot;</span><span class="o">;</span>

      <span class="c1">// Define TEXT column names</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">TEXT_COLUMN</span> <span class="o">=</span> <span class="o">{</span>
              <span class="s">&quot;duration&quot;</span><span class="o">,</span>
              <span class="s">&quot;protocol_type&quot;</span><span class="o">,</span>
              <span class="s">&quot;service&quot;</span><span class="o">,</span>
              <span class="s">&quot;flag&quot;</span><span class="o">,</span>
              <span class="s">&quot;src_bytes&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_bytes&quot;</span><span class="o">,</span>
              <span class="s">&quot;land&quot;</span><span class="o">,</span>
              <span class="s">&quot;wrong_fragment&quot;</span><span class="o">,</span>
              <span class="s">&quot;urgent&quot;</span><span class="o">,</span>
              <span class="s">&quot;hot&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_failed_logins&quot;</span><span class="o">,</span>
              <span class="s">&quot;logged_in&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_compromised&quot;</span><span class="o">,</span>
              <span class="s">&quot;root_shell&quot;</span><span class="o">,</span>
              <span class="s">&quot;su_attempted&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_root&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_file_creations&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_shells&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_access_files&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_outbound_cmds&quot;</span><span class="o">,</span>
              <span class="s">&quot;is_host_login&quot;</span><span class="o">,</span>
              <span class="s">&quot;is_guest_login&quot;</span><span class="o">,</span>
              <span class="s">&quot;count&quot;</span><span class="o">,</span>
              <span class="s">&quot;srv_count&quot;</span><span class="o">,</span>
              <span class="s">&quot;serror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;srv_serror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;rerror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;srv_rerror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;same_srv_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;diff_srv_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;srv_diff_host_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_count&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_srv_count&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_same_srv_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_diff_srv_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_same_src_port_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_srv_diff_host_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_serror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_srv_serror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_rerror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_srv_rerror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;label&quot;</span>
      <span class="o">};</span>

      <span class="c1">// Define STRING column names</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">STRING_COLUMN</span> <span class="o">=</span> <span class="o">{</span>
              <span class="s">&quot;protocol_type&quot;</span><span class="o">,</span>
              <span class="s">&quot;service&quot;</span><span class="o">,</span>
              <span class="s">&quot;flag&quot;</span><span class="o">,</span>
              <span class="s">&quot;land&quot;</span><span class="o">,</span>
              <span class="s">&quot;logged_in&quot;</span><span class="o">,</span>
              <span class="s">&quot;is_host_login&quot;</span><span class="o">,</span>
              <span class="s">&quot;is_guest_login&quot;</span>
      <span class="o">};</span>

      <span class="c1">// Define DOUBLE column names</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">DOUBLE_COLUMN</span> <span class="o">=</span> <span class="o">{</span>
              <span class="s">&quot;duration&quot;</span><span class="o">,</span>
              <span class="s">&quot;src_bytes&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_bytes&quot;</span><span class="o">,</span>
              <span class="s">&quot;wrong_fragment&quot;</span><span class="o">,</span>
              <span class="s">&quot;urgent&quot;</span><span class="o">,</span>
              <span class="s">&quot;hot&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_failed_logins&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_compromised&quot;</span><span class="o">,</span>
              <span class="s">&quot;root_shell&quot;</span><span class="o">,</span>
              <span class="s">&quot;su_attempted&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_root&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_file_creations&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_shells&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_access_files&quot;</span><span class="o">,</span>
              <span class="s">&quot;num_outbound_cmds&quot;</span><span class="o">,</span>
              <span class="s">&quot;count&quot;</span><span class="o">,</span>
              <span class="s">&quot;srv_count&quot;</span><span class="o">,</span>
              <span class="s">&quot;serror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;srv_serror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;rerror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;srv_rerror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;same_srv_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;diff_srv_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;srv_diff_host_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_count&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_srv_count&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_same_srv_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_same_src_port_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_diff_srv_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_srv_diff_host_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_serror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_srv_serror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_rerror_rate&quot;</span><span class="o">,</span>
              <span class="s">&quot;dst_host_srv_rerror_rate&quot;</span>
      <span class="o">};</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
          <span class="c1">// 1. Connect to Jubatus Server</span>
          <span class="n">AnomalyClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnomalyClient</span><span class="o">(</span><span class="n">HOST</span><span class="o">,</span> <span class="n">PORT</span> <span class="o">,</span> <span class="n">NAME</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>

          <span class="c1">// 2. Prepare training dataset</span>
          <span class="n">Datum</span> <span class="n">datum</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
          <span class="n">IdWithScore</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

          <span class="k">try</span> <span class="o">{</span>
              <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">FILE_PATH</span> <span class="o">,</span> <span class="n">TEXT_NAME</span><span class="o">)));</span>

              <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
              <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">doubleList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>

              <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>

              <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                  <span class="n">strList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                  <span class="n">doubleList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

                  <span class="n">String</span><span class="o">[]</span> <span class="n">strAry</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">);</span>

                  <span class="c1">// make STRING list and DOUBLE list</span>
                  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">strAry</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                      <span class="k">if</span> <span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">STRING_COLUMN</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">TEXT_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">]))</span> <span class="o">{</span>
                          <span class="n">strList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">strAry</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">DOUBLE_COLUMN</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">TEXT_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">]))</span> <span class="o">{</span>
                          <span class="n">doubleList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">strAry</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                      <span class="o">}</span>
                  <span class="o">}</span>
                  <span class="c1">// make Datum</span>
                  <span class="n">datum</span> <span class="o">=</span> <span class="n">makeDatum</span><span class="o">(</span><span class="n">strList</span><span class="o">,</span> <span class="n">doubleList</span><span class="o">);</span>

                  <span class="c1">// 3. Update the training model</span>
                  <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">datum</span><span class="o">);</span>

                  <span class="c1">// 4. Output results</span>
                  <span class="k">if</span> <span class="o">(!(</span><span class="n">Float</span><span class="o">.</span><span class="na">isInfinite</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">score</span><span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="o">.</span><span class="na">score</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="o">)</span> <span class="o">{</span>
                      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;(&#39;&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">id</span> <span class="o">+</span> <span class="s">&quot;&#39;, &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">score</span> <span class="o">+</span> <span class="s">&quot;) &quot;</span> <span class="o">+</span> <span class="n">strAry</span><span class="o">[</span><span class="n">strAry</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">);</span>
                  <span class="o">}</span>
              <span class="o">}</span>
              <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
          <span class="o">}</span>
          <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="kd">private</span> <span class="n">Datum</span> <span class="nf">makeDatum</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strList</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">doubleList</span><span class="o">)</span> <span class="o">{</span>

          <span class="n">Datum</span> <span class="n">datum</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Datum</span><span class="o">();</span>

          <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">strList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
              <span class="n">datum</span><span class="o">.</span><span class="na">addString</span><span class="o">(</span><span class="n">STRING_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">],</span><span class="n">strList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
          <span class="o">}</span>

          <span class="k">try</span> <span class="o">{</span>
              <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">doubleList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                  <span class="n">datum</span><span class="o">.</span><span class="na">addNumber</span><span class="o">(</span><span class="n">DOUBLE_COLUMN</span><span class="o">[</span><span class="n">i</span><span class="o">],</span><span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">doubleList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)));</span>
              <span class="o">}</span>
          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
              <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
          <span class="o">}</span>

          <span class="k">return</span> <span class="n">datum</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

          <span class="k">new</span> <span class="n">Lof</span><span class="o">().</span><span class="na">execute</span><span class="o">();</span>
          <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p><strong>config.json</strong></p>
<p>The configuration information is given by the JSON unit. Here is the meaning of each JSON field.</p>
<blockquote>
<div><ul class="simple">
<li>method</li>
</ul>
<blockquote>
<div>Specify the algorithm used in anomaly detection. Currently, Recommender based &#8220;lof&#8221;(Local Outlier Factor) and Nearest Neighbor based &#8220;light_lof&#8221; are supported for anomaly detection. Here, we use &#8220;lof&#8221;.</div></blockquote>
<ul class="simple">
<li>parameter</li>
</ul>
<blockquote>
<div>Specify the parameters for anomaly detection algorithm set as method.
Here, we use &#8220;lof&#8221; algorithm and set the parameters according to <a class="reference external" href="http://jubat.us/ja/api_recommender.html">Recommender API</a> .</div></blockquote>
<ul class="simple">
<li>converter</li>
</ul>
<blockquote>
<div><p>Specify the configurations in feature converter. In this sample, we will set &#8220;num_rules&#8221; and &#8220;string_rules&#8221;.</p>
<p>&#8220;num_rules&#8221; specifies the value extracting rules for values in numerical format.
&#8220;key&#8221; is set as &#8220;*&#8221; here, which means all the &#8220;key&#8221; will be taken into account. &#8220;type&#8221; is set as &#8220;num&#8221;, which means each value has its weight as equal as the value itself. For example, if data&#8217;s value i &#8220;2&#8221;, its weight is set as 2; if data&#8217;s value is &#8220;6&#8221;, its weight is set as 6.</p>
<p>&#8220;string_rules&#8221; specifies the value extracting rules for values in string format.
Here, &#8220;key&#8221; is set as &#8220;*&#8221;, &#8220;type&#8221; is &#8220;str&#8221;, &#8220;sample_weight&#8221; is &#8220;bin&#8221;, and &#8220;global_weight&#8221; is &#8220;bin&#8221;.
This means, all the &#8220;key&#8221; will be taken into account, the features in strings values will be used without convertion, the weight of each key-value will be calculated throughout the whole data have been used, and the global weight is a constant value of &#8220;1&#8221;.</p>
</div></blockquote>
</div></blockquote>
<p><strong>anomaly.java</strong></p>
<blockquote>
<div><p>anomaly.java will extract the data from text file, send them to Jubatus server, and get their anomaly detection result from the server.</p>
<ol class="arabic simple">
<li>Connect to Jubatus Server</li>
</ol>
<blockquote>
<div>Connect to Jubatus Server (Row 116).
Setting the IP addr., RPC port of Jubatus Server, and the connection waiting time.</div></blockquote>
<ol class="arabic simple" start="2">
<li>Prepare the learning data</li>
</ol>
<blockquote>
<div><p>AnomalyClient will send the Datum to Jubatus server for data learning or anomaly detection, by using its &#8220;add&#8221; method.
In this example, the result-data in KDD Cup(Knowledge Discovery and Data Mining Cup) is used as the trainning data. At first, the program read the training data from the TEXT file, one line at a time, by using FileReader() and BuffererdReader() methods (Row 130-155). The data in TEXT file are seperated by commas, so we split the items by ’,’ (Row 134).
By using the whole items definition list: TEXT file(TEXT_COLUMN); as well as the &#8220;String&#8221; and &#8220;Double&#8221; items definition list (STRING_COLUMN、DOUBLE_COLUMN), we store the items in different list due to their types (Row 137 - 134).
Put the two lists into one Datum unit and add arguments for each items in the lists, as done by the private method [makeDatum](Row 145).</p>
<p>In the [makeDatum], we will store the data items into the string-list and double-list.　(Row 165-183). We add String value to Datum unit using addString(...) method. In a similar manner, we add Double value to Datum unit using addNumber(...) method. Note that, because the data in doubleList is in String format, data convertion is required when put it into Datum unit (Row 175).</p>
<p>Now, our learning data is ready in the Datum format.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Model training (update learning model)</li>
</ol>
<blockquote>
<div>Input the training data generated in step.2 into the add() method of AnomalyClient (Row 147).
The returned result &lt;string, float&gt; is consisted of the data ID and its estimated anomaly value.</div></blockquote>
<ol class="arabic simple" start="4">
<li>Display result</li>
</ol>
<blockquote>
<div>Display the returned value from add() method after a correction checking (Row 151).
The anomaly value should not be infinity or　1.0　(Row 152).</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="run-the-sample-program">
<h2>Run the sample program<a class="headerlink" href="#run-the-sample-program" title="Permalink to this headline">¶</a></h2>
<p><strong>[Download Dataset]</strong></p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>$ wget http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz
$ gunzip kddcup.data_10_percent.gz
$ mv kddcup.data_10_percent kddcup.data_10_percent.txt
</pre></div>
</div>
</div></blockquote>
<dl class="docutils">
<dt><strong>［At Jubatus Server］</strong></dt>
<dd>start &#8220;jubaanomaly&#8221; process.</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ jubaanomaly --configpath config.json
</pre></div>
</div>
<dl class="docutils">
<dt><strong>［At Jubatus Client］</strong></dt>
<dd>Get the required package and Java client ready.
Run!
Please see the detail here -&gt; <a class="reference external" href="https://github.com/jubatus/jubatus-example/tree/master/network_intrusion_detection">Jubatus Example</a></dd>
</dl>
<p><strong>［Result］</strong></p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;194&#39;</span><span class="p">,</span> <span class="mf">1.0000441074371338</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="p">(</span><span class="s1">&#39;494&#39;</span><span class="p">,</span> <span class="mf">1.4595649242401123</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="p">(</span><span class="s1">&#39;1127&#39;</span><span class="p">,</span> <span class="mf">1.0642377138137817</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="p">(</span><span class="s1">&#39;1148&#39;</span><span class="p">,</span> <span class="mf">1.0404019355773926</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="p">(</span><span class="s1">&#39;1709&#39;</span><span class="p">,</span> <span class="mf">1.2717968225479126</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="p">(</span><span class="s1">&#39;2291&#39;</span><span class="p">,</span> <span class="mf">1.388629674911499</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="p">(</span><span class="s1">&#39;2357&#39;</span><span class="p">,</span> <span class="mf">1.0560613870620728</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="p">(</span><span class="s1">&#39;2382&#39;</span><span class="p">,</span> <span class="mf">0.9994010925292969</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="p">(</span><span class="s1">&#39;2499&#39;</span><span class="p">,</span> <span class="mf">0.7581642270088196</span><span class="p">)</span> <span class="n">normal</span><span class="o">.</span>
<span class="o">...</span>
<span class="o">...</span> <span class="p">(</span><span class="n">omitted</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../rb-modindex.html" title="Ruby Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../tutorial_distributed.html" title="Setup in Distributed Mode"
             >next</a> |</li>
        <li class="right" >
          <a href="anomaly_ruby.html" title="Ruby"
             >previous</a> |</li>
        <li><a href="../index.html">Jubatus</a> &raquo;</li>
          <li><a href="../tutorial.html" >Tutorial</a> &raquo;</li>
          <li><a href="anomaly.html" >Anomaly</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2016 PFN &amp; NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.1.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>