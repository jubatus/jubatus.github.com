

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python &mdash; Jubatus</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="Jubatus" href="../index.html"/>
        <link rel="up" title="Stat" href="stat.html"/>
        <link rel="next" title="Distributed Mode" href="../tutorial_distributed.html"/>
        <link rel="prev" title="Stat" href="stat.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Jubatus
          

          
            
            <img src="../_static/title.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Basic Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="classifier.html">Classifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="anomaly.html">Anomaly</a></li>
<li class="toctree-l2"><a class="reference internal" href="regression.html">Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph.html">Graph</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="stat.html">Stat</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="stat.html#abstract-of-sample-program">Abstract of sample program</a></li>
<li class="toctree-l3"><a class="reference internal" href="stat.html#processing-flow">Processing flow</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="stat.html#sample-program">Sample Program</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Python</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_distributed.html">Distributed Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fv_convert.html">Data Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../method.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/index.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_faqs/index.html">Tips and FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jubakit/index.html">Jubakit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jubaql/index.html">JubaQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About This Project</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Jubatus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Tutorial</a> &raquo;</li>
      
          <li><a href="stat.html">Stat</a> &raquo;</li>
      
    <li>Python</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python">
<h1>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h1>
<p>Here we explain the sample program of Stat in Python.</p>
<div class="section" id="source-code">
<h2>Source_code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>In this sample program, we will explain 1) how to configure the learning-algorithms that used by Jubatus, with the example file &#8216;stat.json&#8217;; 2) how to train the model by &#8216;stat.py&#8217;. Here are the source codes.</p>
<p><strong>stat.json</strong></p>
<div class="highlight-js"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;window_size&quot;</span><span class="o">:</span> <span class="mi">500</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><strong>stat.py</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">jubatus.stat.client</span> <span class="kn">import</span> <span class="n">Stat</span>

<span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;stat_tri&quot;</span><span class="p">;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

  <span class="c1"># 1. Jubatus Serverへの接続設定</span>
  <span class="c1"># 1. Connect to Jubatus Server</span>
  <span class="n">stat</span> <span class="o">=</span> <span class="n">Stat</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">9199</span><span class="p">,</span> <span class="n">NAME</span><span class="p">)</span>

  <span class="c1"># 2. Prepare the training data</span>
  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../dat/fruit.csv&#39;</span><span class="p">):</span>
    <span class="n">fruit</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">weight</span> <span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

    <span class="c1"># 3. Data training (update model)</span>
    <span class="n">stat</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fruit</span> <span class="o">+</span> <span class="s2">&quot;dia&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">diameter</span><span class="p">))</span>
    <span class="n">stat</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fruit</span> <span class="o">+</span> <span class="s2">&quot;wei&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">))</span>
    <span class="n">stat</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fruit</span> <span class="o">+</span> <span class="s2">&quot;pri&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>

  <span class="c1"># 4. Output result</span>
  <span class="k">for</span> <span class="n">fr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span><span class="s2">&quot;melon&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dia&quot;</span><span class="p">,</span><span class="s2">&quot;wei&quot;</span><span class="p">,</span> <span class="s2">&quot;pri&quot;</span><span class="p">]:</span>
      <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;sum :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">))</span>
      <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;sdv :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">stddev</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">))</span>
      <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;max :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">))</span>
      <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;min :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">))</span>
      <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;ent :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">entropy</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">))</span>
      <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;mmt :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p><strong>stat.json</strong></p>
<p>The configuration information is given by the JSON unit. Here is the meaning of each JSON field.</p>
<ul>
<li><dl class="first docutils">
<dt>window_size</dt>
<dd><p class="first last">Specify the amount of value to be retained. (Integer)</p>
</dd>
</dl>
</li>
</ul>
<p><strong>stat.py</strong></p>
<p>Stat.py reads the &#8216;price&#8217;, &#8216;weight&#8217;, &#8216;diameter&#8217; of fruits from the .csv file, and send the info. to Jubatus server. The methods used are listed below.</p>
<ul>
<li><dl class="first docutils">
<dt>bool push(0: string key, 1: double val)</dt>
<dd><p class="first last">Set the attribute info. &#8220;key&#8220;&#8216;s value with &#8220;val&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double sum(0: string key)</dt>
<dd><p class="first last">Return the summary value in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double stddev(0: string key)</dt>
<dd><p class="first last">Return the standard deviation of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double max(0: string key)</dt>
<dd><p class="first last">Return the maximum value of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double min(0: string key)</dt>
<dd><p class="first last">Return the minimum value of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double entropy(0: string key)</dt>
<dd><p class="first last">Return the entropy of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double moment(0: string key, 1: int degree, 2: double center)</dt>
<dd><p class="first last">Return the degree-th moment about &#8216;center&#8217; of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
</ul>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Connect to Jubatus Server.</dt>
<dd><p class="first">Connect to Jubatus Server (Line 12).</p>
<p class="last">Setting the IP addr, RPC port of Jubatus Server and the unique name for task identification in Zookeeper.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Prepare the learning data</dt>
<dd><p class="first last">Stat client send the &lt;item_name, value&gt; to the server side as training data, by using the push() method.
In this sample program, the training data are generated from a .CSV file which contains the info. of &#8216;fruit type&#8217;, &#8216;price&#8217;, &#8216;weight&#8217;, &#8216;diameter&#8217;.
The source data is read line by line from the .CSV file (Line 14-21).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Data training (update the model)</dt>
<dd><p class="first last">The training data generated in Step 2 is send to the server site by using the push() method (Line 19-21) for training model there. Items of fruit are renamed as the fruit&#8217;s name extended with the item&#8217;s prefix, eg. item for a fruit&#8217;s diameter is: fruit&#8217;s name + &#8220;dia&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Output the result</dt>
<dd><p class="first last">Stat client gets the different statistic results by using its methods.
For each type of fruits(Line 24), the program outputs its statistic results of all the items (Line 25).
Different methods are called (Line 26-31) in the loop above. Their contents are listed in the methods list above.</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="run-the-sample-program">
<h2>Run the sample program<a class="headerlink" href="#run-the-sample-program" title="Permalink to this headline">¶</a></h2>
<ul>
<li><dl class="first docutils">
<dt>At Jubatus Server</dt>
<dd><p class="first">start &#8220;jubagraph&#8221; process.</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>$ jubastat --configpath stat.json
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>At Jubatus Client</dt>
<dd><p class="first">Get the required package and Python client ready.</p>
<p>Output:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="nb">sum</span> <span class="p">:</span> <span class="n">orangedia</span> <span class="mf">1503.399996995926</span>
<span class="n">sdv</span> <span class="p">:</span> <span class="n">orangedia</span> <span class="mf">10.868084068651045</span>
<span class="nb">max</span> <span class="p">:</span> <span class="n">orangedia</span> <span class="mf">54.29999923706055</span>
<span class="nb">min</span> <span class="p">:</span> <span class="n">orangedia</span> <span class="o">-</span><span class="mf">2.0999999046325684</span>
<span class="n">ent</span> <span class="p">:</span> <span class="n">orangedia</span> <span class="mf">0.0</span>
<span class="n">mmt</span> <span class="p">:</span> <span class="n">orangedia</span> <span class="mf">28.911538403767807</span>
<span class="nb">sum</span> <span class="p">:</span> <span class="n">orangewei</span> <span class="mf">10394.399948120117</span>
<span class="n">sdv</span> <span class="p">:</span> <span class="n">orangewei</span> <span class="mf">54.92258724344468</span>
<span class="nb">max</span> <span class="p">:</span> <span class="n">orangewei</span> <span class="mf">321.6000061035156</span>
<span class="nb">min</span> <span class="p">:</span> <span class="n">orangewei</span> <span class="mf">39.5</span>
<span class="n">ent</span> <span class="p">:</span> <span class="n">orangewei</span> <span class="mf">0.0</span>
<span class="n">mmt</span> <span class="p">:</span> <span class="n">orangewei</span> <span class="mf">196.1207537381154</span>
<span class="nb">sum</span> <span class="p">:</span> <span class="n">orangepri</span> <span class="mf">1636.0</span>
<span class="n">sdv</span> <span class="p">:</span> <span class="n">orangepri</span> <span class="mf">7.936154992801973</span>
<span class="nb">max</span> <span class="p">:</span> <span class="n">orangepri</span> <span class="mf">50.0</span>
<span class="nb">min</span> <span class="p">:</span> <span class="n">orangepri</span> <span class="mf">6.0</span>
<span class="n">ent</span> <span class="p">:</span> <span class="n">orangepri</span> <span class="mf">0.0</span>
<span class="n">mmt</span> <span class="p">:</span> <span class="n">orangepri</span> <span class="mf">30.867924528301888</span>
<span class="nb">sum</span> <span class="p">:</span> <span class="n">appledia</span> <span class="mf">2902.0000019073486</span>
<span class="n">sdv</span> <span class="p">:</span> <span class="n">appledia</span> <span class="mf">15.412238321876663</span>
<span class="o">...</span>
<span class="o">...</span> <span class="p">(</span><span class="n">omitted</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tutorial_distributed.html" class="btn btn-neutral float-right" title="Distributed Mode" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="stat.html" class="btn btn-neutral" title="Stat" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2017 PFN &amp; NTT.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>