

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python &mdash; Jubatus</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="Jubatus" href="../index.html"/>
        <link rel="up" title="Graph" href="graph.html"/>
        <link rel="next" title="Stat" href="stat.html"/>
        <link rel="prev" title="Graph" href="graph.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Jubatus
          

          
            
            <img src="../_static/title.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Basic Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="classifier.html">Classifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="anomaly.html">Anomaly</a></li>
<li class="toctree-l2"><a class="reference internal" href="regression.html">Regression</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="graph.html">Graph</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="graph.html#abstract-of-sample-program">Abstract of sample program</a></li>
<li class="toctree-l3"><a class="reference internal" href="graph.html#processing-flow">Processing flow</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="graph.html#sample-program">Sample Program</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Python</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="stat.html">Stat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_distributed.html">Distributed Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fv_convert.html">Data Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../method.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/index.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_faqs/index.html">Tips and FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jubakit/index.html">Jubakit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jubaql/index.html">JubaQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About This Project</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Jubatus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Tutorial</a> &raquo;</li>
      
          <li><a href="graph.html">Graph</a> &raquo;</li>
      
    <li>Python</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python">
<h1>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h1>
<p>Here we explain the sample program of Graph in Python.</p>
<div class="section" id="source-code">
<h2>Source_code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>In this sample program, we will explain 1) how to configure the learning-algorithms that used by Jubatus, with the example file &#8216;train_route.json&#8217;; 2) how to create the graph with &#8216;create_graph.py&#8217;, and how to learn the training data and calculate the shortest path with the example file ‘search_route.py’. Here are the source codes.</p>
<p><strong>train_route.json</strong></p>
<div class="highlight-js"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;graph_wo_index&quot;</span><span class="p">,</span>
  <span class="s2">&quot;parameter&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;damping_factor&quot;</span> <span class="o">:</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="s2">&quot;landmark_num&quot;</span> <span class="o">:</span> <span class="mi">256</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><strong>create_graph.py</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Python 2 compatibility:</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># for Python 3</span>
    <span class="kn">import</span> <span class="nn">urllib.request</span> <span class="kn">as</span> <span class="nn">urllib</span>
<span class="k">except</span><span class="p">:</span>
    <span class="c1"># for Python 2</span>
    <span class="kn">import</span> <span class="nn">urllib</span>

<span class="kn">from</span> <span class="nn">xml.dom</span> <span class="kn">import</span> <span class="n">minidom</span><span class="p">,</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">jubatus.graph</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">types</span>

<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9199</span>
<span class="n">instance_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="n">stations</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">class</span> <span class="nc">station_join</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station1</span><span class="p">,</span> <span class="n">station2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station1</span> <span class="o">=</span> <span class="n">station1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station2</span> <span class="o">=</span> <span class="n">station2</span>

<span class="k">def</span> <span class="nf">get_station_join</span><span class="p">(</span><span class="n">line_cd</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create array of `station_join` that represents which stations are connected.</span>

<span class="sd">    In this example, we are connecting stations BY NAME, i.e., two stations</span>
<span class="sd">    with the same name are regarded as connected and can be transferred to</span>
<span class="sd">    each other.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">join_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://www.ekidata.jp/api/n/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_cd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">join_node</span> <span class="ow">in</span> <span class="n">dom</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;station_join&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">join_node_child</span> <span class="ow">in</span> <span class="n">join_node</span><span class="o">.</span><span class="n">childNodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">join_node_child</span><span class="o">.</span><span class="n">nodeType</span> <span class="o">==</span> <span class="n">Node</span><span class="o">.</span><span class="n">TEXT_NODE</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">join_node_child</span><span class="o">.</span><span class="n">nodeName</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">join_node_child</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">nodeValue</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;station_name1&#39;</span><span class="p">:</span>
                <span class="n">station_name1</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;station_name2&#39;</span><span class="p">:</span>
                <span class="n">station_name2</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">join_list</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">station_join</span><span class="p">(</span><span class="n">station_name1</span><span class="p">,</span> <span class="n">station_name2</span><span class="p">)</span> <span class="p">]</span>
    <span class="k">return</span> <span class="n">join_list</span>

<span class="k">def</span> <span class="nf">create_graph</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">join_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="n">join_list</span><span class="p">:</span>
        <span class="c1"># Create nodes for stations.</span>
        <span class="n">s1_node_id</span> <span class="o">=</span> <span class="n">add_station</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">join</span><span class="o">.</span><span class="n">station1</span><span class="p">)</span>
        <span class="n">s2_node_id</span> <span class="o">=</span> <span class="n">add_station</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">join</span><span class="o">.</span><span class="n">station2</span><span class="p">)</span>

        <span class="c1"># Create bi-directional edge between two nodes.</span>
        <span class="n">edge_1</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Edge</span><span class="p">({},</span> <span class="n">s1_node_id</span><span class="p">,</span> <span class="n">s2_node_id</span><span class="p">)</span>
        <span class="n">edge_2</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Edge</span><span class="p">({},</span> <span class="n">s2_node_id</span><span class="p">,</span> <span class="n">s1_node_id</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">create_edge</span><span class="p">(</span><span class="n">s1_node_id</span><span class="p">,</span> <span class="n">edge_1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">create_edge</span><span class="p">(</span><span class="n">s2_node_id</span><span class="p">,</span> <span class="n">edge_2</span><span class="p">)</span>

        <span class="c1"># Comment-out this line if you&#39;re running in distributed mode.</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add_station</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
        <span class="n">node_id</span> <span class="o">=</span> <span class="n">stations</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node_id</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">create_node</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
        <span class="n">stations</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
    <span class="k">return</span> <span class="n">node_id</span>

<span class="k">def</span> <span class="nf">print_stations</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">stations</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="n">k</span><span class="p">])):</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;{0}</span><span class="se">\t</span><span class="s2">{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="n">station</span><span class="p">],</span> <span class="n">station</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Create jubagraph client.</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">instance_name</span><span class="p">)</span>

    <span class="c1"># Prepare query.</span>
    <span class="n">pq</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PresetQuery</span><span class="p">([],</span> <span class="p">[])</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add_shortest_path_query</span><span class="p">(</span><span class="n">pq</span><span class="p">)</span>

    <span class="c1"># Register stations in each line.</span>
    <span class="c1"># Do not add too much lines to prevent causing heavy load to the API server.</span>
    <span class="n">create_graph</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">get_station_join</span><span class="p">(</span><span class="mi">11302</span><span class="p">))</span> <span class="c1"># 山手線</span>
    <span class="n">create_graph</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">get_station_join</span><span class="p">(</span><span class="mi">11312</span><span class="p">))</span> <span class="c1"># 中央線</span>

    <span class="c1"># Print station IDs; you need the ID to search route.</span>
    <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;=== Station IDs ===&quot;</span><span class="p">)</span>
    <span class="n">print_stations</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p><strong>search_route.py</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Python 2 compatibility:</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">jubatus.graph</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">types</span>

<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9199</span>
<span class="n">instance_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">search_route</span><span class="p">(</span><span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">instance_name</span><span class="p">)</span>

    <span class="n">pq</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PresetQuery</span><span class="p">([],</span> <span class="p">[])</span>
    <span class="n">spreq</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ShortestPathQuery</span><span class="p">(</span><span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">pq</span><span class="p">)</span>
    <span class="n">stations</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">spreq</span><span class="p">)</span>

    <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Pseudo-Shortest Path (hops) from {0} to {1}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>
        <span class="n">station_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">property</span><span class="p">:</span>
            <span class="n">station_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">property</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;  {0}</span><span class="se">\t</span><span class="s2">{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="n">station_name</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Usage: {0} from_station_id to_station_id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">search_route</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p><strong>train_route.json</strong></p>
<p>The configuration information is given by the JSON unit. Here is the meaning of each JSON field.</p>
<ul>
<li><dl class="first docutils">
<dt>method</dt>
<dd><p class="first last">Specify the algorithm used in graph mining. Currently, In this example, we use the graph without indexing, so we specify it &#8220;graph_wo_index&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>parameter</dt>
<dd><p class="first last">Specify the parameters to be passed to the algorithm.
We specify two parameter here, &#8220;damping_factor&#8221; and &#8220;landmark_num&#8221;.
&#8220;damping_factor&#8221; is the damping factor used in PageRank calculation. It adjusts scores for nodes with differenct degrees.The bigger it is, the more sensitive to graph structure PageRank score is, but the larger biases it causes. In the original paper, 0.85 is good.
&#8220;landmark_num&#8221; is used for shortest path calculation. The bigger it is, more accurate value you can get, but the more memory is required.</p>
</dd>
</dl>
</li>
</ul>
<p><strong>create_graph.py</strong></p>
<p>create_graph.py generates a graph composed of Yamanote-line and Chuou-line. The client program in Graph will use the &#8216;Graph&#8217; class defined in &#8216;jubatus.graph&#8217;. Here are the 5 methods used in the sample.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Connect to Jubatus Server</dt>
<dd><p class="first">Connect to Jubatus Server (Line 74).</p>
<p class="last">Setting the IP addr, RPC port of Jubatus Server and the unique name for task identification in Zookeeper.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Regist the preset query</dt>
<dd><p class="first last">The &#8216;add_shortest_path_query&#8217; method must be registered beforehand. Therefore, the &#8216;PresetQuery&#8217; is made (Line 77) and registed by &#8216;add_shortest_path_query&#8217; (Line 78).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Generate the graph</dt>
<dd><p class="first">Make the graph composed of Yamanote-line and Chuou-line.
Firstly, the method [create_graph] is called at (Line 82-83).
The first argument in [create_graph] is the Graph made in Step. 1.
The second argument is the return value from method [get_station_join].</p>
<p>Method [get_station_join] makes the combination list of two neighbor stations.
The station XML file is downloaded from Web (Line 29-30).
Contents of the XML file likes below.
In this sample program, we ignore the factor of &#8216;distance&#8217;, and only consider the connections between stations. So, the values in &lt;station_name1&gt;, &lt;station_name2&gt; are not used in the program.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;ekidata</span> <span class="na">version=</span><span class="s">&quot;ekidata.jp station_join api 1.0&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;station_join&gt;</span>
 <span class="nt">&lt;station_cd1&gt;</span>1131231<span class="nt">&lt;/station_cd1&gt;</span>
 <span class="nt">&lt;station_cd2&gt;</span>1131232<span class="nt">&lt;/station_cd2&gt;</span>
 <span class="nt">&lt;station_name1&gt;</span>Nichi-Hachioji<span class="nt">&lt;/station_name1&gt;</span>
 <span class="nt">&lt;station_name2&gt;</span>Takao<span class="nt">&lt;/station_name2&gt;</span>
 <span class="nt">&lt;lat1&gt;</span>35.656621<span class="nt">&lt;/lat1&gt;</span>
 <span class="nt">&lt;lon1&gt;</span>139.31264<span class="nt">&lt;/lon1&gt;</span>
 <span class="nt">&lt;lat2&gt;</span>35.642026<span class="nt">&lt;/lat2&gt;</span>
 <span class="nt">&lt;lon2&gt;</span>139.282288<span class="nt">&lt;/lon2&gt;</span>
<span class="nt">&lt;/station_join&gt;</span>
<span class="nt">&lt;station_join&gt;</span>
 <span class="nt">&lt;station_cd1&gt;</span>1131230<span class="nt">&lt;/station_cd1&gt;</span>
 <span class="nt">&lt;station_cd2&gt;</span>1131231<span class="nt">&lt;/station_cd2&gt;</span>
 <span class="nt">&lt;station_name1&gt;</span>Hachioji<span class="nt">&lt;/station_name1&gt;</span>
 <span class="nt">&lt;station_name2&gt;</span>Nichi-Hachioji<span class="nt">&lt;/station_name2&gt;</span>
 <span class="nt">&lt;lat1&gt;</span>35.655555<span class="nt">&lt;/lat1&gt;</span>
 <span class="nt">&lt;lon1&gt;</span>139.338998<span class="nt">&lt;/lon1&gt;</span>
 <span class="nt">&lt;lat2&gt;</span>35.656621<span class="nt">&lt;/lat2&gt;</span>
 <span class="nt">&lt;lon2&gt;</span>139.31264<span class="nt">&lt;/lon2&gt;</span>
<span class="nt">&lt;/station_join&gt;</span>
<span class="nt">&lt;station_join&gt;</span>
 <span class="nt">&lt;station_cd1&gt;</span>1131229<span class="nt">&lt;/station_cd1&gt;</span>
 <span class="nt">&lt;station_cd2&gt;</span>1131230<span class="nt">&lt;/station_cd2&gt;</span>
 <span class="nt">&lt;station_name1&gt;</span>Toyota<span class="nt">&lt;/station_name1&gt;</span>
 <span class="nt">&lt;station_name2&gt;</span>Hachioji<span class="nt">&lt;/station_name2&gt;</span>
 <span class="nt">&lt;lat1&gt;</span>35.659502<span class="nt">&lt;/lat1&gt;</span>
 <span class="nt">&lt;lon1&gt;</span>139.381495<span class="nt">&lt;/lon1&gt;</span>
 <span class="nt">&lt;lat2&gt;</span>35.655555<span class="nt">&lt;/lat2&gt;</span>
 <span class="nt">&lt;lon2&gt;</span>139.338998<span class="nt">&lt;/lon2&gt;</span>
<span class="nt">&lt;/station_join&gt;</span>
-Snip-
</pre></div>
</div>
<p>Now, we input the value of &lt;station_cd1&gt; in the XML file into the instance variable &#8216;station1&#8217; in [StationJoin] class, and the value of &lt;station_cd2&gt; in to &#8216;station2&#8217;.
The number of instance created in [StationJoin] is the same as the number of &lt;station_join&gt; tags, and they are sotred in the ArrayList that created at Line 28 （Line 31-41).</p>
<p>Next, we make the graph by using the list created above (Line 44-57).
The method [create_graph] performs the following task.</p>
<ul>
<li><dl class="first docutils">
<dt>Add station information and ID.</dt>
<dd><p class="first last">Insert node into graph. Here, a node means a station. (eg. Shinagawa, Ochanomizu, Tokyo, etc.)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Create links between the added two neighbor stations</dt>
<dd><p class="first last">Make the bi-link between the registed station to its neighbor stations. Here, a link means a route. (eg. Harajuku &lt;-&gt; Shibuya, etc.)</p>
</dd>
</dl>
</li>
</ul>
<dl class="docutils">
<dt>3-1. Add station information and ID.</dt>
<dd><p class="first last">Method [add_station] is called (Line 47-48), to add every pair of neighboring nodes &lt;station1, station2&gt; in to the graph.
Method [add_station] will check the map of &#8216;stations&#8217;. If the map contains the specified station, the station_id will be returned; Otherwise, a new node is created, and its ID is returned after storing the nodeID and station name into the &#8216;stations&#8217; map (Line 59-66).
Mehods [create_node] and [update_node] in Graph regist the new node.
first, [create_node] method is called and the returned value is the nodeId.
After that, a node is added into the graph. Then, we regist the key-value &lt;name, &#8220;station name&#8221;&gt; into the &#8216;property&#8217; (Line 63).
Finally, [update_node] method updates the &#8216;property&#8217; with the node created at Line 63 (Line 64).</p>
</dd>
<dt>3-2. Create links between the added two neighbor stations</dt>
<dd><p class="first last">After adding the two neighbor stations by method [addStation], we create the bi-links between station1 and station2 (Line 51-54).
Method [create_edge] is used to create the bi-links.
The second argument means the start node&#8217;s ID. The third argument is an edge instance, which has the nodeID of both start and end nodes of the edge.</p>
</dd>
</dl>
<p class="last">The [update_index] method in Line 57 is used for locally Mix operation, do not use it in distributed environment.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Show the stations</dt>
<dd><p class="first last">In step 3-1, station name and station ID(nodeID) are stored into the &#8220;stations&#8221;. Here, we output the stations names by the ascending order of their IDs (Line 68-70).</p>
</dd>
</dl>
</li>
</ol>
<p><strong>search_route.py</strong></p>
<p>&#8216;search_route.py&#8217; finds the shortest path between every 2 stations from the graph that made by create_graph.py.
The method it used is the &#8220;get_shortest_path&#8221;.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Connect to Jubatus Server</dt>
<dd><p class="first">Connect to Jubatus Server (Line 12).</p>
<p class="last">Setting the IP addr, RPC port of Jubatus Server and the unique name for task identification in Zookeeper.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Prepare the query</dt>
<dd><p class="first last">Prepare the query for the shortest path calculation (Line 14-15).
Create the ShortestPathQuery required by the [get_shortest_path] method (Line 15).
Store the start node&#8217;s &amp; end node&#8217;s nodeIDs into the first &amp; second arguments in the &#8216;types.ShortestPathQuery&#8217;. The third argument is the number of &#8216;maxhop&#8217;, the search process will be truncated if it fails to find the route within the specified number of &#8216;maxhop&#8217;.
Also note, the query should be registed by &#8220;add_shortest_path_query&#8221; beforehand.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Calculate the shortes path</dt>
<dd><p class="first last">By specifying the &#8220;ShortestPathQuery&#8221; that created in Step.2, [get_shortest_path] method will find the shortest path (Line 16).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Show the results</dt>
<dd><p class="first last">Show the ID of stations that on the shortes path calculated in Step 3 (Line 18-24).</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="run-the-sample-program">
<h2>Run the sample program<a class="headerlink" href="#run-the-sample-program" title="Permalink to this headline">¶</a></h2>
<ul>
<li><dl class="first docutils">
<dt>At Jubatus Server</dt>
<dd><p class="first">start &#8220;jubagraph&#8221; process.</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>$ jubagraph --configpath train_route.json
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>At Jubatus Client</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Create graph</dt>
<dd><p class="first">Make the railway route graph.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ./create_graph.py
=== Station IDs ===
0       Shinagawa
1       Osaki
4       Tamachi
...
139     Nagano
144     Yotsuya
147     Ochanomizu
</pre></div>
</div>
<p class="last">Output of the station name, and their station ID (node ID on graph).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Search the shortest path</dt>
<dd><p class="first">Search the shortest path between 2 stations.</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>$ ./search_route.py 0 144
Pseudo-Shortest Path (hops) from 0 to 144:
0     Shinagawa
4     Tamachi
7     Hamamatsucho
10    Shinbashi
13    Yurakucho
16    Tokyo
19    Kanda
147   Ochanomizu
144   Yotsuya
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="stat.html" class="btn btn-neutral float-right" title="Stat" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="graph.html" class="btn btn-neutral" title="Graph" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2018 PFN &amp; NTT.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>