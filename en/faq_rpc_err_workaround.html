

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>RPC Error Handling &mdash; Jubatus</title>
    <link rel="stylesheet" href="_static/jubatus.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

    
<script type="text/javascript">
   var GuideSentence = 'keyword';
   function ShowFormGuide(obj) {
      if( obj.value == '' ) {
         obj.value = GuideSentence;
         obj.style.color = '#cccccc';
      }else{
         obj.style.color = '#333333';
      }
   }
   function HideFormGuide(obj) {
      obj.style.color = '#827046';
      if( obj.value == GuideSentence ) {
         obj.value='';   
      }
   }
</script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="index.html" />
    <link rel="up" title="Documentation" href="documentation.html" />
    <link rel="next" title="Backup and Recovery" href="backup_and_recovery.html" />
    <link rel="prev" title="How to Get Clients" href="howtogetclients.html" /> 

<!--

   _________         ___
   \____   _|       | /             ___I_I___
       |  |         | |             \__^ ^__/        ____
       |  |         | | ___    ___  __ | |          / __/
       |  | |-|  |-|| |/   \  /   \| | | | |^|  |^|| (__
       |  | | |  | ||    ^  ||  ^    | | | | |  | | \__ \
       |  | | \_/  ||    O   || O    | | |_| \_/  | ___) |
       |  |  \__/|_||_|\___/  \___/|_| |__/ \__/|_| \___/
       | /
      / /
     |/

-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26408953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="backup_and_recovery.html" title="Backup and Recovery"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="howtogetclients.html" title="How to Get Clients"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Jubatus</a> &raquo;</li>
          <li><a href="documentation.html" accesskey="U">Documentation</a> &raquo;</li> 
      </ul>
    </div>
          
		<a href="index.html">
			 <div class="title"></div>
		</a>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">RPC Error Handling</a><ul>
<li><a class="reference internal" href="#common-issues">Common Issues</a></li>
<li><a class="reference internal" href="#recommendation-for-each-client-languages">Recommendation for each client languages</a><ul>
<li><a class="reference internal" href="#ruby">Ruby</a></li>
<li><a class="reference internal" href="#python">Python</a></li>
<li><a class="reference internal" href="#c">C++</a></li>
<li><a class="reference internal" href="#java">Java</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="howtogetclients.html"
                        title="previous chapter">How to Get Clients</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="backup_and_recovery.html"
                        title="next chapter">Backup and Recovery</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/faq_rpc_err_workaround.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick Search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" class="keyword" value="keyword" onFocus="HideFormGuide(this);" onBlur="ShowFormGuide(this);" />
                <input type="submit" value="Go" class="searchBtn" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
	  
          

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JubatusOfficial"  data-widget-id="258379257628196864">Tweets by @JubatusOfficial</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="rpc-error-handling">
<h1>RPC Error Handling<a class="headerlink" href="#rpc-error-handling" title="Permalink to this headline">¶</a></h1>
<p>Jubatus causes RPC-errors with various reasons (Among these, you&#8217;ll often encounter timeout errors caused by server-side auto session close).
In this page, we describe how to handle RPC-errors.</p>
<div class="section" id="common-issues">
<h2>Common Issues<a class="headerlink" href="#common-issues" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>If you perform RPC, exceptions may be raised. When exceptions occur, in some client language, connections aren&#8217;t closed automatically.
To avoid resource leaks, you must catch exceptions and close connections explicitly.
It is also the same when you dispose an client object.</li>
<li>RPC errors caused by application layer problems like RPC method or type mismatching, and also caused by transport layer problems like communication errors or timeout.
Trasport layer problems may recover by retrying RPC.</li>
<li>You must consider the following points before retrying RPC:<ul>
<li><strong>validity of retrying UPDATE methods</strong> :
In general, re-performing one non-idempotent UPDATE method may make an EM model different.
Ideally, we want to retry RPC only which isn&#8217;t performed by server actually.
But Jubatus client can&#8217;t detect that. Thus, you need to restrict retrying UPDATE methods to idempotent ones.
On the other hand, retrying ANALYZE methods aren&#8217;t restricted.</li>
<li><strong>latency</strong> :
Retrying RPC will increase latency. You must consider your application can allow that.</li>
</ul>
</li>
<li>It is recommended that retrying RPC are performed after some interval and limit the number of retrying.</li>
</ul>
</div>
<div class="section" id="recommendation-for-each-client-languages">
<h2>Recommendation for each client languages<a class="headerlink" href="#recommendation-for-each-client-languages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ruby">
<h3>Ruby<a class="headerlink" href="#ruby" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>RPC performing code should guarantee explicit session closing by <tt class="docutils literal"><span class="pre">begin</span> <span class="pre">-</span> <span class="pre">ensure</span></tt> block.
To close sessions explicitly, you execute client object&#8217;s <tt class="docutils literal"><span class="pre">get_client.close</span></tt> .</li>
<li>Any RPC exceptions are derived from <tt class="docutils literal"><span class="pre">MessagePack::RPC::RPCError</span></tt> .</li>
<li>When transport layer error occurs by RPC,  <tt class="docutils literal"><span class="pre">MessagePack::RPC::TransportError</span></tt> exception will be raised.
Timeout raises <tt class="docutils literal"><span class="pre">MessagePack::RPC::TimeoutError</span></tt> exception.
Server-side connection close also raises <tt class="docutils literal"><span class="pre">MessagePack::RPC::TimeoutError</span></tt> .
You should catch these exceptions by <tt class="docutils literal"><span class="pre">begin</span> <span class="pre">-</span> <span class="pre">rescue</span></tt> block and will retry RPC.
Before you retry, you must close sessions explicitly.</li>
<li>When RPC methods mismatching, type mismatching errors occur by RPC, <tt class="docutils literal"><span class="pre">Jubatus::Common::InterfaceMismatch</span></tt> exception will be raised.
When algorithm errors occur by RPC, <tt class="docutils literal"><span class="pre">MessagePack::RPC::RemoteError</span></tt> or <tt class="docutils literal"><span class="pre">MessagePack::RPC::CallError</span></tt> exception will be raised.
You should catch these exceptions and close sessions explicitly.
You can catch any RPC exceptions by <tt class="docutils literal"><span class="pre">RPCError</span></tt>  excluding <tt class="docutils literal"><span class="pre">TransportError</span></tt> and <tt class="docutils literal"><span class="pre">TimeoutError</span></tt> .</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;jubatus/classifier/client&#39;</span>

<span class="no">RETRY_MAX</span> <span class="o">=</span> <span class="mi">3</span>      <span class="c1"># maximum number of retries</span>
<span class="no">RETRY_INTERVAL</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># retry interval (sec)</span>

<span class="n">client</span> <span class="o">=</span> <span class="ss">Jubatus</span><span class="p">:</span><span class="ss">:Classifier</span><span class="o">::</span><span class="ss">Client</span><span class="p">:</span><span class="ss">:Classifier</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
<span class="k">begin</span>
  <span class="n">retry_count</span> <span class="o">=</span> <span class="no">RETRY_MAX</span>
  <span class="k">begin</span>

    <span class="c1"># performing RPC</span>
    <span class="n">client</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">query_data</span><span class="p">)</span>

  <span class="c1"># retry against transport error and timeout</span>
  <span class="k">rescue</span> <span class="ss">MessagePack</span><span class="p">:</span><span class="ss">:RPC</span><span class="o">::</span><span class="no">TimeoutError</span><span class="p">,</span> <span class="ss">MessagePack</span><span class="p">:</span><span class="ss">:RPC</span><span class="o">::</span><span class="no">TransportError</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="c1"># stop retrying if the number of retry reaches limit</span>
    <span class="k">raise</span> <span class="k">if</span> <span class="p">(</span><span class="n">retry_count</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>

    <span class="c1"># preparing retry: close session explicitly</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get_client</span><span class="o">.</span><span class="n">close</span>

    <span class="c1"># retry after some inteval</span>
    <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="n">e</span>
    <span class="nb">sleep</span> <span class="no">RETRY_INTERVAL</span>
    <span class="k">retry</span>
  <span class="k">end</span>

<span class="c1"># catch any RPC exceptions</span>
<span class="k">rescue</span> <span class="ss">MessagePack</span><span class="p">:</span><span class="ss">:RPC</span><span class="o">::</span><span class="no">RPCError</span><span class="p">,</span> <span class="ss">Jubatus</span><span class="p">:</span><span class="ss">:Common</span><span class="o">::</span><span class="no">InterfaceMismatch</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="n">e</span>
<span class="k">ensure</span>
  <span class="c1"># close session always</span>
  <span class="n">client</span><span class="o">.</span><span class="n">get_client</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>RPC performing code should guarantee explicit session closing by <tt class="docutils literal"><span class="pre">try</span> <span class="pre">-</span> <span class="pre">finally</span></tt> block.
To close sessions explicitly, you execute client object&#8217;s <tt class="docutils literal"><span class="pre">get_client().close()</span></tt> .</li>
<li>Any RPC exceptions are derived from <tt class="docutils literal"><span class="pre">msgpackrpc.error.RPCError</span></tt> .</li>
<li>When transport layer error occurs by RPC, <tt class="docutils literal"><span class="pre">msgpackrpc.error.TransportError</span></tt> exception will be raised.
Timeout raises <tt class="docutils literal"><span class="pre">msgpackrpc.error.TimeoutError</span></tt> exception.
Server-side connection close also raises <tt class="docutils literal"><span class="pre">msgpackrpc.error.TimeoutError</span></tt> .
You should catch these exceptions by <tt class="docutils literal"><span class="pre">try</span> <span class="pre">-</span> <span class="pre">except</span></tt> block and will retry RPC.
Before you retry, you must close sessions explicitly and <strong>re-create a client object</strong> .</li>
<li>When RPC method or type mismatching occur, <tt class="docutils literal"><span class="pre">jubatus.common.client.InterfaceMismatch</span></tt> exception will be raised.
Algorithm error and other RPC errors raise <tt class="docutils literal"><span class="pre">msgpackrpc.error.RPCError</span></tt> exception.
You should catch these exceptions and close sessions explicitly.
You can catch any RPC exceptions by <tt class="docutils literal"><span class="pre">RPCError</span></tt> excluding <tt class="docutils literal"><span class="pre">TransportError</span></tt> and <tt class="docutils literal"><span class="pre">TimeoutError</span></tt> .</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">jubatus</span>
<span class="kn">from</span> <span class="nn">jubatus.common</span> <span class="kn">import</span> <span class="n">Datum</span>
<span class="kn">import</span> <span class="nn">msgpackrpc</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">retry_max</span> <span class="o">=</span> <span class="mi">3</span>      <span class="c"># maximum number of retries</span>
<span class="n">retry_interval</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># retry interval (sec)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">jubatus</span><span class="o">.</span><span class="n">Classifier</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">retry_count</span> <span class="o">=</span> <span class="n">retry_max</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c"># performing RPC</span>
            <span class="n">client</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">query_data</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="c"># retry against transport error and timeout</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">msgpackrpc</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">TransportError</span><span class="p">,</span> <span class="n">msgpackrpc</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c"># stop retrying if the number of retry reaches limit</span>
            <span class="n">retry_count</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span>

            <span class="c"># preparing retry: close session explicitly and re-create client object</span>
            <span class="n">client</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">jubatus</span><span class="o">.</span><span class="n">Classifier</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

            <span class="c"># retry after some interval</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_interval</span><span class="p">)</span>
            <span class="k">continue</span>

<span class="c"># catch any RPC exceptions</span>
<span class="k">except</span> <span class="p">(</span><span class="n">msgpackrpc</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">RPCError</span><span class="p">,</span> <span class="n">jubatus</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">InterfaceMismatch</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">e</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="c"># close session always</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="c">
<h3>C++<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>When you dispose client objects, connections are closed automatically.
You don&#8217;t need to close sessions explicitly. But if you want to do so, you execute client object&#8217;s <tt class="docutils literal"><span class="pre">get_client().close()</span></tt> .</li>
<li>Any RPC exceptions are derived from <tt class="docutils literal"><span class="pre">msgpack::rpc::rpc_error</span></tt> .</li>
<li>When client object fails to connect server ( one of the transport layer errors ) , <tt class="docutils literal"><span class="pre">msgpack::rpc::connect_error</span></tt> will be raised.
Other transport layer errors will raise <tt class="docutils literal"><span class="pre">msgpack::rpc::system_error</span></tt> exceptions.
Timeout will raise <tt class="docutils literal"><span class="pre">msgpack::rpc::timeout_error</span></tt> exception.
And server-side connection close will raise <tt class="docutils literal"><span class="pre">msgpack::rpc::connection_closed_error</span></tt> exception.
You should catch these exceptions by <tt class="docutils literal"><span class="pre">try</span> <span class="pre">-</span> <span class="pre">catch</span></tt> block and will retry RPC.
Before you retry, you must close sessions explicitly.
In addition, <tt class="docutils literal"><span class="pre">connect_error</span></tt> exception is derived from <tt class="docutils literal"><span class="pre">timeout_error</span></tt>.
You can catch <tt class="docutils literal"><span class="pre">connect_error</span></tt> exceptions as <tt class="docutils literal"><span class="pre">timeout_error</span></tt> .</li>
<li>When RPC method mismatch and type mismatch occur by RPC, <tt class="docutils literal"><span class="pre">msgpack::rpc::no_method_error</span></tt> and <tt class="docutils literal"><span class="pre">msgpack::rpc::argument_error</span></tt> exception will be raised respectively.
Algorithm error will raise <tt class="docutils literal"><span class="pre">msgpack::rpc::remote_error</span></tt> exception.
You can catch these exceptions as <tt class="docutils literal"><span class="pre">rpc_error</span></tt> .</li>
</ul>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#include &lt;jubatus/client.hpp&gt;</span>

<span class="cp">#define RETRY_MAX 3       </span><span class="c1">// maximum number of retries</span>
<span class="cp">#define RETRY_INTERVAL 3  </span><span class="c1">// retry interval (sec)</span>

<span class="c1">// RPC exception handler macro</span>
<span class="cp">#define RPC_RETRY_EXCEPTION_COMMON_HANDLER()              \</span>
<span class="cp">    </span><span class="c1">// stop retrying if the number of retry reaches limit \</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">retry_count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>                        \
                                                          \
    <span class="c1">// preparing retry: close session explicitly          \</span>
<span class="c1">    client.get_client().close();                          \</span>
<span class="c1">                                                          \</span>
<span class="c1">    // retry after some interval                          \</span>
<span class="c1">    std::cerr &lt;&lt; e.what() &lt;&lt; std::endl;                   \</span>
<span class="c1">    ::sleep(RETRY_INTERVAL);                              \</span>
<span class="c1">    continue;</span>

<span class="p">{</span>
  <span class="n">jubatus</span><span class="o">::</span><span class="n">classifier</span><span class="o">::</span><span class="n">client</span><span class="o">::</span><span class="n">classifier</span> <span class="n">client</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">timeout</span><span class="p">);</span>
  <span class="n">try</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">retry_count</span> <span class="o">=</span> <span class="n">RETRY_MAX</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">try</span> <span class="p">{</span>

        <span class="c1">// performing RPC</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">classify</span><span class="p">(</span><span class="n">query_data</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="c1">// retry against transport errors and timeout</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">msgpack</span><span class="o">::</span><span class="n">rpc</span><span class="o">::</span><span class="n">connection_closed_error</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">RPC_RETRY_EXCEPTION_COMMON_HANDLER</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">msgpack</span><span class="o">::</span><span class="n">rpc</span><span class="o">::</span><span class="n">system_error</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">RPC_RETRY_EXCEPTION_COMMON_HANDLER</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">msgpack</span><span class="o">::</span><span class="n">rpc</span><span class="o">::</span><span class="n">timeout_error</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">RPC_RETRY_EXCEPTION_COMMON_HANDLER</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="c1">// catch any RPC exceptions</span>
  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">msgpack</span><span class="o">::</span><span class="n">rpc</span><span class="o">::</span><span class="n">rpc_error</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// close connections automatically by disposing client object</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="java">
<h3>Java<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>RPC performing code should guarantee explicit session closing by <tt class="docutils literal"><span class="pre">try</span> <span class="pre">-</span> <span class="pre">finally</span></tt> block.
To close sessions explicitly, you execute client objects&#8217; <tt class="docutils literal"><span class="pre">get_client().close()</span></tt> .</li>
<li>Any RPC errors are reported by <tt class="docutils literal"><span class="pre">org.msgpack.rpc.error.RPCError</span></tt> exceptions.
You <strong>can not</strong> distinguish errors by exception classes.
You should catch <tt class="docutils literal"><span class="pre">RPCError</span></tt> exceptions and close sessions explicitly.</li>
<li>After closing session explicitly, you can retry RPC by same client object.
But retrying RPC is not recommended because you can not detect transport layer error which may recover by retrying.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="backup_and_recovery.html" title="Backup and Recovery"
             >next</a> |</li>
        <li class="right" >
          <a href="howtogetclients.html" title="How to Get Clients"
             >previous</a> |</li>
        <li><a href="index.html">Jubatus</a> &raquo;</li>
          <li><a href="documentation.html" >Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2014 PFI &amp; NTT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>

    <!-- https://github.com/blog/273-github-ribbons -->
    <a href="http://github.com/jubatus/jubatus">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
      </a>
  </body>
</html>